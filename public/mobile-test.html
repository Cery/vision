<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#1976d2">
    <title>移动端优化测试 - VisNDT</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- 移动端优化样式 -->
    <link href="/css/mobile-optimization.css" rel="stylesheet">
    <link href="/css/browser-compatibility.css" rel="stylesheet">
    
    <style>
        .test-section {
            background: white;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .browser-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            font-size: 0.9rem;
        }
        .test-result {
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        .success { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <header class="text-center py-3 bg-primary text-white">
            <h1 class="h4 mb-0">📱 移动端优化测试</h1>
            <small>多浏览器兼容性验证</small>
        </header>

        <!-- 浏览器检测信息 -->
        <div class="test-section">
            <h5><i class="fas fa-mobile-alt me-2"></i>设备与浏览器信息</h5>
            <div class="browser-info" id="browserInfo">
                <div>正在检测设备信息...</div>
            </div>
        </div>

        <!-- 触摸测试 -->
        <div class="test-section">
            <h5><i class="fas fa-hand-pointer me-2"></i>触摸交互测试</h5>
            <div class="row g-2">
                <div class="col-6">
                    <button class="btn btn-primary w-100 test-touch-btn">
                        <i class="fas fa-click me-1"></i>触摸按钮
                    </button>
                </div>
                <div class="col-6">
                    <button class="btn btn-outline-secondary w-100 test-touch-btn">
                        <i class="fas fa-touch me-1"></i>反馈测试
                    </button>
                </div>
            </div>
            <div class="test-result info mt-2" id="touchResult">
                点击按钮测试触摸反馈效果
            </div>
        </div>

        <!-- 表单测试 */
        <div class="test-section">
            <h5><i class="fas fa-edit me-2"></i>表单输入测试</h5>
            <form>
                <div class="mb-3">
                    <label class="form-label">文本输入</label>
                    <input type="text" class="form-control" placeholder="测试文本输入">
                </div>
                <div class="mb-3">
                    <label class="form-label">邮箱输入</label>
                    <input type="email" class="form-control" placeholder="test@example.com">
                </div>
                <div class="mb-3">
                    <label class="form-label">电话输入</label>
                    <input type="tel" class="form-control" placeholder="手机号码">
                </div>
                <div class="mb-3">
                    <label class="form-label">选择框</label>
                    <select class="form-select">
                        <option>选项1</option>
                        <option>选项2</option>
                        <option>选项3</option>
                    </select>
                </div>
            </form>
        </div>

        <!-- 卡片布局测试 -->
        <div class="test-section">
            <h5><i class="fas fa-th-large me-2"></i>响应式布局测试</h5>
            <div class="row g-2">
                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">产品卡片1</h6>
                            <p class="card-text">这是一个测试产品卡片的描述文本。</p>
                            <button class="btn btn-sm btn-primary">查看详情</button>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">产品卡片2</h6>
                            <p class="card-text">这是另一个测试产品卡片的描述文本。</p>
                            <button class="btn btn-sm btn-outline-primary">查看详情</button>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">产品卡片3</h6>
                            <p class="card-text">第三个测试产品卡片的描述文本内容。</p>
                            <button class="btn btn-sm btn-success">查看详情</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 分类按钮测试 -->
        <div class="test-section">
            <h5><i class="fas fa-tags me-2"></i>分类按钮测试</h5>
            <div class="d-flex flex-wrap gap-1 gap-md-2 justify-content-center justify-content-md-start">
                <button class="btn btn-sm btn-primary primary-btn">
                    <i class="fas fa-home me-1"></i><span class="category-text">全部分类</span>
                </button>
                <button class="btn btn-sm btn-outline-primary primary-btn">
                    <i class="fas fa-folder me-1"></i><span class="category-text">电子内窥镜</span>
                </button>
                <button class="btn btn-sm btn-outline-primary primary-btn">
                    <i class="fas fa-folder me-1"></i><span class="category-text">光纤内窥镜</span>
                </button>
                <button class="btn btn-sm btn-outline-primary primary-btn">
                    <i class="fas fa-folder me-1"></i><span class="category-text">光学内窥镜</span>
                </button>
            </div>
        </div>

        <!-- 滚动测试 -->
        <div class="test-section">
            <h5><i class="fas fa-arrows-alt-v me-2"></i>滚动性能测试</h5>
            <div class="scroll-container" style="height: 200px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 6px; padding: 1rem;">
                <p>这是一个可滚动的容器，用于测试移动端滚动性能。</p>
                <p>在iOS Safari中，应该有平滑的滚动效果。</p>
                <p>在Android Chrome中，滚动应该流畅无卡顿。</p>
                <p>在UC浏览器中，滚动条应该正常显示。</p>
                <p>在360手机浏览器中，滚动应该响应迅速。</p>
                <p>这里有更多的内容来测试滚动效果...</p>
                <p>继续滚动查看更多内容...</p>
                <p>移动端滚动优化包括：</p>
                <ul>
                    <li>-webkit-overflow-scrolling: touch</li>
                    <li>平滑滚动动画</li>
                    <li>滚动性能优化</li>
                    <li>防止滚动穿透</li>
                </ul>
                <p>滚动到底部了！</p>
            </div>
        </div>

        <!-- 模态框测试 -->
        <div class="test-section">
            <h5><i class="fas fa-window-maximize me-2"></i>模态框测试</h5>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#testModal">
                <i class="fas fa-external-link-alt me-1"></i>打开模态框
            </button>
        </div>

        <!-- 测试结果 -->
        <div class="test-section">
            <h5><i class="fas fa-check-circle me-2"></i>优化效果检测</h5>
            <div id="optimizationResults">
                <div class="test-result info">正在检测优化效果...</div>
            </div>
        </div>

        <!-- 返回顶部按钮 -->
        <button id="backToTopBtn" class="btn btn-primary position-fixed" style="bottom: 20px; right: 20px; z-index: 1000; display: none; border-radius: 50%; width: 50px; height: 50px;">
            <i class="fas fa-arrow-up"></i>
        </button>
    </div>

    <!-- 测试模态框 -->
    <div class="modal fade" id="testModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">移动端模态框测试</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>这是一个测试模态框，用于验证移动端模态框的显示效果。</p>
                    <p>在移动设备上，模态框应该：</p>
                    <ul>
                        <li>正确适应屏幕尺寸</li>
                        <li>防止背景滚动</li>
                        <li>支持触摸关闭</li>
                        <li>焦点管理正确</li>
                    </ul>
                    <div class="mb-3">
                        <label class="form-label">测试输入框</label>
                        <input type="text" class="form-control" placeholder="在模态框中输入文本">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary">确定</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 移动端优化脚本 -->
    <script src="/js/mobile-optimization.js"></script>

    <script>
        // 浏览器检测和显示
        function displayBrowserInfo() {
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                screenWidth: screen.width,
                screenHeight: screen.height,
                windowWidth: window.innerWidth,
                windowHeight: window.innerHeight,
                devicePixelRatio: window.devicePixelRatio || 1,
                touchSupport: 'ontouchstart' in window,
                orientation: window.orientation || 0
            };

            const browserType = detectBrowser();
            
            document.getElementById('browserInfo').innerHTML = `
                <div><strong>浏览器类型:</strong> ${browserType}</div>
                <div><strong>屏幕尺寸:</strong> ${info.screenWidth} × ${info.screenHeight}</div>
                <div><strong>窗口尺寸:</strong> ${info.windowWidth} × ${info.windowHeight}</div>
                <div><strong>设备像素比:</strong> ${info.devicePixelRatio}</div>
                <div><strong>触摸支持:</strong> ${info.touchSupport ? '是' : '否'}</div>
                <div><strong>屏幕方向:</strong> ${Math.abs(info.orientation) === 90 ? '横屏' : '竖屏'}</div>
                <div><strong>语言:</strong> ${info.language}</div>
                <div><strong>平台:</strong> ${info.platform}</div>
            `;
        }

        function detectBrowser() {
            const ua = navigator.userAgent;
            if (/UCBrowser|UCWEB/.test(ua)) return 'UC浏览器';
            if (/360/.test(ua)) return '360手机浏览器';
            if (/QQBrowser/.test(ua)) return 'QQ浏览器';
            if (/SogouMobileBrowser/.test(ua)) return '搜狗手机浏览器';
            if (/HuaweiBrowser/.test(ua)) return '华为浏览器';
            if (/MiuiBrowser/.test(ua)) return 'MIUI浏览器';
            if (/Safari/.test(ua) && !/Chrome/.test(ua)) return 'Safari';
            if (/Chrome/.test(ua)) return 'Chrome Mobile';
            if (/Firefox/.test(ua)) return 'Firefox Mobile';
            return '其他浏览器';
        }

        // 触摸测试
        function setupTouchTest() {
            const buttons = document.querySelectorAll('.test-touch-btn');
            const result = document.getElementById('touchResult');
            
            buttons.forEach(btn => {
                btn.addEventListener('touchstart', () => {
                    result.innerHTML = '✅ 触摸开始事件触发';
                    result.className = 'test-result success mt-2';
                });
                
                btn.addEventListener('touchend', () => {
                    result.innerHTML = '✅ 触摸结束事件触发 - 触摸反馈正常';
                    result.className = 'test-result success mt-2';
                });
                
                btn.addEventListener('click', () => {
                    result.innerHTML = '✅ 点击事件触发 - 交互正常';
                    result.className = 'test-result success mt-2';
                });
            });
        }

        // 优化效果检测
        function checkOptimizations() {
            const results = [];
            
            // 检测CSS支持
            if (CSS.supports('-webkit-overflow-scrolling', 'touch')) {
                results.push('✅ iOS滚动优化支持');
            } else {
                results.push('⚠️ iOS滚动优化不支持');
            }
            
            // 检测触摸支持
            if ('ontouchstart' in window) {
                results.push('✅ 触摸事件支持');
            } else {
                results.push('⚠️ 触摸事件不支持');
            }
            
            // 检测视口设置
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport && viewport.content.includes('user-scalable=no')) {
                results.push('✅ 防缩放设置正确');
            } else {
                results.push('⚠️ 防缩放设置缺失');
            }
            
            // 检测响应式布局
            if (window.innerWidth <= 768) {
                results.push('✅ 移动端布局激活');
            } else {
                results.push('ℹ️ 桌面端布局');
            }
            
            document.getElementById('optimizationResults').innerHTML = 
                results.map(result => `<div class="test-result ${result.includes('✅') ? 'success' : result.includes('⚠️') ? 'warning' : 'info'}">${result}</div>`).join('');
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            displayBrowserInfo();
            setupTouchTest();
            checkOptimizations();
            
            // 屏幕旋转检测
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    displayBrowserInfo();
                    checkOptimizations();
                }, 100);
            });
        });
    </script>
</body>
</html>
