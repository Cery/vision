<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•33ä¸ªäº§å“åŠ è½½</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 20px 0; }
        .success { border-left: 4px solid #28a745; background: #f8fff9; }
        .error { border-left: 4px solid #dc3545; background: #fff8f8; }
        .warning { border-left: 4px solid #ffc107; background: #fffbf0; }
        button { padding: 12px 24px; margin: 10px 5px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .product-list { max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; }
        .product-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .product-item:last-child { border-bottom: none; }
        .product-info { flex: 1; }
        .product-title { font-weight: bold; color: #333; }
        .product-meta { font-size: 0.9em; color: #666; }
        .product-series { background: #e9ecef; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª æµ‹è¯•33ä¸ªäº§å“æ•°æ®åŠ è½½</h1>
        
        <div class="card">
            <h3>æµ‹è¯•ç›®æ ‡</h3>
            <p>éªŒè¯å†…å®¹ç®¡ç†å™¨æ˜¯å¦èƒ½æ­£ç¡®åŠ è½½å…¨éƒ¨33ä¸ªäº§å“ï¼Œè€Œä¸æ˜¯åªæ˜¾ç¤º4ä¸ªäº§å“ã€‚</p>
            <p><strong>é¢„æœŸç»“æœï¼š</strong>åº”è¯¥æ˜¾ç¤º33ä¸ªäº§å“ï¼ŒåŒ…å«Kç³»åˆ—ã€Pç³»åˆ—ã€DZç³»åˆ—ç­‰å„ç§äº§å“ã€‚</p>
        </div>

        <div class="card">
            <h3>æµ‹è¯•æ“ä½œ</h3>
            <button class="btn-primary" onclick="testProductLoading()">æµ‹è¯•äº§å“åŠ è½½</button>
            <button class="btn-success" onclick="openContentManager()">æ‰“å¼€å†…å®¹ç®¡ç†å™¨</button>
        </div>

        <div class="card">
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="testResults">
                <p>ç‚¹å‡»"æµ‹è¯•äº§å“åŠ è½½"å¼€å§‹æµ‹è¯•...</p>
            </div>
        </div>

        <div class="card">
            <h3>äº§å“åˆ—è¡¨</h3>
            <div id="productList" class="product-list">
                <p style="text-align: center; padding: 20px; color: #666;">ç­‰å¾…åŠ è½½äº§å“æ•°æ®...</p>
            </div>
        </div>
    </div>

    <script>
        async function testProductLoading() {
            const resultsDiv = document.getElementById('testResults');
            const productListDiv = document.getElementById('productList');
            
            resultsDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨æµ‹è¯•äº§å“åŠ è½½...</p>';
            productListDiv.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">æ­£åœ¨åŠ è½½...</p>';

            try {
                // æ£€æŸ¥ContentDataLoaderæ˜¯å¦å¯ç”¨
                if (typeof ContentDataLoader === 'undefined') {
                    // å°è¯•ä»content-manager.htmlåŠ è½½ContentDataLoader
                    console.log('ContentDataLoaderæœªå®šä¹‰ï¼Œå°è¯•ä»content-manager.htmlåŠ è½½...');
                    
                    const response = await fetch('/admin/content-manager.html');
                    const html = await response.text();
                    
                    // æå–å†…è”çš„ContentDataLoaderè„šæœ¬
                    const scriptMatch = html.match(/<script>\s*\/\/ å†…è”ContentDataLoaderç±»[\s\S]*?<\/script>/);
                    if (scriptMatch) {
                        const scriptContent = scriptMatch[0].replace(/<\/?script[^>]*>/g, '');
                        eval(scriptContent);
                        console.log('ContentDataLoaderå·²ä»content-manager.htmlåŠ è½½');
                    } else {
                        throw new Error('æ— æ³•ä»content-manager.htmlæå–ContentDataLoader');
                    }
                }

                // åˆ›å»ºæ•°æ®åŠ è½½å™¨å®ä¾‹
                const loader = new ContentDataLoader();
                console.log('ContentDataLoaderå®ä¾‹å·²åˆ›å»º');

                // åŠ è½½æ‰€æœ‰æ•°æ®
                await loader.loadAllData();
                console.log('æ•°æ®åŠ è½½å®Œæˆ');

                // è·å–äº§å“æ•°æ®
                const products = loader.contentData.products || [];
                console.log(`åŠ è½½äº† ${products.length} ä¸ªäº§å“`);

                // æ˜¾ç¤ºç»“æœ
                if (products.length === 33) {
                    resultsDiv.innerHTML = `
                        <div class="success">
                            <h4>âœ… æµ‹è¯•é€šè¿‡ï¼</h4>
                            <p>æˆåŠŸåŠ è½½äº† <strong>${products.length}</strong> ä¸ªäº§å“ï¼Œç¬¦åˆé¢„æœŸçš„33ä¸ªäº§å“ã€‚</p>
                            <p>äº§å“æ•°æ®ç»“æ„å®Œæ•´ï¼ŒåŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µã€‚</p>
                        </div>
                    `;
                } else if (products.length > 0) {
                    resultsDiv.innerHTML = `
                        <div class="warning">
                            <h4>âš ï¸ éƒ¨åˆ†æˆåŠŸ</h4>
                            <p>åŠ è½½äº† <strong>${products.length}</strong> ä¸ªäº§å“ï¼Œä½†é¢„æœŸåº”è¯¥æ˜¯33ä¸ªã€‚</p>
                            <p>å¯èƒ½å­˜åœ¨æ•°æ®åŠ è½½ä¸å®Œæ•´çš„é—®é¢˜ã€‚</p>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="error">
                            <h4>âŒ æµ‹è¯•å¤±è´¥</h4>
                            <p>æ²¡æœ‰åŠ è½½åˆ°ä»»ä½•äº§å“æ•°æ®ã€‚</p>
                        </div>
                    `;
                }

                // æ˜¾ç¤ºäº§å“åˆ—è¡¨
                if (products.length > 0) {
                    const productListHTML = products.map((product, index) => `
                        <div class="product-item">
                            <div class="product-info">
                                <div class="product-title">${product.title || 'æœªå‘½åäº§å“'}</div>
                                <div class="product-meta">
                                    å‹å·: ${product.model || '-'} | 
                                    ä¾›åº”å•†: ${product.supplier || '-'}
                                </div>
                            </div>
                            <div>
                                <span class="product-series">${product.series || 'æœªçŸ¥ç³»åˆ—'}</span>
                            </div>
                        </div>
                    `).join('');
                    
                    productListDiv.innerHTML = productListHTML;
                } else {
                    productListDiv.innerHTML = '<p style="text-align: center; padding: 20px; color: #999;">æ²¡æœ‰äº§å“æ•°æ®</p>';
                }

                // ç»Ÿè®¡å„ç³»åˆ—äº§å“æ•°é‡
                const seriesCount = {};
                products.forEach(product => {
                    const series = product.series || 'æœªçŸ¥ç³»åˆ—';
                    seriesCount[series] = (seriesCount[series] || 0) + 1;
                });

                console.log('å„ç³»åˆ—äº§å“ç»Ÿè®¡:', seriesCount);
                
                // åœ¨ç»“æœä¸­æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
                const statsHTML = Object.entries(seriesCount)
                    .map(([series, count]) => `${series}: ${count}ä¸ª`)
                    .join(', ');
                
                resultsDiv.innerHTML += `
                    <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                        <strong>ç³»åˆ—ç»Ÿè®¡:</strong> ${statsHTML}
                    </div>
                `;

            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h4>âŒ æµ‹è¯•å¤±è´¥</h4>
                        <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                        <p>è¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚</p>
                    </div>
                `;
                productListDiv.innerHTML = '<p style="text-align: center; padding: 20px; color: #999;">åŠ è½½å¤±è´¥</p>';
            }
        }

        function openContentManager() {
            window.open('/admin/content-manager.html', '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            console.log('33äº§å“æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // å»¶è¿Ÿ1ç§’åè‡ªåŠ¨è¿è¡Œæµ‹è¯•
            setTimeout(() => {
                testProductLoading();
            }, 1000);
        });
    </script>
</body>
</html>
