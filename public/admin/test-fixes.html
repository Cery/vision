<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 20px 0; }
        .success { border-left: 4px solid #28a745; background: #f8fff9; }
        .error { border-left: 4px solid #dc3545; background: #fff8f8; }
        .warning { border-left: 4px solid #ffc107; background: #fffbf0; }
        .info { border-left: 4px solid #17a2b8; background: #f0f9ff; }
        button { padding: 12px 24px; margin: 10px 5px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .test-item { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; }
        .test-title { font-weight: bold; color: #495057; margin-bottom: 10px; }
        .test-status { font-size: 1.2em; margin-top: 10px; }
        .test-details { font-size: 0.9em; color: #6c757d; margin-top: 5px; }
        .iframe-container { border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden; margin: 10px 0; }
        iframe { width: 100%; height: 400px; border: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ä¿®å¤éªŒè¯æµ‹è¯•</h1>
        
        <div class="card">
            <h3>ä¿®å¤é¡¹ç›®æ¸…å•</h3>
            <div class="test-grid">
                <div class="test-item">
                    <div class="test-title">1. å¿«é€Ÿç»Ÿè®¡æ•°æ®æ˜¾ç¤º</div>
                    <div class="test-details">ä¿®å¤ç®¡ç†é¡µé¢é¦–é¡µç»Ÿè®¡æ•°å­—æ˜¾ç¤ºä¸º0çš„é—®é¢˜</div>
                    <div class="test-status" id="stats-status">â³ ç­‰å¾…æµ‹è¯•</div>
                </div>
                
                <div class="test-item">
                    <div class="test-title">2. äº§å“åˆ†ç±»æ ‡ç­¾æ·±è‰²</div>
                    <div class="test-details">äº§å“å¡ç‰‡å’Œè¯¦æƒ…é¡µåˆ†ç±»æ ‡ç­¾èƒŒæ™¯æ”¹ä¸ºæ·±è‰²</div>
                    <div class="test-status" id="tags-status">â³ ç­‰å¾…æµ‹è¯•</div>
                </div>
                
                <div class="test-item">
                    <div class="test-title">3. Logoæ·±è‰²å…ƒç´ </div>
                    <div class="test-details">ç¡®ä¿æ‰€æœ‰logoå…ƒç´ ä½¿ç”¨æ·±è‰²ç‰ˆæœ¬</div>
                    <div class="test-status" id="logo-status">â³ ç­‰å¾…æµ‹è¯•</div>
                </div>
                
                <div class="test-item">
                    <div class="test-title">4. æ•°æ®åŠ è½½å®Œæ•´æ€§</div>
                    <div class="test-details">éªŒè¯æ‰€æœ‰æ•°æ®æ¨¡å—æ­£ç¡®åŠ è½½</div>
                    <div class="test-status" id="data-status">â³ ç­‰å¾…æµ‹è¯•</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>æµ‹è¯•æ“ä½œ</h3>
            <button class="btn-primary" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="btn-success" onclick="openContentManager()">æ‰“å¼€å†…å®¹ç®¡ç†å™¨</button>
            <button class="btn-warning" onclick="openProductsPage()">æŸ¥çœ‹äº§å“é¡µé¢</button>
        </div>

        <div class="card">
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="testResults">
                <p>ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"å¼€å§‹éªŒè¯ä¿®å¤æ•ˆæœ...</p>
            </div>
        </div>

        <div class="card">
            <h3>å†…å®¹ç®¡ç†å™¨é¢„è§ˆ</h3>
            <div class="iframe-container">
                <iframe src="/admin/content-manager.html" title="å†…å®¹ç®¡ç†å™¨"></iframe>
            </div>
        </div>

        <div class="card">
            <h3>äº§å“é¡µé¢é¢„è§ˆ</h3>
            <div class="iframe-container">
                <iframe src="/products/" title="äº§å“é¡µé¢"></iframe>
            </div>
        </div>
    </div>

    <script>
        async function runAllTests() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨è¿è¡Œæµ‹è¯•...</p>';

            const tests = [
                { name: 'å¿«é€Ÿç»Ÿè®¡æ•°æ®', id: 'stats-status', test: testStatistics },
                { name: 'äº§å“åˆ†ç±»æ ‡ç­¾', id: 'tags-status', test: testProductTags },
                { name: 'Logoæ·±è‰²å…ƒç´ ', id: 'logo-status', test: testLogoDark },
                { name: 'æ•°æ®åŠ è½½å®Œæ•´æ€§', id: 'data-status', test: testDataLoading }
            ];

            const results = [];
            
            for (const test of tests) {
                try {
                    const result = await test.test();
                    const statusEl = document.getElementById(test.id);
                    
                    if (result.success) {
                        statusEl.innerHTML = 'âœ… é€šè¿‡';
                        statusEl.className = 'test-status success';
                    } else {
                        statusEl.innerHTML = 'âŒ å¤±è´¥';
                        statusEl.className = 'test-status error';
                    }
                    
                    results.push({
                        name: test.name,
                        success: result.success,
                        message: result.message
                    });
                } catch (error) {
                    const statusEl = document.getElementById(test.id);
                    statusEl.innerHTML = 'âš ï¸ é”™è¯¯';
                    statusEl.className = 'test-status warning';
                    
                    results.push({
                        name: test.name,
                        success: false,
                        message: `æµ‹è¯•å‡ºé”™: ${error.message}`
                    });
                }
            }

            displayResults(results);
        }

        async function testStatistics() {
            try {
                // å°è¯•è®¿é—®å†…å®¹ç®¡ç†å™¨çš„ç»Ÿè®¡æ•°æ®
                const response = await fetch('/admin/content-manager.html');
                const html = await response.text();
                
                // æ£€æŸ¥æ˜¯å¦åŒ…å«ç»Ÿè®¡æ›´æ–°å‡½æ•°
                const hasUpdateStats = html.includes('updateStatistics()');
                const hasStatsElements = html.includes('newsCount') && html.includes('productsCount');
                
                if (hasUpdateStats && hasStatsElements) {
                    return { success: true, message: 'ç»Ÿè®¡æ•°æ®æ›´æ–°å‡½æ•°å·²æ­£ç¡®é…ç½®' };
                } else {
                    return { success: false, message: 'ç»Ÿè®¡æ•°æ®æ›´æ–°å‡½æ•°é…ç½®ä¸å®Œæ•´' };
                }
            } catch (error) {
                return { success: false, message: `æ— æ³•éªŒè¯ç»Ÿè®¡æ•°æ®: ${error.message}` };
            }
        }

        async function testProductTags() {
            try {
                // æ£€æŸ¥äº§å“é¡µé¢æ¨¡æ¿
                const listResponse = await fetch('/products/');
                const listHtml = await listResponse.text();
                
                // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ·±è‰²æ ‡ç­¾
                const hasDarkTags = listHtml.includes('badge bg-dark') || listHtml.includes('bg-dark');
                
                if (hasDarkTags) {
                    return { success: true, message: 'äº§å“åˆ†ç±»æ ‡ç­¾å·²æ›´æ–°ä¸ºæ·±è‰²' };
                } else {
                    return { success: false, message: 'äº§å“åˆ†ç±»æ ‡ç­¾ä»ä½¿ç”¨æµ…è‰²' };
                }
            } catch (error) {
                return { success: false, message: `æ— æ³•éªŒè¯äº§å“æ ‡ç­¾: ${error.message}` };
            }
        }

        async function testLogoDark() {
            try {
                // æ£€æŸ¥é¦–é¡µlogo
                const response = await fetch('/');
                const html = await response.text();
                
                // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ·±è‰²logo
                const hasLogoDark = html.includes('logo-dark.svg');
                
                if (hasLogoDark) {
                    return { success: true, message: 'Logoå·²ä½¿ç”¨æ·±è‰²ç‰ˆæœ¬' };
                } else {
                    return { success: false, message: 'Logoä»ä½¿ç”¨æµ…è‰²ç‰ˆæœ¬' };
                }
            } catch (error) {
                return { success: false, message: `æ— æ³•éªŒè¯Logo: ${error.message}` };
            }
        }

        async function testDataLoading() {
            try {
                // æ£€æŸ¥æ•°æ®åŒ¹é…æµ‹è¯•é¡µé¢
                const response = await fetch('/admin/test-data-matching.html');
                const html = await response.text();
                
                // æ£€æŸ¥æ˜¯å¦åŒ…å«å®Œæ•´çš„æ•°æ®ç±»å‹
                const hasAllDataTypes = html.includes('products') && 
                                       html.includes('news') && 
                                       html.includes('cases') && 
                                       html.includes('applications');
                
                if (hasAllDataTypes) {
                    return { success: true, message: 'æ•°æ®åŠ è½½æµ‹è¯•é¡µé¢é…ç½®å®Œæ•´' };
                } else {
                    return { success: false, message: 'æ•°æ®åŠ è½½æµ‹è¯•é¡µé¢é…ç½®ä¸å®Œæ•´' };
                }
            } catch (error) {
                return { success: false, message: `æ— æ³•éªŒè¯æ•°æ®åŠ è½½: ${error.message}` };
            }
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('testResults');
            
            const successCount = results.filter(r => r.success).length;
            const totalCount = results.length;
            
            const overallSuccess = successCount === totalCount;
            const resultClass = overallSuccess ? 'success' : 'warning';
            const resultIcon = overallSuccess ? 'âœ…' : 'âš ï¸';
            
            const resultHtml = `
                <div class="${resultClass}">
                    <h4>${resultIcon} æµ‹è¯•å®Œæˆ</h4>
                    <p><strong>é€šè¿‡ç‡:</strong> ${successCount}/${totalCount} (${Math.round(successCount/totalCount*100)}%)</p>
                    <ul>
                        ${results.map(r => `
                            <li>
                                <strong>${r.name}:</strong> 
                                ${r.success ? 'âœ…' : 'âŒ'} ${r.message}
                            </li>
                        `).join('')}
                    </ul>
                    ${overallSuccess ? 
                        '<p>ğŸ‰ æ‰€æœ‰ä¿®å¤é¡¹ç›®éƒ½å·²æˆåŠŸå®Œæˆï¼</p>' : 
                        '<p>âš ï¸ éƒ¨åˆ†ä¿®å¤é¡¹ç›®éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥ã€‚</p>'
                    }
                </div>
            `;
            
            resultsDiv.innerHTML = resultHtml;
        }

        function openContentManager() {
            window.open('/admin/content-manager.html', '_blank');
        }

        function openProductsPage() {
            window.open('/products/', '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ä¿®å¤éªŒè¯æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // å»¶è¿Ÿ2ç§’åè‡ªåŠ¨è¿è¡Œæµ‹è¯•
            setTimeout(() => {
                runAllTests();
            }, 2000);
        });
    </script>
</body>
</html>
