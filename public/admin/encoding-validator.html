<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisNDT ç¼–ç éªŒè¯å·¥å…·</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .validator-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-warning { background-color: #ffc107; }
        .status-error { background-color: #dc3545; }
        .code-display {
            background-color: #f1f3f4;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .test-pass {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .test-fail {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .test-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">
                    <i class="fas fa-check-circle text-primary"></i>
                    VisNDT ç¼–ç éªŒè¯å·¥å…·
                </h1>
                
                <div class="alert alert-info">
                    <h5><i class="fas fa-info-circle"></i> å·¥å…·è¯´æ˜</h5>
                    <p>æ­¤å·¥å…·ç”¨äºéªŒè¯é¡¹ç›®ä¸­æ‰€æœ‰ç»„ä»¶çš„æ–‡å­—ç¼–ç ä¸€è‡´æ€§ï¼Œç¡®ä¿ä¸­æ–‡å­—ç¬¦åœ¨å„ä¸ªç¯èŠ‚æ­£ç¡®å¤„ç†ã€‚</p>
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿç¼–ç æ£€æŸ¥ -->
        <div class="validator-section">
            <h3><i class="fas fa-cogs"></i> ç³»ç»Ÿç¼–ç æ£€æŸ¥</h3>
            <div id="system-encoding-results"></div>
            <button class="btn btn-primary" onclick="checkSystemEncoding()">
                <i class="fas fa-play"></i> å¼€å§‹æ£€æŸ¥
            </button>
        </div>

        <!-- æ–‡ä»¶ç¼–ç éªŒè¯ -->
        <div class="validator-section">
            <h3><i class="fas fa-file-alt"></i> æ–‡ä»¶ç¼–ç éªŒè¯</h3>
            <div class="mb-3">
                <label for="file-input" class="form-label">é€‰æ‹©æ–‡ä»¶è¿›è¡Œç¼–ç æ£€æŸ¥ï¼š</label>
                <input type="file" class="form-control" id="file-input" multiple 
                       accept=".html,.js,.css,.md,.json,.txt">
            </div>
            <div id="file-encoding-results"></div>
            <button class="btn btn-success" onclick="validateFileEncoding()">
                <i class="fas fa-search"></i> éªŒè¯æ–‡ä»¶ç¼–ç 
            </button>
        </div>

        <!-- å­—ç¬¦ä¸²ç¼–ç æµ‹è¯• -->
        <div class="validator-section">
            <h3><i class="fas fa-keyboard"></i> å­—ç¬¦ä¸²ç¼–ç æµ‹è¯•</h3>
            <div class="mb-3">
                <label for="test-string" class="form-label">è¾“å…¥æµ‹è¯•å­—ç¬¦ä¸²ï¼š</label>
                <textarea class="form-control" id="test-string" rows="3" 
                          placeholder="è¯·è¾“å…¥åŒ…å«ä¸­æ–‡çš„æµ‹è¯•å­—ç¬¦ä¸²...">ç»´æ£®è§†è§‰æ£€æµ‹ä»ªå™¨ - ä¸“ä¸šçš„å·¥ä¸šå†…çª¥é•œè§£å†³æ–¹æ¡ˆ</textarea>
            </div>
            <div id="string-encoding-results"></div>
            <button class="btn btn-info" onclick="testStringEncoding()">
                <i class="fas fa-test-tube"></i> æµ‹è¯•å­—ç¬¦ä¸²ç¼–ç 
            </button>
        </div>

        <!-- URLç¼–ç æµ‹è¯• -->
        <div class="validator-section">
            <h3><i class="fas fa-link"></i> URLç¼–ç æµ‹è¯•</h3>
            <div class="mb-3">
                <label for="test-url" class="form-label">è¾“å…¥æµ‹è¯•URLï¼š</label>
                <input type="text" class="form-control" id="test-url" 
                       placeholder="https://visndt.com/products/å·¥ä¸šå†…çª¥é•œ">
            </div>
            <div id="url-encoding-results"></div>
            <button class="btn btn-warning" onclick="testUrlEncoding()">
                <i class="fas fa-globe"></i> æµ‹è¯•URLç¼–ç 
            </button>
        </div>

        <!-- æµè§ˆå™¨å…¼å®¹æ€§æ£€æŸ¥ -->
        <div class="validator-section">
            <h3><i class="fas fa-browser"></i> æµè§ˆå™¨å…¼å®¹æ€§æ£€æŸ¥</h3>
            <div id="browser-compatibility-results"></div>
            <button class="btn btn-secondary" onclick="checkBrowserCompatibility()">
                <i class="fas fa-desktop"></i> æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
            </button>
        </div>

        <!-- ç»¼åˆæŠ¥å‘Š -->
        <div class="validator-section">
            <h3><i class="fas fa-chart-bar"></i> ç»¼åˆéªŒè¯æŠ¥å‘Š</h3>
            <div id="comprehensive-report"></div>
            <button class="btn btn-danger" onclick="generateComprehensiveReport()">
                <i class="fas fa-file-pdf"></i> ç”Ÿæˆç»¼åˆæŠ¥å‘Š
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ç¼–ç éªŒè¯å·¥å…·ç±»
        class EncodingValidator {
            constructor() {
                this.testResults = [];
            }

            // æ£€æŸ¥ç³»ç»Ÿç¼–ç ç¯å¢ƒ
            checkSystemEncoding() {
                const results = [];
                
                // æ£€æŸ¥æ–‡æ¡£ç¼–ç 
                const docCharset = document.characterSet || document.charset;
                results.push({
                    test: 'æ–‡æ¡£å­—ç¬¦é›†',
                    result: docCharset,
                    status: docCharset.toLowerCase() === 'utf-8' ? 'pass' : 'fail'
                });

                // æ£€æŸ¥è¯­è¨€è®¾ç½®
                const docLang = document.documentElement.lang;
                results.push({
                    test: 'æ–‡æ¡£è¯­è¨€',
                    result: docLang,
                    status: docLang === 'zh-CN' ? 'pass' : 'warning'
                });

                // æ£€æŸ¥æµè§ˆå™¨è¯­è¨€
                const browserLang = navigator.language;
                results.push({
                    test: 'æµè§ˆå™¨è¯­è¨€',
                    result: browserLang,
                    status: browserLang.includes('zh') ? 'pass' : 'warning'
                });

                // æ£€æŸ¥æ—¶åŒº
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                results.push({
                    test: 'æ—¶åŒºè®¾ç½®',
                    result: timezone,
                    status: timezone.includes('Asia') ? 'pass' : 'warning'
                });

                return results;
            }

            // éªŒè¯å­—ç¬¦ä¸²ç¼–ç 
            validateStringEncoding(str) {
                const results = [];

                try {
                    // æ£€æŸ¥å­—ç¬¦ä¸²é•¿åº¦
                    results.push({
                        test: 'å­—ç¬¦ä¸²é•¿åº¦',
                        result: `${str.length} å­—ç¬¦`,
                        status: 'pass'
                    });

                    // æ£€æŸ¥å­—èŠ‚é•¿åº¦
                    const byteLength = new Blob([str]).size;
                    results.push({
                        test: 'å­—èŠ‚é•¿åº¦',
                        result: `${byteLength} å­—èŠ‚`,
                        status: 'pass'
                    });

                    // æ£€æŸ¥æ˜¯å¦åŒ…å«ä¸­æ–‡
                    const hasChinese = /[\u4e00-\u9fff]/.test(str);
                    results.push({
                        test: 'åŒ…å«ä¸­æ–‡å­—ç¬¦',
                        result: hasChinese ? 'æ˜¯' : 'å¦',
                        status: 'pass'
                    });

                    // æ£€æŸ¥Unicodeæ ‡å‡†åŒ–
                    const normalized = str.normalize('NFC');
                    results.push({
                        test: 'Unicodeæ ‡å‡†åŒ–',
                        result: str === normalized ? 'å·²æ ‡å‡†åŒ–' : 'éœ€è¦æ ‡å‡†åŒ–',
                        status: str === normalized ? 'pass' : 'warning'
                    });

                    // æ£€æŸ¥URLç¼–ç 
                    const encoded = encodeURIComponent(str);
                    const decoded = decodeURIComponent(encoded);
                    results.push({
                        test: 'URLç¼–ç å¾€è¿”',
                        result: str === decoded ? 'æ­£å¸¸' : 'å¼‚å¸¸',
                        status: str === decoded ? 'pass' : 'fail'
                    });

                } catch (error) {
                    results.push({
                        test: 'ç¼–ç éªŒè¯',
                        result: `é”™è¯¯: ${error.message}`,
                        status: 'fail'
                    });
                }

                return results;
            }

            // éªŒè¯æ–‡ä»¶ç¼–ç 
            async validateFileEncoding(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const content = e.target.result;
                        const results = [];

                        // æ£€æŸ¥æ–‡ä»¶åŸºæœ¬ä¿¡æ¯
                        results.push({
                            test: 'æ–‡ä»¶å',
                            result: file.name,
                            status: 'pass'
                        });

                        results.push({
                            test: 'æ–‡ä»¶å¤§å°',
                            result: `${(file.size / 1024).toFixed(2)} KB`,
                            status: 'pass'
                        });

                        // æ£€æŸ¥å†…å®¹ç¼–ç 
                        try {
                            const stringResults = this.validateStringEncoding(content);
                            results.push(...stringResults);
                        } catch (error) {
                            results.push({
                                test: 'å†…å®¹ç¼–ç æ£€æŸ¥',
                                result: `é”™è¯¯: ${error.message}`,
                                status: 'fail'
                            });
                        }

                        resolve(results);
                    };
                    reader.onerror = () => {
                        resolve([{
                            test: 'æ–‡ä»¶è¯»å–',
                            result: 'è¯»å–å¤±è´¥',
                            status: 'fail'
                        }]);
                    };
                    reader.readAsText(file, 'UTF-8');
                });
            }

            // æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
            checkBrowserCompatibility() {
                const results = [];

                // æ£€æŸ¥TextEncoderæ”¯æŒ
                const hasTextEncoder = typeof TextEncoder !== 'undefined';
                results.push({
                    test: 'TextEncoderæ”¯æŒ',
                    result: hasTextEncoder ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ',
                    status: hasTextEncoder ? 'pass' : 'fail'
                });

                // æ£€æŸ¥Intlæ”¯æŒ
                const hasIntl = typeof Intl !== 'undefined';
                results.push({
                    test: 'Intl APIæ”¯æŒ',
                    result: hasIntl ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ',
                    status: hasIntl ? 'pass' : 'fail'
                });

                // æ£€æŸ¥Normalizeæ”¯æŒ
                const hasNormalize = typeof String.prototype.normalize === 'function';
                results.push({
                    test: 'String.normalizeæ”¯æŒ',
                    result: hasNormalize ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ',
                    status: hasNormalize ? 'pass' : 'warning'
                });

                // æ£€æŸ¥Fetch APIæ”¯æŒ
                const hasFetch = typeof fetch !== 'undefined';
                results.push({
                    test: 'Fetch APIæ”¯æŒ',
                    result: hasFetch ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ',
                    status: hasFetch ? 'pass' : 'warning'
                });

                return results;
            }

            // æ¸²æŸ“æµ‹è¯•ç»“æœ
            renderResults(results, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;

                let html = '';
                results.forEach(result => {
                    const statusClass = result.status === 'pass' ? 'test-pass' : 
                                       result.status === 'warning' ? 'test-warning' : 'test-fail';
                    const statusIcon = result.status === 'pass' ? 'fa-check-circle' : 
                                      result.status === 'warning' ? 'fa-exclamation-triangle' : 'fa-times-circle';
                    
                    html += `
                        <div class="test-result ${statusClass}">
                            <i class="fas ${statusIcon}"></i>
                            <strong>${result.test}:</strong> ${result.result}
                        </div>
                    `;
                });

                container.innerHTML = html;
            }
        }

        // åˆ›å»ºéªŒè¯å™¨å®ä¾‹
        const validator = new EncodingValidator();

        // ç³»ç»Ÿç¼–ç æ£€æŸ¥
        function checkSystemEncoding() {
            const results = validator.checkSystemEncoding();
            validator.renderResults(results, 'system-encoding-results');
        }

        // æ–‡ä»¶ç¼–ç éªŒè¯
        async function validateFileEncoding() {
            const fileInput = document.getElementById('file-input');
            const files = fileInput.files;
            
            if (files.length === 0) {
                alert('è¯·é€‰æ‹©è¦éªŒè¯çš„æ–‡ä»¶');
                return;
            }

            let allResults = [];
            for (let i = 0; i < files.length; i++) {
                const results = await validator.validateFileEncoding(files[i]);
                allResults.push(...results);
                if (i < files.length - 1) {
                    allResults.push({ test: '---', result: '---', status: 'pass' });
                }
            }

            validator.renderResults(allResults, 'file-encoding-results');
        }

        // å­—ç¬¦ä¸²ç¼–ç æµ‹è¯•
        function testStringEncoding() {
            const testString = document.getElementById('test-string').value;
            if (!testString.trim()) {
                alert('è¯·è¾“å…¥æµ‹è¯•å­—ç¬¦ä¸²');
                return;
            }

            const results = validator.validateStringEncoding(testString);
            validator.renderResults(results, 'string-encoding-results');
        }

        // URLç¼–ç æµ‹è¯•
        function testUrlEncoding() {
            const testUrl = document.getElementById('test-url').value;
            if (!testUrl.trim()) {
                alert('è¯·è¾“å…¥æµ‹è¯•URL');
                return;
            }

            const results = [];
            try {
                const encoded = encodeURIComponent(testUrl);
                const decoded = decodeURIComponent(encoded);
                
                results.push({
                    test: 'åŸå§‹URL',
                    result: testUrl,
                    status: 'pass'
                });

                results.push({
                    test: 'ç¼–ç åURL',
                    result: encoded,
                    status: 'pass'
                });

                results.push({
                    test: 'è§£ç åURL',
                    result: decoded,
                    status: testUrl === decoded ? 'pass' : 'fail'
                });

            } catch (error) {
                results.push({
                    test: 'URLç¼–ç æµ‹è¯•',
                    result: `é”™è¯¯: ${error.message}`,
                    status: 'fail'
                });
            }

            validator.renderResults(results, 'url-encoding-results');
        }

        // æµè§ˆå™¨å…¼å®¹æ€§æ£€æŸ¥
        function checkBrowserCompatibility() {
            const results = validator.checkBrowserCompatibility();
            validator.renderResults(results, 'browser-compatibility-results');
        }

        // ç”Ÿæˆç»¼åˆæŠ¥å‘Š
        function generateComprehensiveReport() {
            const report = {
                timestamp: new Date().toLocaleString('zh-CN'),
                system: validator.checkSystemEncoding(),
                browser: validator.checkBrowserCompatibility(),
                summary: {
                    totalTests: 0,
                    passedTests: 0,
                    warningTests: 0,
                    failedTests: 0
                }
            };

            // ç»Ÿè®¡æµ‹è¯•ç»“æœ
            [...report.system, ...report.browser].forEach(result => {
                report.summary.totalTests++;
                if (result.status === 'pass') report.summary.passedTests++;
                else if (result.status === 'warning') report.summary.warningTests++;
                else report.summary.failedTests++;
            });

            // æ¸²æŸ“æŠ¥å‘Š
            const reportHtml = `
                <div class="alert alert-primary">
                    <h5>ğŸ“Š éªŒè¯æŠ¥å‘Šæ‘˜è¦</h5>
                    <p><strong>ç”Ÿæˆæ—¶é—´:</strong> ${report.timestamp}</p>
                    <p><strong>æ€»æµ‹è¯•é¡¹:</strong> ${report.summary.totalTests}</p>
                    <p><strong>é€šè¿‡:</strong> <span class="text-success">${report.summary.passedTests}</span></p>
                    <p><strong>è­¦å‘Š:</strong> <span class="text-warning">${report.summary.warningTests}</span></p>
                    <p><strong>å¤±è´¥:</strong> <span class="text-danger">${report.summary.failedTests}</span></p>
                </div>
                <div class="code-display">
                    ${JSON.stringify(report, null, 2)}
                </div>
            `;

            document.getElementById('comprehensive-report').innerHTML = reportHtml;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemEncoding();
            checkBrowserCompatibility();
        });
    </script>
</body>
</html>
