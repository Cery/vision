<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品数据测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>产品数据测试</h1>
        <div class="row">
            <div class="col-md-6">
                <h3>数据加载器状态</h3>
                <div id="dataLoaderStatus" class="alert alert-info">检查中...</div>
            </div>
            <div class="col-md-6">
                <h3>产品数据</h3>
                <div id="productData" class="alert alert-secondary">加载中...</div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12">
                <h3>产品列表</h3>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>标题</th>
                            <th>型号</th>
                            <th>系列</th>
                            <th>供应商</th>
                            <th>分类</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody id="productList">
                        <tr>
                            <td colspan="7" class="text-center">加载中...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12">
                <button class="btn btn-primary" onclick="testAddProduct()">测试添加产品</button>
                <button class="btn btn-success" onclick="testLoadProducts()">重新加载产品</button>
                <button class="btn btn-info" onclick="testFilterProducts()">测试筛选</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="data-loader.js"></script>
    <script src="admin-functions.js"></script>
    
    <script>
        async function initTest() {
            console.log('开始测试...');
            
            // 检查数据加载器
            const statusDiv = document.getElementById('dataLoaderStatus');
            const dataDiv = document.getElementById('productData');
            
            try {
                // 初始化数据加载器
                if (typeof ContentDataLoader !== 'undefined') {
                    window.contentDataLoader = new ContentDataLoader();
                    await window.contentDataLoader.loadAllData();
                    statusDiv.className = 'alert alert-success';
                    statusDiv.textContent = '外部数据加载器初始化成功';
                } else {
                    statusDiv.className = 'alert alert-warning';
                    statusDiv.textContent = '外部数据加载器不可用，使用备用数据';
                    
                    // 创建备用数据结构
                    window.contentDataLoader = {
                        contentData: {
                            products: [
                                {
                                    id: 'test-product-1',
                                    title: '测试产品1',
                                    model: 'TEST-001',
                                    series: '测试系列',
                                    supplier: '测试供应商',
                                    primary_category: '电子内窥镜',
                                    secondary_category: '工业视频内窥镜',
                                    status: 'published',
                                    statusName: '已发布',
                                    published: new Date().toISOString(),
                                    thumbnail: '/images/placeholder.jpg',
                                    summary: '这是一个测试产品',
                                    featured: false
                                }
                            ]
                        }
                    };
                }
                
                // 显示产品数据
                const products = window.contentDataLoader.contentData.products;
                dataDiv.className = 'alert alert-success';
                dataDiv.textContent = `成功加载 ${products.length} 个产品`;
                
                // 渲染产品列表
                renderProductList(products);
                
            } catch (error) {
                console.error('测试失败:', error);
                statusDiv.className = 'alert alert-danger';
                statusDiv.textContent = `测试失败: ${error.message}`;
            }
        }
        
        function renderProductList(products) {
            const tbody = document.getElementById('productList');
            
            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">没有产品数据</td></tr>';
                return;
            }
            
            tbody.innerHTML = products.map(product => `
                <tr>
                    <td>${product.id}</td>
                    <td>${product.title}</td>
                    <td>${product.model}</td>
                    <td>${product.series || '未知'}</td>
                    <td>${product.supplier || '未知'}</td>
                    <td>${product.primary_category || '未知'}</td>
                    <td><span class="badge ${product.status === 'published' ? 'bg-success' : 'bg-warning'}">${product.statusName || product.status}</span></td>
                </tr>
            `).join('');
        }
        
        function testAddProduct() {
            if (typeof showAddProductModal === 'function') {
                showAddProductModal();
            } else {
                alert('添加产品功能不可用');
            }
        }
        
        function testLoadProducts() {
            if (typeof loadProductsList === 'function') {
                loadProductsList();
                alert('产品列表重新加载完成');
            } else {
                alert('加载产品功能不可用');
            }
        }
        
        function testFilterProducts() {
            if (typeof filterProducts === 'function') {
                filterProducts();
            } else {
                alert('筛选产品功能不可用');
            }
        }
        
        // 页面加载完成后初始化测试
        document.addEventListener('DOMContentLoaded', initTest);
    </script>
</body>
</html>
