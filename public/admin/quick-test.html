<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿæµ‹è¯• - äº§å“åˆ—è¡¨ä¿®å¤éªŒè¯</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 600px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 20px 0; }
        .success { border-left: 4px solid #28a745; background: #f8fff9; }
        .error { border-left: 4px solid #dc3545; background: #fff8f8; }
        .warning { border-left: 4px solid #ffc107; background: #fffbf0; }
        button { padding: 12px 24px; margin: 10px 5px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .result { margin: 15px 0; padding: 15px; border-radius: 4px; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ å¿«é€Ÿæµ‹è¯• - äº§å“åˆ—è¡¨ä¿®å¤éªŒè¯</h1>
        
        <div class="card">
            <h3>æµ‹è¯•è¯´æ˜</h3>
            <p>æ­¤é¡µé¢ç”¨äºå¿«é€ŸéªŒè¯äº§å“åˆ—è¡¨åŠ è½½ä¿®å¤æ˜¯å¦ç”Ÿæ•ˆã€‚</p>
            <p><strong>ä¿®å¤å†…å®¹ï¼š</strong></p>
            <ul>
                <li>åœ¨content-manager.htmlä¸­å†…è”äº†ContentDataLoaderç±»</li>
                <li>æ·»åŠ äº†å¼ºåˆ¶æ•°æ®åŠ è½½å™¨åˆå§‹åŒ–é€»è¾‘</li>
                <li>ä¿®å¤äº†æ•°æ®å­—æ®µæ˜ å°„é—®é¢˜</li>
                <li>å¢å¼ºäº†é”™è¯¯å¤„ç†æœºåˆ¶</li>
            </ul>
        </div>

        <div class="card">
            <h3>å¿«é€ŸéªŒè¯</h3>
            <button class="btn-primary" onclick="testContentDataLoader()">æµ‹è¯•ContentDataLoader</button>
            <button class="btn-success" onclick="testProductData()">æµ‹è¯•äº§å“æ•°æ®</button>
            <button class="btn-warning" onclick="openContentManager()">æ‰“å¼€å†…å®¹ç®¡ç†å™¨</button>
            <button class="btn-danger" onclick="clearCache()">æ¸…é™¤ç¼“å­˜</button>
        </div>

        <div class="card">
            <h3>æµ‹è¯•ç»“æœ</h3>
            <div id="testResults">
                <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
            </div>
        </div>

        <div class="card">
            <h3>æµ‹è¯•æ—¥å¿—</h3>
            <div id="testLog" class="log">
                ç­‰å¾…æµ‹è¯•å¼€å§‹...
            </div>
            <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <div class="card">
            <h3>éªŒè¯æ­¥éª¤</h3>
            <ol>
                <li><strong>æµ‹è¯•ContentDataLoaderï¼š</strong>éªŒè¯ç±»æ˜¯å¦æ­£ç¡®å®šä¹‰</li>
                <li><strong>æµ‹è¯•äº§å“æ•°æ®ï¼š</strong>éªŒè¯æ•°æ®æ˜¯å¦èƒ½æ­£ç¡®åŠ è½½</li>
                <li><strong>æ‰“å¼€å†…å®¹ç®¡ç†å™¨ï¼š</strong>åœ¨æ–°çª—å£ä¸­æ‰“å¼€å¹¶æµ‹è¯•äº§å“åˆ—è¡¨</li>
                <li><strong>éªŒè¯äº§å“åˆ—è¡¨ï¼š</strong>åœ¨å†…å®¹ç®¡ç†å™¨ä¸­ç‚¹å‡»"äº§å“åˆ—è¡¨"ï¼Œç¡®è®¤èƒ½æ­£å¸¸æ˜¾ç¤º</li>
            </ol>
        </div>
    </div>

    <script>
        let testLog = [];

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            testLog.push(logEntry);
            updateLogDisplay();
            console.log(logEntry);
        }

        function updateLogDisplay() {
            document.getElementById('testLog').textContent = testLog.join('\n');
        }

        function clearLog() {
            testLog = [];
            updateLogDisplay();
        }

        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('testResults');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning';
            resultDiv.innerHTML = `<div class="result ${className}">${message}</div>`;
        }

        async function testContentDataLoader() {
            addLog('å¼€å§‹æµ‹è¯•ContentDataLoaderç±»');
            showResult('ğŸ”„ æ­£åœ¨æµ‹è¯•ContentDataLoader...', 'warning');

            try {
                // åŠ¨æ€åŠ è½½content-manager.htmlä¸­çš„è„šæœ¬
                const response = await fetch('/admin/content-manager.html');
                const html = await response.text();
                
                // æ£€æŸ¥æ˜¯å¦åŒ…å«å†…è”çš„ContentDataLoader
                const hasInlineLoader = html.includes('class ContentDataLoader');
                
                if (hasInlineLoader) {
                    addLog('âœ… content-manager.htmlä¸­åŒ…å«å†…è”ContentDataLoaderç±»');
                    
                    // å°è¯•æ‰§è¡Œå†…è”è„šæœ¬
                    const scriptMatch = html.match(/<script>\s*\/\/ å†…è”ContentDataLoaderç±»[\s\S]*?<\/script>/);
                    if (scriptMatch) {
                        const scriptContent = scriptMatch[0].replace(/<\/?script[^>]*>/g, '');
                        eval(scriptContent);
                        
                        if (typeof ContentDataLoader !== 'undefined') {
                            addLog('âœ… ContentDataLoaderç±»æˆåŠŸåŠ è½½');
                            
                            // æµ‹è¯•å®ä¾‹åŒ–
                            const loader = new ContentDataLoader();
                            addLog('âœ… ContentDataLoaderå®ä¾‹åˆ›å»ºæˆåŠŸ');
                            
                            showResult('âœ… ContentDataLoaderæµ‹è¯•é€šè¿‡ï¼ç±»å·²æ­£ç¡®å®šä¹‰å¹¶å¯ä»¥å®ä¾‹åŒ–ã€‚', 'success');
                            return true;
                        } else {
                            throw new Error('ContentDataLoaderç±»æ‰§è¡Œåä»æœªå®šä¹‰');
                        }
                    } else {
                        throw new Error('æœªæ‰¾åˆ°å†…è”è„šæœ¬å†…å®¹');
                    }
                } else {
                    throw new Error('content-manager.htmlä¸­æœªæ‰¾åˆ°å†…è”ContentDataLoaderç±»');
                }

            } catch (error) {
                addLog(`âŒ ContentDataLoaderæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showResult(`âŒ ContentDataLoaderæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }

        async function testProductData() {
            addLog('å¼€å§‹æµ‹è¯•äº§å“æ•°æ®åŠ è½½');
            showResult('ğŸ”„ æ­£åœ¨æµ‹è¯•äº§å“æ•°æ®...', 'warning');

            try {
                // ç¡®ä¿ContentDataLoaderå¯ç”¨
                if (typeof ContentDataLoader === 'undefined') {
                    addLog('ContentDataLoaderæœªå®šä¹‰ï¼Œå…ˆè¿è¡ŒContentDataLoaderæµ‹è¯•');
                    const loaderTestResult = await testContentDataLoader();
                    if (!loaderTestResult) {
                        throw new Error('ContentDataLoaderæµ‹è¯•å¤±è´¥ï¼Œæ— æ³•ç»§ç»­');
                    }
                }

                // åˆ›å»ºæ•°æ®åŠ è½½å™¨å®ä¾‹
                const loader = new ContentDataLoader();
                addLog('åˆ›å»ºContentDataLoaderå®ä¾‹');

                // åŠ è½½æ•°æ®
                await loader.loadAllData();
                addLog('æ•°æ®åŠ è½½å®Œæˆ');

                // æ£€æŸ¥äº§å“æ•°æ®
                const products = loader.contentData?.products || [];
                addLog(`äº§å“æ•°é‡: ${products.length}`);

                if (products.length > 0) {
                    addLog(`ç¬¬ä¸€ä¸ªäº§å“: ${products[0].title}`);
                    addLog(`äº§å“å­—æ®µ: ${Object.keys(products[0]).join(', ')}`);
                    
                    // æ£€æŸ¥å…³é”®å­—æ®µ
                    const firstProduct = products[0];
                    const hasRequiredFields = firstProduct.id && firstProduct.title && firstProduct.model;
                    
                    if (hasRequiredFields) {
                        addLog('âœ… äº§å“æ•°æ®ç»“æ„éªŒè¯é€šè¿‡');
                        showResult(`âœ… äº§å“æ•°æ®æµ‹è¯•é€šè¿‡ï¼æˆåŠŸåŠ è½½${products.length}ä¸ªäº§å“ï¼Œæ•°æ®ç»“æ„å®Œæ•´ã€‚`, 'success');
                        return true;
                    } else {
                        throw new Error('äº§å“æ•°æ®ç¼ºå°‘å¿…éœ€å­—æ®µ');
                    }
                } else {
                    throw new Error('æ²¡æœ‰åŠ è½½åˆ°äº§å“æ•°æ®');
                }

            } catch (error) {
                addLog(`âŒ äº§å“æ•°æ®æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showResult(`âŒ äº§å“æ•°æ®æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }

        function openContentManager() {
            addLog('æ‰“å¼€å†…å®¹ç®¡ç†å™¨è¿›è¡Œæ‰‹åŠ¨éªŒè¯');
            showResult('ğŸ“– å·²åœ¨æ–°çª—å£ä¸­æ‰“å¼€å†…å®¹ç®¡ç†å™¨ï¼Œè¯·æ‰‹åŠ¨ç‚¹å‡»"äº§å“åˆ—è¡¨"è¿›è¡ŒéªŒè¯ã€‚', 'warning');
            window.open('/admin/content-manager.html', '_blank');
        }

        function clearCache() {
            addLog('æ¸…é™¤æµè§ˆå™¨ç¼“å­˜');
            showResult('ğŸ”„ æ­£åœ¨æ¸…é™¤ç¼“å­˜...', 'warning');
            
            // æ¸…é™¤å¯èƒ½çš„å…¨å±€å˜é‡
            if (window.ContentDataLoader) {
                delete window.ContentDataLoader;
                addLog('æ¸…é™¤å…¨å±€ContentDataLoader');
            }
            if (window.contentDataLoader) {
                delete window.contentDataLoader;
                addLog('æ¸…é™¤å…¨å±€contentDataLoaderå®ä¾‹');
            }

            // æç¤ºç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°
            setTimeout(() => {
                showResult('âœ… ç¼“å­˜æ¸…é™¤å®Œæˆã€‚å»ºè®®æ‰‹åŠ¨åˆ·æ–°æµè§ˆå™¨é¡µé¢ä»¥ç¡®ä¿ä½¿ç”¨æœ€æ–°ä»£ç ã€‚', 'success');
                addLog('ç¼“å­˜æ¸…é™¤å®Œæˆ');
            }, 1000);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            addLog('å¿«é€Ÿæµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            addLog('å‡†å¤‡è¿›è¡Œäº§å“åˆ—è¡¨ä¿®å¤éªŒè¯');
            
            // æ˜¾ç¤ºå½“å‰çŠ¶æ€
            showResult('ğŸ”§ äº§å“åˆ—è¡¨ä¿®å¤éªŒè¯å·¥å…·å·²å°±ç»ªã€‚ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•ã€‚', 'warning');
        });
    </script>
</body>
</html>
