<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åŒ¹é…éªŒè¯æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 20px 0; }
        .success { border-left: 4px solid #28a745; background: #f8fff9; }
        .error { border-left: 4px solid #dc3545; background: #fff8f8; }
        .warning { border-left: 4px solid #ffc107; background: #fffbf0; }
        .info { border-left: 4px solid #17a2b8; background: #f0f9ff; }
        button { padding: 12px 24px; margin: 10px 5px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .data-section { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; }
        .data-title { font-weight: bold; color: #495057; margin-bottom: 10px; }
        .data-count { font-size: 2em; font-weight: bold; color: #007bff; }
        .data-details { font-size: 0.9em; color: #6c757d; margin-top: 5px; }
        .comparison-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .comparison-table th, .comparison-table td { padding: 8px 12px; border: 1px solid #dee2e6; text-align: left; }
        .comparison-table th { background: #e9ecef; font-weight: bold; }
        .match { color: #28a745; font-weight: bold; }
        .mismatch { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ•°æ®åŒ¹é…éªŒè¯æµ‹è¯•</h1>
        
        <div class="card">
            <h3>æµ‹è¯•ç›®æ ‡</h3>
            <p>éªŒè¯å†…å®¹ç®¡ç†ç³»ç»Ÿçš„æ•°æ®æ˜¯å¦ä¸å‰å°å®é™…å†…å®¹å®Œå…¨åŒ¹é…ï¼š</p>
            <ul>
                <li><strong>äº§å“æ•°æ®</strong>: åº”æ˜¾ç¤º33ä¸ªäº§å“</li>
                <li><strong>èµ„è®¯æ•°æ®</strong>: åº”æ˜¾ç¤º14æ¡èµ„è®¯</li>
                <li><strong>æ¡ˆä¾‹æ•°æ®</strong>: åº”æ˜¾ç¤º8ä¸ªæ¡ˆä¾‹</li>
                <li><strong>åº”ç”¨é¢†åŸŸ</strong>: åº”æ˜¾ç¤º6ä¸ªé¢†åŸŸ</li>
                <li><strong>äº§å“åˆ†ç±»</strong>: åº”æ˜¾ç¤º6ä¸ªåˆ†ç±»</li>
                <li><strong>ä¾›åº”å•†</strong>: åº”æ˜¾ç¤º2ä¸ªä¾›åº”å•†</li>
                <li><strong>æ–°å“æ¨è</strong>: åº”æ˜¾ç¤º6ä¸ªæ¨èäº§å“</li>
            </ul>
        </div>

        <div class="card">
            <h3>æµ‹è¯•æ“ä½œ</h3>
            <button class="btn-primary" onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <button class="btn-success" onclick="openContentManager()">æ‰“å¼€å†…å®¹ç®¡ç†å™¨</button>
        </div>

        <div class="card">
            <h3>æµ‹è¯•ç»“æœæ€»è§ˆ</h3>
            <div id="testSummary">
                <p>ç‚¹å‡»"è¿è¡Œå®Œæ•´æµ‹è¯•"å¼€å§‹éªŒè¯...</p>
            </div>
        </div>

        <div class="card">
            <h3>è¯¦ç»†æ•°æ®ç»Ÿè®¡</h3>
            <div id="dataStats" class="data-grid">
                <div class="data-section">
                    <div class="data-title">ç­‰å¾…æµ‹è¯•...</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>æ•°æ®åŒ¹é…å¯¹æ¯”</h3>
            <div id="comparisonResults">
                <p>ç­‰å¾…æµ‹è¯•ç»“æœ...</p>
            </div>
        </div>
    </div>

    <script>
        const expectedCounts = {
            products: 33,
            news: 14,
            cases: 8,
            applications: 6,
            categories: 6,
            suppliers: 2,
            featured_products: 6
        };

        async function runFullTest() {
            const summaryDiv = document.getElementById('testSummary');
            const statsDiv = document.getElementById('dataStats');
            const comparisonDiv = document.getElementById('comparisonResults');
            
            summaryDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨è¿è¡Œå®Œæ•´æµ‹è¯•...</p>';
            statsDiv.innerHTML = '<div class="data-section"><div class="data-title">æ­£åœ¨åŠ è½½æ•°æ®...</div></div>';
            comparisonDiv.innerHTML = '<p>æ­£åœ¨åˆ†ææ•°æ®åŒ¹é…æƒ…å†µ...</p>';

            try {
                // æ£€æŸ¥ContentDataLoaderæ˜¯å¦å¯ç”¨
                if (typeof ContentDataLoader === 'undefined') {
                    console.log('ContentDataLoaderæœªå®šä¹‰ï¼Œå°è¯•ä»content-manager.htmlåŠ è½½...');
                    
                    const response = await fetch('/admin/content-manager.html');
                    const html = await response.text();
                    
                    const scriptMatch = html.match(/<script>\s*\/\/ å†…è”ContentDataLoaderç±»[\s\S]*?<\/script>/);
                    if (scriptMatch) {
                        const scriptContent = scriptMatch[0].replace(/<\/?script[^>]*>/g, '');
                        eval(scriptContent);
                        console.log('ContentDataLoaderå·²ä»content-manager.htmlåŠ è½½');
                    } else {
                        throw new Error('æ— æ³•ä»content-manager.htmlæå–ContentDataLoader');
                    }
                }

                // åˆ›å»ºæ•°æ®åŠ è½½å™¨å®ä¾‹
                const loader = new ContentDataLoader();
                console.log('ContentDataLoaderå®ä¾‹å·²åˆ›å»º');

                // åŠ è½½æ‰€æœ‰æ•°æ®
                await loader.loadAllData();
                console.log('æ•°æ®åŠ è½½å®Œæˆ');

                const actualData = loader.contentData;
                console.log('å®é™…æ•°æ®:', actualData);

                // ç»Ÿè®¡å®é™…æ•°æ®
                const actualCounts = {
                    products: actualData.products?.length || 0,
                    news: actualData.news?.length || 0,
                    cases: actualData.cases?.length || 0,
                    applications: actualData.applications?.length || 0,
                    categories: actualData.categories?.length || 0,
                    suppliers: actualData.suppliers?.length || 0,
                    featured_products: actualData.featured_products?.length || 0
                };

                // æ˜¾ç¤ºæ•°æ®ç»Ÿè®¡
                displayDataStats(actualCounts);

                // æ˜¾ç¤ºåŒ¹é…å¯¹æ¯”
                displayComparison(actualCounts);

                // æ˜¾ç¤ºæµ‹è¯•æ€»ç»“
                displayTestSummary(actualCounts);

            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                summaryDiv.innerHTML = `
                    <div class="error">
                        <h4>âŒ æµ‹è¯•å¤±è´¥</h4>
                        <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                        <p>è¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚</p>
                    </div>
                `;
                statsDiv.innerHTML = '<div class="data-section"><div class="data-title">æµ‹è¯•å¤±è´¥</div></div>';
                comparisonDiv.innerHTML = '<p>æµ‹è¯•å¤±è´¥ï¼Œæ— æ³•è·å–æ•°æ®</p>';
            }
        }

        function displayDataStats(actualCounts) {
            const statsDiv = document.getElementById('dataStats');
            
            const statsHTML = Object.entries(actualCounts).map(([key, count]) => {
                const expected = expectedCounts[key];
                const isMatch = count === expected;
                const statusClass = isMatch ? 'success' : 'warning';
                const statusIcon = isMatch ? 'âœ…' : 'âš ï¸';
                
                return `
                    <div class="data-section ${statusClass}">
                        <div class="data-title">${getDataTypeName(key)} ${statusIcon}</div>
                        <div class="data-count">${count}</div>
                        <div class="data-details">
                            é¢„æœŸ: ${expected} | å®é™…: ${count}
                            ${isMatch ? '<br>âœ… åŒ¹é…' : '<br>âš ï¸ ä¸åŒ¹é…'}
                        </div>
                    </div>
                `;
            }).join('');
            
            statsDiv.innerHTML = statsHTML;
        }

        function displayComparison(actualCounts) {
            const comparisonDiv = document.getElementById('comparisonResults');
            
            const tableRows = Object.entries(actualCounts).map(([key, actual]) => {
                const expected = expectedCounts[key];
                const isMatch = actual === expected;
                const statusClass = isMatch ? 'match' : 'mismatch';
                const statusText = isMatch ? 'âœ… åŒ¹é…' : 'âŒ ä¸åŒ¹é…';
                
                return `
                    <tr>
                        <td>${getDataTypeName(key)}</td>
                        <td>${expected}</td>
                        <td>${actual}</td>
                        <td class="${statusClass}">${statusText}</td>
                    </tr>
                `;
            }).join('');
            
            comparisonDiv.innerHTML = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>æ•°æ®ç±»å‹</th>
                            <th>é¢„æœŸæ•°é‡</th>
                            <th>å®é™…æ•°é‡</th>
                            <th>åŒ¹é…çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
            `;
        }

        function displayTestSummary(actualCounts) {
            const summaryDiv = document.getElementById('testSummary');
            
            const totalExpected = Object.values(expectedCounts).reduce((sum, count) => sum + count, 0);
            const totalActual = Object.values(actualCounts).reduce((sum, count) => sum + count, 0);
            const matchCount = Object.entries(actualCounts).filter(([key, actual]) => actual === expectedCounts[key]).length;
            const totalTypes = Object.keys(expectedCounts).length;
            
            const overallMatch = matchCount === totalTypes;
            const summaryClass = overallMatch ? 'success' : 'warning';
            const summaryIcon = overallMatch ? 'âœ…' : 'âš ï¸';
            
            summaryDiv.innerHTML = `
                <div class="${summaryClass}">
                    <h4>${summaryIcon} æµ‹è¯•å®Œæˆ</h4>
                    <p><strong>åŒ¹é…æƒ…å†µ:</strong> ${matchCount}/${totalTypes} ä¸ªæ•°æ®ç±»å‹åŒ¹é…</p>
                    <p><strong>æ€»æ•°æ®é‡:</strong> é¢„æœŸ ${totalExpected} æ¡ï¼Œå®é™… ${totalActual} æ¡</p>
                    ${overallMatch ? 
                        '<p>ğŸ‰ æ‰€æœ‰æ•°æ®ç±»å‹éƒ½ä¸é¢„æœŸåŒ¹é…ï¼å†…å®¹ç®¡ç†ç³»ç»Ÿæ•°æ®å®Œæ•´ã€‚</p>' : 
                        '<p>âš ï¸ éƒ¨åˆ†æ•°æ®ç±»å‹ä¸åŒ¹é…ï¼Œéœ€è¦è¿›ä¸€æ­¥è°ƒæ•´ã€‚</p>'
                    }
                </div>
            `;
        }

        function getDataTypeName(key) {
            const names = {
                products: 'äº§å“',
                news: 'èµ„è®¯',
                cases: 'æ¡ˆä¾‹',
                applications: 'åº”ç”¨é¢†åŸŸ',
                categories: 'äº§å“åˆ†ç±»',
                suppliers: 'ä¾›åº”å•†',
                featured_products: 'æ–°å“æ¨è'
            };
            return names[key] || key;
        }

        function openContentManager() {
            window.open('/admin/content-manager.html', '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ•°æ®åŒ¹é…éªŒè¯æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // å»¶è¿Ÿ1ç§’åè‡ªåŠ¨è¿è¡Œæµ‹è¯•
            setTimeout(() => {
                runFullTest();
            }, 1000);
        });
    </script>
</body>
</html>
