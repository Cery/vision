<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisNDT 统一图片管理器</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            padding: 1rem;
        }
        
        .image-card {
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .image-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .image-preview {
            width: 100%;
            height: 150px;
            object-fit: cover;
            background: #f8f9fa;
        }
        
        .image-info {
            padding: 0.75rem;
        }
        
        .image-name {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .image-meta {
            font-size: 0.75rem;
            color: #6c757d;
            margin-bottom: 0.5rem;
        }
        
        .image-actions {
            display: flex;
            gap: 0.25rem;
        }
        
        .upload-zone {
            border: 2px dashed #dee2e6;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            transition: border-color 0.2s;
            cursor: pointer;
        }
        
        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: #0d6efd;
            background-color: #f8f9ff;
        }
        
        .category-filter {
            background: #f8f9fa;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .placeholder-preview {
            background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), 
                        linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f0f0f0 75%), 
                        linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        .status-indicator {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-local { background-color: #28a745; }
        .status-placeholder { background-color: #ffc107; }
        .status-external { background-color: #dc3545; }
        .status-optimized { background-color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <header class="bg-primary text-white py-3 mb-4">
            <div class="container">
                <h1 class="h3 mb-0">
                    <i class="bi bi-images"></i>
                    VisNDT 统一图片管理器
                </h1>
                <p class="mb-0 opacity-75">集中管理、优化和替换项目中的所有图片资源</p>
            </div>
        </header>

        <div class="container">
            <!-- 工具栏 -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <div class="category-filter">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <label class="form-label">分类筛选</label>
                                <select class="form-select" id="categoryFilter">
                                    <option value="">全部分类</option>
                                    <option value="products">产品图片</option>
                                    <option value="news">新闻图片</option>
                                    <option value="cases">案例图片</option>
                                    <option value="carousel">轮播图</option>
                                    <option value="placeholders">占位图</option>
                                    <option value="uploads">上传文件</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">状态筛选</label>
                                <select class="form-select" id="statusFilter">
                                    <option value="">全部状态</option>
                                    <option value="local">本地图片</option>
                                    <option value="placeholder">占位图</option>
                                    <option value="external">外部链接</option>
                                    <option value="optimized">已优化</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">搜索</label>
                                <input type="text" class="form-control" id="searchInput" placeholder="搜索图片名称...">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">&nbsp;</label>
                                <button class="btn btn-outline-primary w-100" onclick="refreshImageList()">
                                    <i class="bi bi-arrow-clockwise"></i> 刷新
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="d-grid gap-2">
                        <button class="btn btn-success" onclick="showUploadModal()">
                            <i class="bi bi-cloud-upload"></i> 上传图片
                        </button>
                        <button class="btn btn-warning" onclick="generatePlaceholders()">
                            <i class="bi bi-image"></i> 生成占位图
                        </button>
                        <button class="btn btn-info" onclick="optimizeImages()">
                            <i class="bi bi-gear"></i> 批量优化
                        </button>
                    </div>
                </div>
            </div>

            <!-- 统计信息 -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title text-primary" id="totalImages">0</h5>
                            <p class="card-text">总图片数</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title text-success" id="localImages">0</h5>
                            <p class="card-text">本地图片</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title text-warning" id="placeholderImages">0</h5>
                            <p class="card-text">占位图片</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title text-danger" id="externalImages">0</h5>
                            <p class="card-text">外部链接</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 图片网格 -->
            <div class="image-grid" id="imageGrid">
                <!-- 图片卡片将通过 JavaScript 动态生成 -->
            </div>

            <!-- 加载状态 -->
            <div class="text-center py-5" id="loadingState">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">加载中...</span>
                </div>
                <p class="mt-2">正在加载图片...</p>
            </div>

            <!-- 空状态 -->
            <div class="text-center py-5 d-none" id="emptyState">
                <i class="bi bi-images display-1 text-muted"></i>
                <h4 class="text-muted">没有找到图片</h4>
                <p class="text-muted">尝试调整筛选条件或上传新图片</p>
            </div>
        </div>
    </div>

    <!-- 上传模态框 -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">上传图片</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="upload-zone" id="uploadZone">
                        <i class="bi bi-cloud-upload display-4 text-muted"></i>
                        <h5 class="mt-3">拖拽图片到这里或点击选择</h5>
                        <p class="text-muted">支持 JPG、PNG、GIF、WebP 格式，最大 10MB</p>
                        <input type="file" id="fileInput" multiple accept="image/*" class="d-none">
                    </div>
                    
                    <div class="mt-3">
                        <label class="form-label">分类</label>
                        <select class="form-select" id="uploadCategory">
                            <option value="general">通用</option>
                            <option value="products">产品</option>
                            <option value="news">新闻</option>
                            <option value="cases">案例</option>
                            <option value="carousel">轮播</option>
                        </select>
                    </div>
                    
                    <div class="mt-3" id="uploadProgress" style="display: none;">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <small class="text-muted">上传进度</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="startUpload()">开始上传</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 图片详情模态框 -->
    <div class="modal fade" id="imageDetailModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageDetailTitle">图片详情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <img id="imageDetailPreview" class="img-fluid rounded" alt="图片预览">
                        </div>
                        <div class="col-md-4">
                            <div id="imageDetailInfo">
                                <!-- 图片信息将通过 JavaScript 填充 -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="deleteImage()">
                        <i class="bi bi-trash"></i> 删除
                    </button>
                    <button type="button" class="btn btn-warning" onclick="optimizeImage()">
                        <i class="bi bi-gear"></i> 优化
                    </button>
                    <button type="button" class="btn btn-primary" onclick="copyImagePath()">
                        <i class="bi bi-clipboard"></i> 复制路径
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 图片管理器主要功能
        class UnifiedImageManager {
            constructor() {
                this.images = [];
                this.filteredImages = [];
                this.currentImage = null;
                this.init();
            }

            async init() {
                await this.loadImages();
                this.setupEventListeners();
                this.renderImages();
                this.updateStats();
            }

            async loadImages() {
                try {
                    // 这里应该调用实际的 API 来获取图片列表
                    // 现在使用模拟数据
                    this.images = await this.getMockImageData();
                    this.filteredImages = [...this.images];
                } catch (error) {
                    console.error('加载图片失败:', error);
                    this.showError('加载图片失败');
                }
            }

            async getMockImageData() {
                // 模拟图片数据
                return [
                    {
                        id: 1,
                        name: 'product-main.jpg',
                        path: '/images/products/product-main.jpg',
                        category: 'products',
                        status: 'local',
                        size: 245760,
                        dimensions: '800x600',
                        modified: '2024-01-15T10:30:00Z'
                    },
                    {
                        id: 2,
                        name: 'placeholder-k-series.svg',
                        path: '/images/placeholders/K-series/product-main-800x600.svg',
                        category: 'placeholders',
                        status: 'placeholder',
                        size: 2048,
                        dimensions: '800x600',
                        modified: '2024-01-15T10:30:00Z'
                    }
                    // 更多模拟数据...
                ];
            }

            setupEventListeners() {
                // 筛选和搜索
                document.getElementById('categoryFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('statusFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('searchInput').addEventListener('input', () => this.applyFilters());

                // 上传相关
                const uploadZone = document.getElementById('uploadZone');
                const fileInput = document.getElementById('fileInput');

                uploadZone.addEventListener('click', () => fileInput.click());
                uploadZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadZone.classList.add('dragover');
                });
                uploadZone.addEventListener('dragleave', () => {
                    uploadZone.classList.remove('dragover');
                });
                uploadZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadZone.classList.remove('dragover');
                    this.handleFilesDrop(e.dataTransfer.files);
                });

                fileInput.addEventListener('change', (e) => {
                    this.handleFilesDrop(e.target.files);
                });
            }

            applyFilters() {
                const category = document.getElementById('categoryFilter').value;
                const status = document.getElementById('statusFilter').value;
                const search = document.getElementById('searchInput').value.toLowerCase();

                this.filteredImages = this.images.filter(image => {
                    const matchCategory = !category || image.category === category;
                    const matchStatus = !status || image.status === status;
                    const matchSearch = !search || image.name.toLowerCase().includes(search);
                    
                    return matchCategory && matchStatus && matchSearch;
                });

                this.renderImages();
                this.updateStats();
            }

            renderImages() {
                const grid = document.getElementById('imageGrid');
                const loadingState = document.getElementById('loadingState');
                const emptyState = document.getElementById('emptyState');

                loadingState.style.display = 'none';

                if (this.filteredImages.length === 0) {
                    grid.innerHTML = '';
                    emptyState.classList.remove('d-none');
                    return;
                }

                emptyState.classList.add('d-none');
                
                grid.innerHTML = this.filteredImages.map(image => this.createImageCard(image)).join('');
            }

            createImageCard(image) {
                const statusClass = `status-${image.status}`;
                const sizeText = this.formatFileSize(image.size);
                
                return `
                    <div class="image-card position-relative" onclick="showImageDetail(${image.id})">
                        <div class="status-indicator ${statusClass}" title="${this.getStatusText(image.status)}"></div>
                        <img src="${image.path}" alt="${image.name}" class="image-preview" 
                             onerror="this.src='/images/placeholder.svg'">
                        <div class="image-info">
                            <div class="image-name" title="${image.name}">${image.name}</div>
                            <div class="image-meta">${image.dimensions} • ${sizeText}</div>
                            <div class="image-actions">
                                <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); copyImagePath('${image.path}')">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-warning" onclick="event.stopPropagation(); optimizeImage(${image.id})">
                                    <i class="bi bi-gear"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="event.stopPropagation(); deleteImage(${image.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            updateStats() {
                const stats = this.calculateStats();
                document.getElementById('totalImages').textContent = stats.total;
                document.getElementById('localImages').textContent = stats.local;
                document.getElementById('placeholderImages').textContent = stats.placeholder;
                document.getElementById('externalImages').textContent = stats.external;
            }

            calculateStats() {
                return {
                    total: this.filteredImages.length,
                    local: this.filteredImages.filter(img => img.status === 'local').length,
                    placeholder: this.filteredImages.filter(img => img.status === 'placeholder').length,
                    external: this.filteredImages.filter(img => img.status === 'external').length
                };
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            getStatusText(status) {
                const statusTexts = {
                    local: '本地图片',
                    placeholder: '占位图片',
                    external: '外部链接',
                    optimized: '已优化'
                };
                return statusTexts[status] || status;
            }

            handleFilesDrop(files) {
                console.log('处理文件:', files);
                // 实现文件上传逻辑
            }

            showError(message) {
                // 显示错误消息
                console.error(message);
            }
        }

        // 全局函数
        let imageManager;

        document.addEventListener('DOMContentLoaded', () => {
            imageManager = new UnifiedImageManager();
        });

        function refreshImageList() {
            imageManager.loadImages();
        }

        function showUploadModal() {
            new bootstrap.Modal(document.getElementById('uploadModal')).show();
        }

        function showImageDetail(imageId) {
            const image = imageManager.images.find(img => img.id === imageId);
            if (image) {
                imageManager.currentImage = image;
                document.getElementById('imageDetailTitle').textContent = image.name;
                document.getElementById('imageDetailPreview').src = image.path;
                
                const info = `
                    <h6>基本信息</h6>
                    <p><strong>文件名:</strong> ${image.name}</p>
                    <p><strong>路径:</strong> ${image.path}</p>
                    <p><strong>分类:</strong> ${image.category}</p>
                    <p><strong>状态:</strong> ${imageManager.getStatusText(image.status)}</p>
                    <p><strong>尺寸:</strong> ${image.dimensions}</p>
                    <p><strong>大小:</strong> ${imageManager.formatFileSize(image.size)}</p>
                    <p><strong>修改时间:</strong> ${new Date(image.modified).toLocaleString()}</p>
                `;
                document.getElementById('imageDetailInfo').innerHTML = info;
                
                new bootstrap.Modal(document.getElementById('imageDetailModal')).show();
            }
        }

        function copyImagePath(path) {
            navigator.clipboard.writeText(path || imageManager.currentImage?.path).then(() => {
                // 显示复制成功提示
                console.log('路径已复制:', path);
            });
        }

        function deleteImage(imageId) {
            if (confirm('确定要删除这张图片吗？')) {
                // 实现删除逻辑
                console.log('删除图片:', imageId);
            }
        }

        function optimizeImage(imageId) {
            // 实现图片优化逻辑
            console.log('优化图片:', imageId);
        }

        function generatePlaceholders() {
            // 调用占位图生成脚本
            console.log('生成占位图');
        }

        function optimizeImages() {
            // 调用批量优化脚本
            console.log('批量优化图片');
        }

        function startUpload() {
            // 实现上传逻辑
            console.log('开始上传');
        }
    </script>
</body>
</html>
