<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº§å“æ•°æ®è°ƒè¯• - VisNDTç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .debug-section {
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .debug-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 0.5rem;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 0.25rem;
            padding: 0.75rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <h2 class="mb-4">
                    <i class="fas fa-bug me-2"></i>äº§å“æ•°æ®è°ƒè¯•å·¥å…·
                </h2>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="debug-section">
                            <div class="debug-title">æ•°æ®åŠ è½½å™¨çŠ¶æ€</div>
                            <div id="dataLoaderStatus" class="code-block">æ£€æŸ¥ä¸­...</div>
                        </div>
                        
                        <div class="debug-section">
                            <div class="debug-title">äº§å“æ•°æ®è¯¦æƒ…</div>
                            <div id="productDetails" class="code-block">åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="debug-section">
                            <div class="debug-title">æ§åˆ¶é¢æ¿</div>
                            <div class="d-grid gap-2">
                                <button class="btn btn-primary" onclick="initializeDataLoader()">
                                    <i class="fas fa-play me-1"></i>åˆå§‹åŒ–æ•°æ®åŠ è½½å™¨
                                </button>
                                <button class="btn btn-success" onclick="loadProducts()">
                                    <i class="fas fa-download me-1"></i>åŠ è½½äº§å“æ•°æ®
                                </button>
                                <button class="btn btn-info" onclick="testAdminFunctions()">
                                    <i class="fas fa-test-tube me-1"></i>æµ‹è¯•Admin Functions
                                </button>
                                <button class="btn btn-warning" onclick="clearData()">
                                    <i class="fas fa-trash me-1"></i>æ¸…é™¤æ•°æ®
                                </button>
                                <button class="btn btn-secondary" onclick="refreshDebug()">
                                    <i class="fas fa-refresh me-1"></i>åˆ·æ–°è°ƒè¯•ä¿¡æ¯
                                </button>
                            </div>
                        </div>
                        
                        <div class="debug-section">
                            <div class="debug-title">æµ‹è¯•ç»“æœ</div>
                            <div id="testResults" class="code-block">ç­‰å¾…æµ‹è¯•...</div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="debug-section">
                            <div class="debug-title">äº§å“åˆ—è¡¨é¢„è§ˆ</div>
                            <div class="table-responsive">
                                <table class="table table-sm table-striped">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>æ ‡é¢˜</th>
                                            <th>å‹å·</th>
                                            <th>ç³»åˆ—</th>
                                            <th>çŠ¶æ€</th>
                                            <th>æ¨è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productPreview">
                                        <tr><td colspan="6" class="text-center">æš‚æ— æ•°æ®</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="data-loader.js"></script>
    <script>
        let debugLog = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push(`[${timestamp}] ${message}`);
            console.log(message);
            updateDebugDisplay();
        }
        
        function updateDebugDisplay() {
            document.getElementById('testResults').textContent = debugLog.join('\n');
        }
        
        function updateDataLoaderStatus() {
            const status = document.getElementById('dataLoaderStatus');
            
            if (!window.ContentDataLoader) {
                status.textContent = 'âŒ ContentDataLoader ç±»æœªæ‰¾åˆ°';
                return;
            }
            
            if (!window.contentDataLoader) {
                status.textContent = 'âš ï¸ contentDataLoader å®ä¾‹æœªåˆ›å»º';
                return;
            }
            
            const loader = window.contentDataLoader;
            const info = {
                'å®ä¾‹çŠ¶æ€': 'âœ… å·²åˆ›å»º',
                'å†…å®¹æ•°æ®': loader.contentData ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½',
                'äº§å“æ•°æ®': loader.contentData?.products ? `âœ… ${loader.contentData.products.length} ä¸ªäº§å“` : 'âŒ æ— äº§å“æ•°æ®',
                'åŸºç¡€URL': loader.baseUrl || 'æœªè®¾ç½®'
            };
            
            status.textContent = Object.entries(info).map(([key, value]) => `${key}: ${value}`).join('\n');
        }
        
        function updateProductDetails() {
            const details = document.getElementById('productDetails');
            
            if (!window.contentDataLoader?.contentData?.products) {
                details.textContent = 'æ— äº§å“æ•°æ®';
                return;
            }
            
            const products = window.contentDataLoader.contentData.products;
            const summary = {
                'æ€»æ•°': products.length,
                'å·²å‘å¸ƒ': products.filter(p => p.status === 'published').length,
                'è‰ç¨¿': products.filter(p => p.status === 'draft').length,
                'æ¨è': products.filter(p => p.featured).length,
                'Kç³»åˆ—': products.filter(p => p.series === 'Kç³»åˆ—').length,
                'Pç³»åˆ—': products.filter(p => p.series === 'Pç³»åˆ—').length,
                'DZç³»åˆ—': products.filter(p => p.series === 'DZç³»åˆ—').length
            };
            
            details.textContent = Object.entries(summary).map(([key, value]) => `${key}: ${value}`).join('\n');
        }
        
        function updateProductPreview() {
            const tbody = document.getElementById('productPreview');
            
            if (!window.contentDataLoader?.contentData?.products) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">æ— äº§å“æ•°æ®</td></tr>';
                return;
            }
            
            const products = window.contentDataLoader.contentData.products;
            tbody.innerHTML = products.map(product => `
                <tr>
                    <td><code>${product.id}</code></td>
                    <td>${product.title}</td>
                    <td>${product.model}</td>
                    <td>${product.series || '-'}</td>
                    <td><span class="badge ${product.status === 'published' ? 'bg-success' : 'bg-warning'}">${product.status}</span></td>
                    <td>${product.featured ? '<i class="fas fa-star text-warning"></i>' : '-'}</td>
                </tr>
            `).join('');
        }
        
        async function initializeDataLoader() {
            try {
                log('å¼€å§‹åˆå§‹åŒ–æ•°æ®åŠ è½½å™¨...');
                
                if (!window.ContentDataLoader) {
                    throw new Error('ContentDataLoader ç±»æœªæ‰¾åˆ°');
                }
                
                window.contentDataLoader = new ContentDataLoader();
                log('âœ… æ•°æ®åŠ è½½å™¨å®ä¾‹å·²åˆ›å»º');
                
                await window.contentDataLoader.loadAllData();
                log('âœ… æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆ');
                
                refreshDebug();
                
            } catch (error) {
                log(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
            }
        }
        
        async function loadProducts() {
            try {
                log('å¼€å§‹åŠ è½½äº§å“æ•°æ®...');
                
                if (!window.contentDataLoader) {
                    throw new Error('æ•°æ®åŠ è½½å™¨æœªåˆå§‹åŒ–');
                }
                
                await window.contentDataLoader.loadProducts();
                log('âœ… äº§å“æ•°æ®åŠ è½½å®Œæˆ');
                
                refreshDebug();
                
            } catch (error) {
                log(`âŒ äº§å“åŠ è½½å¤±è´¥: ${error.message}`);
            }
        }
        
        function testAdminFunctions() {
            try {
                log('æµ‹è¯• Admin Functions å…¼å®¹æ€§...');
                
                // æµ‹è¯•æ•°æ®è®¿é—®
                const dataLoader = window.contentDataLoader;
                if (!dataLoader) {
                    throw new Error('æ•°æ®åŠ è½½å™¨æœªåˆå§‹åŒ–');
                }
                
                if (!dataLoader.contentData) {
                    throw new Error('å†…å®¹æ•°æ®æœªåŠ è½½');
                }
                
                if (!dataLoader.contentData.products) {
                    throw new Error('äº§å“æ•°æ®æœªåŠ è½½');
                }
                
                const products = dataLoader.contentData.products;
                log(`âœ… æ‰¾åˆ° ${products.length} ä¸ªäº§å“`);
                
                // æµ‹è¯•æ•°æ®ç»“æ„
                const firstProduct = products[0];
                const requiredFields = ['id', 'title', 'model', 'status'];
                const missingFields = requiredFields.filter(field => !firstProduct[field]);
                
                if (missingFields.length > 0) {
                    log(`âš ï¸ äº§å“æ•°æ®ç¼ºå°‘å­—æ®µ: ${missingFields.join(', ')}`);
                } else {
                    log('âœ… äº§å“æ•°æ®ç»“æ„å®Œæ•´');
                }
                
                log('âœ… Admin Functions å…¼å®¹æ€§æµ‹è¯•é€šè¿‡');
                
            } catch (error) {
                log(`âŒ Admin Functions æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        function clearData() {
            window.contentDataLoader = null;
            debugLog = [];
            log('ğŸ—‘ï¸ æ•°æ®å·²æ¸…é™¤');
            refreshDebug();
        }
        
        function refreshDebug() {
            updateDataLoaderStatus();
            updateProductDetails();
            updateProductPreview();
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åˆ·æ–°
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ è°ƒè¯•å·¥å…·å·²å¯åŠ¨');
            refreshDebug();
        });
    </script>
</body>
</html>
