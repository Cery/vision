<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品表单测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>产品表单功能测试</h2>
        
        <div class="row">
            <div class="col-md-6">
                <h4>分类选择测试</h4>
                <div class="mb-3">
                    <label class="form-label">主要分类</label>
                    <select class="form-select" id="testPrimaryCategory" onchange="updateTestSecondaryCategories()">
                        <option value="">选择主要分类</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">次要分类</label>
                    <select class="form-select" id="testSecondaryCategory">
                        <option value="">选择次要分类</option>
                    </select>
                </div>
            </div>
            
            <div class="col-md-6">
                <h4>供应商选择测试</h4>
                <div class="mb-3">
                    <label class="form-label">供应商</label>
                    <select class="form-select" id="testSupplier" onchange="updateTestProductSeries()">
                        <option value="">选择供应商</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">产品系列</label>
                    <select class="form-select" id="testProductSeries">
                        <option value="">选择产品系列</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h4>富文本编辑器测试</h4>
                <div class="mb-3">
                    <label class="form-label">详细描述</label>
                    <div id="testDescriptionEditor" style="height: 200px;"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label">应用场景</label>
                    <div id="testApplicationEditor" style="height: 150px;"></div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h4>参数模板测试</h4>
                <div class="mb-3">
                    <button type="button" class="btn btn-primary" onclick="loadTestParameterTemplate()">
                        <i class="fas fa-magic me-1"></i>加载参数模板
                    </button>
                    <button type="button" class="btn btn-success" onclick="addTestParameter()">
                        <i class="fas fa-plus me-1"></i>添加参数
                    </button>
                </div>
                <div id="testParametersContainer"></div>
            </div>
        </div>
        
        <div class="mt-4">
            <button type="button" class="btn btn-info" onclick="initializeTestForm()">
                <i class="fas fa-sync me-1"></i>初始化表单
            </button>
            <button type="button" class="btn btn-warning" onclick="debugTestData()">
                <i class="fas fa-bug me-1"></i>调试数据
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script>
        // 测试数据
        const testCategoryHierarchy = {
            '电子内窥镜': ['工业管道内窥镜', '汽车检测内窥镜', '电子设备内窥镜', '便携式内窥镜'],
            '光纤内窥镜': ['医疗光纤内窥镜', '工业光纤内窥镜', '科研光纤内窥镜', '高精度光纤内窥镜'],
            '光学内窥镜': ['传统光学内窥镜', '高倍光学内窥镜', '便携光学内窥镜', '专业光学内窥镜'],
            '内窥镜配件': ['探头配件', '光源配件', '显示配件', '存储配件']
        };

        const testSupplierSeriesMap = {
            '深圳市微视光电科技有限公司': ['K系列', 'P系列', 'DZ系列', 'S系列', 'F系列', 'LA系列'],
            '天津维森科技有限公司': ['VIS-P系列', 'VIS-T系列'],
            '上海尚品科技有限公司': ['G系列', 'L系列', 'M系列']
        };

        const testDefaultParameterTemplates = {
            '电子内窥镜': [
                { name: '主机屏幕', value: '6英寸' },
                { name: '待机时长', value: '8小时' },
                { name: '探头直径', value: '2.8mm' },
                { name: '像素', value: '100万' },
                { name: '景深', value: '3mm~70mm' },
                { name: '视场角', value: '120度' },
                { name: '视向', value: '直视' },
                { name: '光源', value: '光纤光源' }
            ]
        };

        let testDescriptionEditor = null;
        let testApplicationEditor = null;

        function initializeTestForm() {
            console.log('🔧 初始化测试表单...');
            
            // 初始化分类选项
            const primaryCategorySelect = document.getElementById('testPrimaryCategory');
            primaryCategorySelect.innerHTML = '<option value="">选择主要分类</option>';
            Object.keys(testCategoryHierarchy).forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                primaryCategorySelect.appendChild(option);
            });

            // 初始化供应商选项
            const supplierSelect = document.getElementById('testSupplier');
            supplierSelect.innerHTML = '<option value="">选择供应商</option>';
            Object.keys(testSupplierSeriesMap).forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier;
                option.textContent = supplier;
                supplierSelect.appendChild(option);
            });

            // 初始化编辑器
            initializeTestEditors();
            
            console.log('✅ 测试表单初始化完成');
        }

        function initializeTestEditors() {
            console.log('📝 初始化测试编辑器...');
            console.log('🔍 Quill是否可用:', typeof Quill !== 'undefined');
            
            if (!testDescriptionEditor && typeof Quill !== 'undefined') {
                testDescriptionEditor = new Quill('#testDescriptionEditor', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline'],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                            ['link', 'image'],
                            ['clean']
                        ]
                    }
                });
                console.log('✅ 详细描述编辑器创建成功');
            }

            if (!testApplicationEditor && typeof Quill !== 'undefined') {
                testApplicationEditor = new Quill('#testApplicationEditor', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline'],
                            ['link'],
                            ['clean']
                        ]
                    }
                });
                console.log('✅ 应用场景编辑器创建成功');
            }
        }

        function updateTestSecondaryCategories() {
            const primaryCategory = document.getElementById('testPrimaryCategory').value;
            const secondarySelect = document.getElementById('testSecondaryCategory');
            
            secondarySelect.innerHTML = '<option value="">选择次要分类</option>';
            
            if (primaryCategory && testCategoryHierarchy[primaryCategory]) {
                testCategoryHierarchy[primaryCategory].forEach(subCategory => {
                    const option = document.createElement('option');
                    option.value = subCategory;
                    option.textContent = subCategory;
                    secondarySelect.appendChild(option);
                });
            }
        }

        function updateTestProductSeries() {
            const supplier = document.getElementById('testSupplier').value;
            const seriesSelect = document.getElementById('testProductSeries');
            
            seriesSelect.innerHTML = '<option value="">选择产品系列</option>';
            
            if (supplier && testSupplierSeriesMap[supplier]) {
                testSupplierSeriesMap[supplier].forEach(series => {
                    const option = document.createElement('option');
                    option.value = series;
                    option.textContent = series;
                    seriesSelect.appendChild(option);
                });
            }
        }

        function loadTestParameterTemplate() {
            const category = document.getElementById('testPrimaryCategory').value;
            const container = document.getElementById('testParametersContainer');

            if (!category || !testDefaultParameterTemplates[category]) {
                alert('请先选择产品分类');
                return;
            }

            container.innerHTML = '';
            testDefaultParameterTemplates[category].forEach(param => {
                addTestParameter(param.name, param.value);
            });
        }

        function addTestParameter(name = '', value = '') {
            const container = document.getElementById('testParametersContainer');
            const parameterId = 'param-' + Date.now();

            const parameterDiv = document.createElement('div');
            parameterDiv.className = 'row mb-2';
            parameterDiv.innerHTML = `
                <div class="col-md-5">
                    <input type="text" class="form-control" placeholder="参数名称" value="${name}">
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control" placeholder="参数值" value="${value}">
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="this.closest('.row').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            container.appendChild(parameterDiv);
        }

        function debugTestData() {
            console.log('🐛 调试测试数据...');
            console.log('分类数据:', testCategoryHierarchy);
            console.log('供应商数据:', testSupplierSeriesMap);
            console.log('参数模板:', testDefaultParameterTemplates);
            console.log('编辑器状态:', {
                description: testDescriptionEditor,
                application: testApplicationEditor
            });
            alert('调试信息已输出到控制台');
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📄 测试页面加载完成');
            setTimeout(() => {
                initializeTestForm();
            }, 500);
        });
    </script>
</body>
</html>
