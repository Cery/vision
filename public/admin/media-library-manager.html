<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>媒体库管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .media-sidebar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .media-sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 12px 20px;
            margin: 2px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .media-sidebar .nav-link:hover, .media-sidebar .nav-link.active {
            color: white;
            background: rgba(255,255,255,0.1);
        }
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }
        .media-item {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .media-item.selected {
            border: 3px solid #007bff;
            transform: scale(1.02);
        }
        .media-preview {
            width: 100%;
            height: 150px;
            object-fit: cover;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .media-info {
            padding: 15px;
        }
        .media-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
            color: #2c3e50;
        }
        .media-meta {
            font-size: 12px;
            color: #6c757d;
        }
        .media-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .media-item:hover .media-actions {
            opacity: 1;
        }
        .upload-zone {
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .upload-zone:hover, .upload-zone.dragover {
            border-color: #007bff;
            background: #e3f2fd;
        }
        .folder-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .folder-item:hover {
            background: #fff8e1;
            transform: translateX(5px);
        }
        .breadcrumb-custom {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .media-toolbar {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .media-stats {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .file-type-icon {
            font-size: 48px;
            color: #6c757d;
        }
        .file-type-image { color: #28a745; }
        .file-type-video { color: #dc3545; }
        .file-type-document { color: #007bff; }
        .file-type-audio { color: #ffc107; }
        .progress-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            z-index: 1050;
        }
        .upload-progress {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <div class="col-md-3 col-lg-2 media-sidebar p-0">
                <div class="p-4">
                    <h4 class="text-white mb-4">
                        <i class="fas fa-images me-2"></i>
                        媒体库
                    </h4>
                    
                    <!-- 文件夹导航 -->
                    <nav class="nav flex-column mb-4">
                        <div class="text-white-50 small mb-2">文件夹</div>
                        <a class="nav-link active" href="#" onclick="navigateToFolder('all')">
                            <i class="fas fa-folder-open me-2"></i>所有文件
                        </a>
                        <a class="nav-link" href="#" onclick="navigateToFolder('products')">
                            <i class="fas fa-folder me-2"></i>产品图片
                        </a>
                        <a class="nav-link" href="#" onclick="navigateToFolder('news')">
                            <i class="fas fa-folder me-2"></i>资讯图片
                        </a>
                        <a class="nav-link" href="#" onclick="navigateToFolder('cases')">
                            <i class="fas fa-folder me-2"></i>案例图片
                        </a>
                        <a class="nav-link" href="#" onclick="navigateToFolder('documents')">
                            <i class="fas fa-folder me-2"></i>文档资料
                        </a>
                        <a class="nav-link" href="#" onclick="navigateToFolder('videos')">
                            <i class="fas fa-folder me-2"></i>视频文件
                        </a>
                    </nav>

                    <!-- 文件类型过滤 -->
                    <nav class="nav flex-column mb-4">
                        <div class="text-white-50 small mb-2">文件类型</div>
                        <a class="nav-link" href="#" onclick="filterByType('all')">
                            <i class="fas fa-file me-2"></i>所有类型
                        </a>
                        <a class="nav-link" href="#" onclick="filterByType('image')">
                            <i class="fas fa-image me-2"></i>图片
                        </a>
                        <a class="nav-link" href="#" onclick="filterByType('video')">
                            <i class="fas fa-video me-2"></i>视频
                        </a>
                        <a class="nav-link" href="#" onclick="filterByType('document')">
                            <i class="fas fa-file-alt me-2"></i>文档
                        </a>
                        <a class="nav-link" href="#" onclick="filterByType('audio')">
                            <i class="fas fa-music me-2"></i>音频
                        </a>
                    </nav>

                    <!-- 快速操作 -->
                    <div class="mt-auto">
                        <button class="btn btn-light btn-sm w-100 mb-2" onclick="createFolder()">
                            <i class="fas fa-folder-plus me-1"></i>新建文件夹
                        </button>
                        <button class="btn btn-primary btn-sm w-100" onclick="uploadFiles()">
                            <i class="fas fa-upload me-1"></i>上传文件
                        </button>
                    </div>
                </div>
            </div>

            <!-- 主内容区 -->
            <div class="col-md-9 col-lg-10 p-4">
                <!-- 面包屑导航 -->
                <div class="breadcrumb-custom">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-0" id="breadcrumbNav">
                            <li class="breadcrumb-item"><a href="#" onclick="navigateToFolder('all')">媒体库</a></li>
                            <li class="breadcrumb-item active" aria-current="page">所有文件</li>
                        </ol>
                    </nav>
                </div>

                <!-- 统计信息 -->
                <div class="media-stats">
                    <div class="row text-center">
                        <div class="col-3">
                            <div class="h4 mb-1" id="totalFiles">0</div>
                            <div class="small">总文件数</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="totalSize">0 MB</div>
                            <div class="small">总大小</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="selectedCount">0</div>
                            <div class="small">已选择</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="folderCount">6</div>
                            <div class="small">文件夹数</div>
                        </div>
                    </div>
                </div>

                <!-- 工具栏 -->
                <div class="media-toolbar">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" class="form-control" id="searchInput" placeholder="搜索文件名..." onkeyup="searchFiles()">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex justify-content-end gap-2">
                                <div class="btn-group">
                                    <button class="btn btn-outline-secondary btn-sm active" onclick="setViewMode('grid')" title="网格视图">
                                        <i class="fas fa-th"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="setViewMode('list')" title="列表视图">
                                        <i class="fas fa-list"></i>
                                    </button>
                                </div>
                                <select class="form-select form-select-sm" style="width: auto;" onchange="sortFiles(this.value)">
                                    <option value="name">按名称排序</option>
                                    <option value="date">按日期排序</option>
                                    <option value="size">按大小排序</option>
                                    <option value="type">按类型排序</option>
                                </select>
                                <button class="btn btn-danger btn-sm" onclick="deleteSelected()" id="deleteBtn" disabled>
                                    <i class="fas fa-trash me-1"></i>删除选中
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 上传区域 -->
                <div class="upload-zone mb-4" id="uploadZone" onclick="uploadFiles()">
                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">点击或拖拽文件到此处上传</h5>
                    <p class="text-muted mb-0">支持图片、视频、文档等多种格式</p>
                </div>

                <!-- 媒体网格 -->
                <div class="media-grid" id="mediaGrid">
                    <!-- 媒体项目将动态加载 -->
                </div>

                <!-- 列表视图 -->
                <div class="table-responsive" id="mediaList" style="display: none;">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th width="40">
                                    <input type="checkbox" class="form-check-input" onchange="selectAll(this.checked)">
                                </th>
                                <th>文件名</th>
                                <th>类型</th>
                                <th>大小</th>
                                <th>修改时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="mediaListBody">
                            <!-- 列表项目将动态加载 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 上传进度 -->
    <div class="progress-container" id="progressContainer">
        <!-- 上传进度项目将动态添加 -->
    </div>

    <!-- 文件详情模态框 -->
    <div class="modal fade" id="fileDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">文件详情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="fileDetailContent">
                    <!-- 文件详情内容 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="copyFileUrl()">复制链接</button>
                    <button type="button" class="btn btn-danger" onclick="deleteFile()">删除文件</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 全局变量
        let currentFolder = 'all';
        let currentFilter = 'all';
        let viewMode = 'grid';
        let selectedFiles = new Set();
        let mediaFiles = [];
        let filteredFiles = [];

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeMediaLibrary();
            setupDragAndDrop();
            loadMediaFiles();
        });

        // 初始化媒体库
        function initializeMediaLibrary() {
            console.log('🚀 媒体库管理系统初始化');
            updateStats();
        }

        // 设置拖拽上传
        function setupDragAndDrop() {
            const uploadZone = document.getElementById('uploadZone');

            uploadZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadZone.classList.remove('dragover');

                const files = Array.from(e.dataTransfer.files);
                handleFileUpload(files);
            });
        }

        // 加载媒体文件（模拟数据）
        function loadMediaFiles() {
            // 模拟媒体文件数据
            mediaFiles = [
                {
                    id: 1,
                    name: 'product-main.jpg',
                    type: 'image',
                    size: 1024000,
                    folder: 'products',
                    url: '/images/products/K-series/K-main.jpg',
                    uploadDate: '2024-01-15',
                    dimensions: '800x600'
                },
                {
                    id: 2,
                    name: 'case-study-1.jpg',
                    type: 'image',
                    size: 2048000,
                    folder: 'cases',
                    url: '/images/cases/case-1.jpg',
                    uploadDate: '2024-01-14',
                    dimensions: '1200x800'
                },
                {
                    id: 3,
                    name: 'product-manual.pdf',
                    type: 'document',
                    size: 5120000,
                    folder: 'documents',
                    url: '/documents/manual.pdf',
                    uploadDate: '2024-01-13',
                    pages: 24
                },
                {
                    id: 4,
                    name: 'demo-video.mp4',
                    type: 'video',
                    size: 15360000,
                    folder: 'videos',
                    url: '/videos/demo.mp4',
                    uploadDate: '2024-01-12',
                    duration: '2:30'
                },
                {
                    id: 5,
                    name: 'news-banner.jpg',
                    type: 'image',
                    size: 1536000,
                    folder: 'news',
                    url: '/images/news/banner.jpg',
                    uploadDate: '2024-01-11',
                    dimensions: '1920x1080'
                }
            ];

            applyFilters();
        }

        // 应用过滤器
        function applyFilters() {
            filteredFiles = mediaFiles.filter(file => {
                let folderMatch = currentFolder === 'all' || file.folder === currentFolder;
                let typeMatch = currentFilter === 'all' || file.type === currentFilter;
                return folderMatch && typeMatch;
            });

            renderMediaFiles();
            updateStats();
        }

        // 渲染媒体文件
        function renderMediaFiles() {
            if (viewMode === 'grid') {
                renderGridView();
            } else {
                renderListView();
            }
        }

        // 渲染网格视图
        function renderGridView() {
            const mediaGrid = document.getElementById('mediaGrid');
            const mediaList = document.getElementById('mediaList');

            mediaGrid.style.display = 'grid';
            mediaList.style.display = 'none';

            if (filteredFiles.length === 0) {
                mediaGrid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">暂无文件</h5>
                        <p class="text-muted">点击上传按钮或拖拽文件到上传区域</p>
                    </div>
                `;
                return;
            }

            mediaGrid.innerHTML = filteredFiles.map(file => `
                <div class="media-item ${selectedFiles.has(file.id) ? 'selected' : ''}"
                     onclick="selectFile(${file.id})"
                     ondblclick="showFileDetail(${file.id})">
                    <div class="media-actions">
                        <button class="btn btn-sm btn-light" onclick="event.stopPropagation(); showFileDetail(${file.id})" title="查看详情">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteFile(${file.id})" title="删除">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="media-preview">
                        ${getFilePreview(file)}
                    </div>
                    <div class="media-info">
                        <div class="media-title" title="${file.name}">${truncateFileName(file.name, 20)}</div>
                        <div class="media-meta">
                            ${formatFileSize(file.size)} • ${file.uploadDate}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 渲染列表视图
        function renderListView() {
            const mediaGrid = document.getElementById('mediaGrid');
            const mediaList = document.getElementById('mediaList');
            const mediaListBody = document.getElementById('mediaListBody');

            mediaGrid.style.display = 'none';
            mediaList.style.display = 'block';

            if (filteredFiles.length === 0) {
                mediaListBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-4">
                            <i class="fas fa-folder-open fa-2x text-muted mb-2"></i>
                            <div class="text-muted">暂无文件</div>
                        </td>
                    </tr>
                `;
                return;
            }

            mediaListBody.innerHTML = filteredFiles.map(file => `
                <tr class="${selectedFiles.has(file.id) ? 'table-primary' : ''}">
                    <td>
                        <input type="checkbox" class="form-check-input"
                               ${selectedFiles.has(file.id) ? 'checked' : ''}
                               onchange="toggleFileSelection(${file.id}, this.checked)">
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-${getFileIcon(file.type)} me-2 file-type-${file.type}"></i>
                            <span onclick="showFileDetail(${file.id})" style="cursor: pointer;">${file.name}</span>
                        </div>
                    </td>
                    <td><span class="badge bg-secondary">${file.type}</span></td>
                    <td>${formatFileSize(file.size)}</td>
                    <td>${file.uploadDate}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="showFileDetail(${file.id})" title="查看详情">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteFile(${file.id})" title="删除">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // 获取文件预览
        function getFilePreview(file) {
            switch (file.type) {
                case 'image':
                    return `<img src="${file.url}" alt="${file.name}" class="media-preview" style="width: 100%; height: 100%; object-fit: cover;">`;
                case 'video':
                    return `<i class="fas fa-video file-type-icon file-type-video"></i>`;
                case 'document':
                    return `<i class="fas fa-file-pdf file-type-icon file-type-document"></i>`;
                case 'audio':
                    return `<i class="fas fa-music file-type-icon file-type-audio"></i>`;
                default:
                    return `<i class="fas fa-file file-type-icon"></i>`;
            }
        }

        // 获取文件图标
        function getFileIcon(type) {
            const icons = {
                'image': 'image',
                'video': 'video',
                'document': 'file-pdf',
                'audio': 'music'
            };
            return icons[type] || 'file';
        }

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 截断文件名
        function truncateFileName(name, maxLength) {
            if (name.length <= maxLength) return name;
            const ext = name.split('.').pop();
            const nameWithoutExt = name.substring(0, name.lastIndexOf('.'));
            const truncated = nameWithoutExt.substring(0, maxLength - ext.length - 4) + '...';
            return truncated + '.' + ext;
        }

        // 更新统计信息
        function updateStats() {
            const totalFiles = mediaFiles.length;
            const totalSize = mediaFiles.reduce((sum, file) => sum + file.size, 0);
            const selectedCount = selectedFiles.size;

            document.getElementById('totalFiles').textContent = totalFiles;
            document.getElementById('totalSize').textContent = formatFileSize(totalSize);
            document.getElementById('selectedCount').textContent = selectedCount;

            // 更新删除按钮状态
            const deleteBtn = document.getElementById('deleteBtn');
            deleteBtn.disabled = selectedCount === 0;
        }

        // 导航到文件夹
        function navigateToFolder(folder) {
            currentFolder = folder;

            // 更新导航状态
            document.querySelectorAll('.media-sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');

            // 更新面包屑
            updateBreadcrumb(folder);

            // 应用过滤器
            applyFilters();
        }

        // 更新面包屑导航
        function updateBreadcrumb(folder) {
            const breadcrumb = document.getElementById('breadcrumbNav');
            const folderNames = {
                'all': '所有文件',
                'products': '产品图片',
                'news': '资讯图片',
                'cases': '案例图片',
                'documents': '文档资料',
                'videos': '视频文件'
            };

            breadcrumb.innerHTML = `
                <li class="breadcrumb-item"><a href="#" onclick="navigateToFolder('all')">媒体库</a></li>
                <li class="breadcrumb-item active" aria-current="page">${folderNames[folder]}</li>
            `;
        }

        // 按类型过滤
        function filterByType(type) {
            currentFilter = type;
            applyFilters();
        }

        // 设置视图模式
        function setViewMode(mode) {
            viewMode = mode;

            // 更新按钮状态
            document.querySelectorAll('.btn-group button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            renderMediaFiles();
        }

        // 搜索文件
        function searchFiles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            if (searchTerm === '') {
                applyFilters();
                return;
            }

            filteredFiles = mediaFiles.filter(file => {
                let folderMatch = currentFolder === 'all' || file.folder === currentFolder;
                let typeMatch = currentFilter === 'all' || file.type === currentFilter;
                let nameMatch = file.name.toLowerCase().includes(searchTerm);
                return folderMatch && typeMatch && nameMatch;
            });

            renderMediaFiles();
        }

        // 排序文件
        function sortFiles(sortBy) {
            filteredFiles.sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'date':
                        return new Date(b.uploadDate) - new Date(a.uploadDate);
                    case 'size':
                        return b.size - a.size;
                    case 'type':
                        return a.type.localeCompare(b.type);
                    default:
                        return 0;
                }
            });

            renderMediaFiles();
        }

        // 选择文件
        function selectFile(fileId) {
            if (selectedFiles.has(fileId)) {
                selectedFiles.delete(fileId);
            } else {
                selectedFiles.add(fileId);
            }

            renderMediaFiles();
            updateStats();
        }

        // 切换文件选择状态
        function toggleFileSelection(fileId, checked) {
            if (checked) {
                selectedFiles.add(fileId);
            } else {
                selectedFiles.delete(fileId);
            }

            renderMediaFiles();
            updateStats();
        }

        // 全选/取消全选
        function selectAll(checked) {
            if (checked) {
                filteredFiles.forEach(file => selectedFiles.add(file.id));
            } else {
                selectedFiles.clear();
            }

            renderMediaFiles();
            updateStats();
        }

        // 上传文件
        function uploadFiles() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = 'image/*,video/*,.pdf,.doc,.docx,.txt';
            input.onchange = function(e) {
                const files = Array.from(e.target.files);
                handleFileUpload(files);
            };
            input.click();
        }

        // 处理文件上传
        function handleFileUpload(files) {
            files.forEach(file => {
                const fileId = Date.now() + Math.random();

                // 显示上传进度
                showUploadProgress(fileId, file.name);

                // 模拟上传过程
                simulateUpload(fileId, file);
            });
        }

        // 显示上传进度
        function showUploadProgress(fileId, fileName) {
            const progressContainer = document.getElementById('progressContainer');
            const progressDiv = document.createElement('div');
            progressDiv.className = 'upload-progress';
            progressDiv.id = `progress-${fileId}`;

            progressDiv.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="small">${fileName}</span>
                    <button class="btn btn-sm btn-outline-secondary" onclick="cancelUpload(${fileId})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <div class="small text-muted mt-1">准备上传...</div>
            `;

            progressContainer.appendChild(progressDiv);
        }

        // 模拟上传过程
        function simulateUpload(fileId, file) {
            const progressDiv = document.getElementById(`progress-${fileId}`);
            const progressBar = progressDiv.querySelector('.progress-bar');
            const statusText = progressDiv.querySelector('.text-muted');

            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);

                    // 上传完成
                    progressBar.style.width = '100%';
                    progressBar.classList.add('bg-success');
                    statusText.textContent = '上传完成';

                    // 添加到媒体文件列表
                    addUploadedFile(file);

                    // 3秒后移除进度条
                    setTimeout(() => {
                        progressDiv.remove();
                    }, 3000);
                } else {
                    progressBar.style.width = progress + '%';
                    statusText.textContent = `上传中... ${Math.round(progress)}%`;
                }
            }, 200);
        }

        // 添加上传的文件到列表
        function addUploadedFile(file) {
            const newFile = {
                id: Date.now() + Math.random(),
                name: file.name,
                type: getFileType(file.type),
                size: file.size,
                folder: currentFolder === 'all' ? 'products' : currentFolder,
                url: URL.createObjectURL(file), // 实际应用中应该是服务器返回的URL
                uploadDate: new Date().toISOString().split('T')[0],
                dimensions: file.type.startsWith('image/') ? '未知' : null
            };

            mediaFiles.push(newFile);
            applyFilters();

            // 显示成功消息
            showNotification('文件上传成功！', 'success');
        }

        // 获取文件类型
        function getFileType(mimeType) {
            if (mimeType.startsWith('image/')) return 'image';
            if (mimeType.startsWith('video/')) return 'video';
            if (mimeType.startsWith('audio/')) return 'audio';
            if (mimeType.includes('pdf') || mimeType.includes('document') || mimeType.includes('text')) return 'document';
            return 'other';
        }

        // 取消上传
        function cancelUpload(fileId) {
            const progressDiv = document.getElementById(`progress-${fileId}`);
            if (progressDiv) {
                progressDiv.remove();
            }
        }

        // 创建文件夹
        function createFolder() {
            const folderName = prompt('请输入文件夹名称:');
            if (folderName && folderName.trim()) {
                showNotification(`文件夹 "${folderName}" 创建成功！`, 'success');
                // 实际应用中应该调用API创建文件夹
            }
        }

        // 显示文件详情
        function showFileDetail(fileId) {
            const file = mediaFiles.find(f => f.id === fileId);
            if (!file) return;

            const modal = new bootstrap.Modal(document.getElementById('fileDetailModal'));
            const content = document.getElementById('fileDetailContent');

            let detailHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="text-center mb-3">
                            ${file.type === 'image' ?
                                `<img src="${file.url}" class="img-fluid rounded" alt="${file.name}" style="max-height: 300px;">` :
                                `<i class="fas fa-${getFileIcon(file.type)} fa-5x file-type-${file.type}"></i>`
                            }
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>文件信息</h6>
                        <table class="table table-sm">
                            <tr><td><strong>文件名:</strong></td><td>${file.name}</td></tr>
                            <tr><td><strong>类型:</strong></td><td>${file.type}</td></tr>
                            <tr><td><strong>大小:</strong></td><td>${formatFileSize(file.size)}</td></tr>
                            <tr><td><strong>文件夹:</strong></td><td>${file.folder}</td></tr>
                            <tr><td><strong>上传日期:</strong></td><td>${file.uploadDate}</td></tr>
                            ${file.dimensions ? `<tr><td><strong>尺寸:</strong></td><td>${file.dimensions}</td></tr>` : ''}
                            ${file.duration ? `<tr><td><strong>时长:</strong></td><td>${file.duration}</td></tr>` : ''}
                            ${file.pages ? `<tr><td><strong>页数:</strong></td><td>${file.pages}</td></tr>` : ''}
                        </table>

                        <h6 class="mt-3">文件链接</h6>
                        <div class="input-group">
                            <input type="text" class="form-control" value="${window.location.origin}${file.url}" readonly id="fileUrl">
                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('fileUrl')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            content.innerHTML = detailHTML;
            modal.show();

            // 设置当前文件ID用于删除操作
            window.currentFileId = fileId;
        }

        // 删除文件
        function deleteFile(fileId = null) {
            const targetId = fileId || window.currentFileId;
            if (!targetId) return;

            if (confirm('确定要删除这个文件吗？此操作不可撤销！')) {
                mediaFiles = mediaFiles.filter(f => f.id !== targetId);
                selectedFiles.delete(targetId);
                applyFilters();
                showNotification('文件删除成功！', 'success');

                // 如果是在模态框中删除，关闭模态框
                const modal = bootstrap.Modal.getInstance(document.getElementById('fileDetailModal'));
                if (modal) {
                    modal.hide();
                }
            }
        }

        // 删除选中的文件
        function deleteSelected() {
            if (selectedFiles.size === 0) return;

            if (confirm(`确定要删除选中的 ${selectedFiles.size} 个文件吗？此操作不可撤销！`)) {
                mediaFiles = mediaFiles.filter(f => !selectedFiles.has(f.id));
                selectedFiles.clear();
                applyFilters();
                showNotification(`成功删除 ${selectedFiles.size} 个文件！`, 'success');
            }
        }

        // 复制文件链接
        function copyFileUrl() {
            copyToClipboard('fileUrl');
        }

        // 复制到剪贴板
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            document.execCommand('copy');
            showNotification('链接已复制到剪贴板！', 'info');
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; left: 50%; transform: translateX(-50%); z-index: 1060; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(alertDiv);

            // 3秒后自动移除
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>
