{{ define "main" }}
<div class="container py-5">
    {{ partial "breadcrumbs.html" . }}

    <h1 class="text-center mb-5">定制需求</h1>

    <div class="row">
        <!-- 左侧：定制需求表单 -->
        <div class="col-lg-7 mb-4 mb-lg-0">
            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <h4 class="card-title mb-4">提交定制需求</h4>
                    <form id="customForm" class="needs-validation" novalidate>
                        <!-- 公司信息 -->
                        <div class="mb-4">
                            <label for="companyName" class="form-label required">公司名称</label>
                            <input type="text" class="form-control" id="companyName" required>
                            <div class="invalid-feedback">请输入公司名称</div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="department" class="form-label">部门</label>
                                <input type="text" class="form-control" id="department">
                            </div>
                            <div class="col-md-6">
                                <label for="contact" class="form-label required">联系人</label>
                                <input type="text" class="form-control" id="contact" required>
                                <div class="invalid-feedback">请输入联系人姓名</div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="phone" class="form-label required">联系电话</label>
                            <input type="tel" class="form-control" id="phone" required pattern="[0-9]{11}">
                            <div class="invalid-feedback">请输入有效的手机号码</div>
                        </div>

                        <!-- 产品参数 -->
                        <div class="mb-4">
                            <label for="productType" class="form-label required">产品类型</label>
                            <select class="form-select" id="productType" required>
                                <option value="">请选择产品类型</option>
                                {{ range .Site.Taxonomies.categories }}
                                <option value="{{ .Name }}">{{ .Name }}</option>
                                {{ end }}
                            </select>
                            <div class="invalid-feedback">请选择产品类型</div>
                        </div>

                        <div class="mb-4">
                            <label for="requirements" class="form-label required">定制需求描述</label>
                            <textarea class="form-control" id="requirements" rows="5" required></textarea>
                            <div class="invalid-feedback">请描述您的定制需求</div>
                        </div>

                        <!-- 附件上传 -->
                        <div class="mb-4">
                            <label for="attachments" class="form-label">上传附件</label>
                            <input type="file" class="form-control" id="attachments" multiple accept=".pdf,.doc,.docx,.dwg,.jpg,.png">
                            <div class="form-text">支持PDF、Word、CAD图纸、图片等格式，单个文件不超过10MB</div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">提交需求</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- 右侧：定制需求列表 -->
        <div class="col-lg-5">
            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <h4 class="card-title mb-4">最新需求</h4>
                    <div class="custom-requirements-list">
                        {{ $paginator := .Paginate .Pages 10 }}
                        {{ range $paginator.Pages }}
                        <div class="requirement-item p-3 mb-3 bg-light rounded">
                            <div class="d-flex justify-content-between align-items-start">
                                <h6 class="mb-2">{{ .Title }}</h6>
                                <span class="badge bg-primary">{{ .Params.status }}</span>
                            </div>
                            <div class="text-muted small mb-2">
                                <i class="bi bi-calendar3"></i> {{ .Date.Format "2006-01-02" }}
                            </div>
                            {{ with .Params.company }}
                            <div class="text-muted small">
                                <i class="bi bi-building"></i> {{ . }}
                            </div>
                            {{ end }}
                        </div>
                        {{ end }}
                    </div>

                    <!-- 分页 -->
                    {{ if gt $paginator.TotalPages 1 }}
                    <nav aria-label="Page navigation" class="mt-4">
                        <ul class="pagination justify-content-center">
                            {{ if $paginator.HasPrev }}
                            <li class="page-item">
                                <a class="page-link" href="{{ $paginator.Prev.URL }}">&laquo;</a>
                            </li>
                            {{ end }}
                            
                            {{ range $paginator.Pagers }}
                            <li class="page-item {{ if eq . $paginator }}active{{ end }}">
                                <a class="page-link" href="{{ .URL }}">{{ .PageNumber }}</a>
                            </li>
                            {{ end }}
                            
                            {{ if $paginator.HasNext }}
                            <li class="page-item">
                                <a class="page-link" href="{{ $paginator.Next.URL }}">&raquo;</a>
                            </li>
                            {{ end }}
                        </ul>
                    </nav>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.required:after {
    content: " *";
    color: red;
}

.custom-requirements-list {
    max-height: 600px;
    overflow-y: auto;
}

.requirement-item {
    transition: all 0.3s ease;
    border: 1px solid rgba(0,0,0,0.1);
}

.requirement-item:hover {
    transform: translateX(5px);
    border-color: var(--bs-primary);
}

.form-control:focus,
.form-select:focus {
    border-color: var(--bs-primary);
    box-shadow: 0 0 0 0.25rem rgba(var(--bs-primary-rgb), 0.25);
}

.pagination .page-link {
    color: var(--bs-primary);
    border-radius: 0.25rem;
    margin: 0 0.25rem;
}

.pagination .page-item.active .page-link {
    background-color: var(--bs-primary);
    border-color: var(--bs-primary);
}

.pagination .page-link:hover {
    background-color: var(--bs-primary);
    border-color: var(--bs-primary);
    color: white;
}
</style>

<script>
// 表单验证
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('customForm');
    
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });

    // 文件上传大小限制
    const attachments = document.getElementById('attachments');
    attachments.addEventListener('change', function() {
        const files = this.files;
        const maxSize = 10 * 1024 * 1024; // 10MB

        for (let i = 0; i < files.length; i++) {
            if (files[i].size > maxSize) {
                alert('文件 ' + files[i].name + ' 超过10MB限制，请重新选择');
                this.value = '';
                break;
            }
        }
    });
});
</script>
{{ end }}