{{ define "main" }}
<!-- SEO优化的结构化数据 -->
<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@type": "Product",
  "name": "{{ .Title }}",
  "description": "{{ .Params.summary | default .Summary }}",
  "brand": {
    "@type": "Brand",
    "name": "{{ .Params.supplier | default "VisNDT" }}"
  },
  "model": "{{ .Params.model }}",
  "category": "{{ .Params.primary_category }}",
  {{ if .Params.gallery }}
  {{ $firstImage := index .Params.gallery 0 }}
  {{ if reflect.IsMap $firstImage }}
  "image": "{{ $firstImage.image | absURL }}",
  {{ else }}
  "image": "{{ $firstImage | absURL }}",
  {{ end }}
  {{ end }}
  "offers": {
    "@type": "Offer",
    "availability": "https://schema.org/InStock",
    "priceCurrency": "CNY"
  }
}
</script>

<div class="container py-5">
    {{ partial "breadcrumbs.html" . }}

    <!-- 产品标题区域 - SEO优化 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="product-header">
                <h1 class="product-title">{{ .Title }}</h1>
                {{ with .Params.summary }}
                <p class="product-subtitle text-muted">{{ . }}</p>
                {{ end }}
                <!-- 产品标签 -->
                <div class="product-tags mb-3">
                    {{ with .Params.primary_category }}
                    <span class="badge bg-primary me-2">{{ . }}</span>
                    {{ end }}
                    {{ with .Params.secondary_category }}
                    <span class="badge bg-secondary me-2">{{ . }}</span>
                    {{ end }}
                    {{ range .Params.tags }}
                    <span class="badge bg-outline-primary me-1">{{ . }}</span>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-6">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <!-- 主图容器 - 固定高度 -->
                    <div class="main-image-container">
                        {{ $mainImageSrc := "" }}
                        {{ $mainImageAlt := "产品图片" }}
                        {{ if .Params.gallery }}
                            {{ if reflect.IsSlice .Params.gallery }}
                                {{ $firstImage := index .Params.gallery 0 }}
                                {{ if reflect.IsMap $firstImage }}
                                    {{ $mainImageSrc = $firstImage.image }}
                                    {{ $mainImageAlt = $firstImage.alt | default "产品图片" }}
                                {{ else }}
                                    {{ $mainImageSrc = $firstImage }}
                                {{ end }}
                            {{ end }}
                        {{ end }}
                        {{ if $mainImageSrc }}
                        <img src="{{ $mainImageSrc | relURL }}" class="img-fluid rounded mb-3 main-product-image" alt="{{ $mainImageAlt }}" id="main-product-image">
                        {{ else }}
                        <img src="/images/products/default-product.jpg" class="img-fluid rounded mb-3 main-product-image" alt="主图占位图" id="main-product-image">
                        {{ end }}
                    </div>

                    <!-- 缩略图容器 - 固定高度 -->
                    <div class="row g-2 thumbnail-gallery">
                        {{ if .Params.gallery }}
                            {{ if reflect.IsSlice .Params.gallery }}
                                {{ $galleryItems := after 1 .Params.gallery }}
                                {{ range first 4 $galleryItems }}
                                    {{ if reflect.IsMap . }}
                                    <div class="col-3">
                                        <div class="thumbnail-container">
                                            <img src="{{ .image | relURL }}"
                                                 class="img-fluid rounded object-fit-cover thumbnail-image"
                                                 alt="{{ .alt | default "产品图片" }}"
                                                 onclick="switchMainImage('{{ .image | relURL }}', '{{ .alt | default `产品图片` }}')"
                                                 data-full-image="{{ .image | relURL }}">
                                        </div>
                                    </div>
                                    {{ else }}
                                    <div class="col-3">
                                        <div class="thumbnail-container">
                                            <img src="{{ . | relURL }}"
                                                 class="img-fluid rounded object-fit-cover thumbnail-image"
                                                 alt="产品图片"
                                                 onclick="switchMainImage('{{ . | relURL }}', '产品图片')"
                                                 data-full-image="{{ . | relURL }}">
                                        </div>
                                    </div>
                                    {{ end }}
                                {{ end }}
                            {{ end }}
                        {{ else }}
                        {{ range seq 2 5 }}
                        <div class="col-3">
                            <div class="thumbnail-container">
                                <img src="/images/products/default-gallery-{{ . }}.jpg"
                                     class="img-fluid rounded object-fit-cover thumbnail-image"
                                     alt="副图占位图"
                                     onclick="switchMainImage('/images/products/default-gallery-{{ . }}.jpg', '副图占位图')"
                                     data-full-image="/images/products/default-gallery-{{ . }}.jpg">
                            </div>
                        </div>
                        {{ end }}
                        {{ end }}
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card shadow-sm mb-4 product-info-card">
                <div class="card-body">
                    <!-- 产品核心信息 -->
                    <div class="product-core-info mb-4">
                        <div class="row">
                            <div class="col-6">
                                <div class="info-item">
                                    <span class="info-label">型号</span>
                                    <span class="info-value">{{ .Params.model | default "未指定" }}</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item">
                                    <span class="info-label">系列</span>
                                    <span class="info-value">{{ .Params.series | default "标准系列" }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="product-divider">

                    <ul class="list-unstyled product-details-list">
                        {{ with .Params.product_category }}
                        <li><strong>产品分类：</strong> {{ . }}</li>
                        {{ end }}
                        {{ with .Params.product_type }}
                        <li><strong>产品型式：</strong> {{ . }}</li>
                        {{ end }}
                        {{ with .Params.model }}
                        <li><strong>型号：</strong> {{ . }}</li>
                        {{ end }}
                        {{ with .Params.series }}
                        <li><strong>系列：</strong> {{ . }}</li>
                        {{ end }}
                        {{ with .Params.supplier }}
                        <li><strong>供应商：</strong>
                            {{ $supplierTitle := . }}
                            {{ $foundSupplier := "" }}
                            {{ range (where site.Pages "Section" "suppliers") }}
                                {{ if eq .Title $supplierTitle }}
                                    {{ $foundSupplier = . }}
                                {{ end }}
                            {{ end }}

                            {{ if $foundSupplier }}
                            <a href="#" data-bs-toggle="modal" data-bs-target="#supplierModal"
                                class="supplier-link"
                                data-supplier-title="{{ $foundSupplier.Title }}"
                                data-supplier-address="{{ $foundSupplier.Params.address | default "未提供" }}"
                                data-supplier-type="{{ $foundSupplier.Params.type | default "未提供" }}"
                                data-supplier-contact-person="{{ $foundSupplier.Params.contact_person | default "未提供" }}"
                                data-supplier-position="{{ $foundSupplier.Params.position | default "未提供" }}"
                                data-supplier-phone="{{ $foundSupplier.Params.phone | default "未提供" }}"
                                data-supplier-email="{{ $foundSupplier.Params.email | default "未提供" }}"
                                data-supplier-content="{{ ($foundSupplier.Params.description | default "暂无简介") | safeHTML }}"
                                data-supplier-series='{{ $foundSupplier.Params.series | jsonify | safeHTMLAttr }}'
                                data-supplier-models='{{ $foundSupplier.Params.models | jsonify | safeHTMLAttr }}'
                                data-supplier-gallery='{{ $foundSupplier.Params.gallery | jsonify | safeHTMLAttr }}'>
                            {{ $foundSupplier.Title }}
                            </a>            
                            {{ else }}
                                {{ $supplierTitle }}
                            {{ end }}
                        </li>
                        {{ end }}
                        
                        {{ with .Params.published }}
                        <li><strong>发布时间：</strong> {{ .Format "2006-01-02" }}</li>
                        {{ end }}
                        <li><strong>浏览次数：</strong> 
                            <span id="page-views">加载中...</span>
                        </li>
                        </ul>

                    <div class="mt-4 d-flex gap-3">
                        <button class="btn btn-primary flex-grow-1" id="online-consult-btn">
                            <i class="bi bi-chat-dots-fill me-2"></i>在线咨询
                        </button>
                        <button class="btn btn-outline-primary flex-grow-1" id="phone-contact-btn" data-bs-toggle="modal" data-bs-target="#phoneContactModal"
                                {{ with .Params.supplier }}
                                {{ $supplierTitle := . }}
                                {{ $foundSupplier := "" }}
                                {{ range (where site.Pages "Section" "suppliers") }}
                                    {{ if eq .Title $supplierTitle }}
                                        {{ $foundSupplier = . }}
                                    {{ end }}
                                {{ end }}
                                {{ if $foundSupplier }}
                                data-supplier-title="{{ $foundSupplier.Title }}"
                                data-supplier-contact-person="{{ $foundSupplier.Params.contact_person | default "客服" }}"
                                data-supplier-position="{{ $foundSupplier.Params.position | default "销售顾问" }}"
                                data-supplier-phone="{{ $foundSupplier.Params.phone | default "400-000-0000" }}"
                                {{ end }}
                                {{ end }}>
                            <i class="bi bi-telephone-fill me-2"></i>电话沟通
                        </button>
                    </div>
                </div>
            </div>

            {{ with .Params.parameters }}
            <div class="card shadow-sm mb-4 product-params-card">
                <div class="card-header bg-gradient-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-cogs me-2"></i>核心参数
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        {{ $displayCount := 0 }}
                        {{ range . }}
                            {{ if .group }}
                                {{ range .items }}
                                    {{ if or (eq .name "主机屏幕") (eq .name "待机时长") (eq .name "探头直径") (eq .name "像素") (eq .name "视向") (eq .name "光源") (eq .name "导向") (eq .name "管线材质") }}
                                        {{ if lt $displayCount 8 }}
                                            <div class="col-6">
                                                <div class="param-item">
                                                    <span class="param-label">{{ .name }}</span>
                                                    <span class="param-value">{{ .value }}</span>
                                                </div>
                                            </div>
                                            {{ $displayCount = add $displayCount 1 }}
                                        {{ end }}
                                    {{ end }}
                                {{ end }}
                            {{ else }}
                                {{ if or (eq .name "主机屏幕") (eq .name "待机时长") (eq .name "探头直径") (eq .name "像素") (eq .name "视向") (eq .name "光源") (eq .name "导向") (eq .name "管线材质") }}
                                    {{ if lt $displayCount 8 }}
                                        <div class="col-6">
                                            <div class="param-item">
                                                <span class="param-label">{{ .name }}</span>
                                                <span class="param-value">{{ .value }}</span>
                                            </div>
                                        </div>
                                        {{ $displayCount = add $displayCount 1 }}
                                    {{ end }}
                                {{ end }}
                            {{ end }}
                        {{ end }}
                    </div>
                </div>
            </div>
            {{ end }}
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm product-content-card">
                <div class="card-header bg-white p-0">
                    <ul class="nav nav-tabs product-tabs" id="productTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="intro-tab" data-bs-toggle="tab" data-bs-target="#intro" type="button" role="tab" aria-controls="intro" aria-selected="true">
                                <i class="fas fa-info-circle me-2"></i>产品介绍
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="detailed-specs-tab" data-bs-toggle="tab" data-bs-target="#detailed-specs" type="button" role="tab" aria-controls="detailed-specs" aria-selected="false">
                                <i class="fas fa-list-ul me-2"></i>详细参数
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="application-tab" data-bs-toggle="tab" data-bs-target="#application" type="button" role="tab" aria-controls="application" aria-selected="false">
                                <i class="fas fa-tools me-2"></i>应用场景
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="download-tab" data-bs-toggle="tab" data-bs-target="#download" type="button" role="tab" aria-controls="download" aria-selected="false">
                                <i class="fas fa-download me-2"></i>资料下载
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="productTabContent">
                        <div class="tab-pane fade show active" id="intro" role="tabpanel" aria-labelledby="intro-tab">
                            <div class="content">
                                {{ .Content }}
                            </div>
                        </div>
                        <div class="tab-pane fade" id="detailed-specs" role="tabpanel" aria-labelledby="detailed-specs-tab">
                            {{ with .Params.parameters }}
                            <table class="table table-bordered detailed-params-table">
                                <tbody>
                                    {{ range . }}
                                        {{ if .group }}
                                            <tr>
                                                <td colspan="2" class="param-group-header"><h6>{{ .group }}</h6></td>
                                            </tr>
                                            {{ range .items }}
                                            <tr>
                                                <td class="param-name">{{ .name }}</td>
                                                <td class="param-value">{{ .value }}</td>
                                            </tr>
                                            {{ end }}
                                        {{ else }}
                                            <tr>
                                                <td class="param-name">{{ .name }}</td>
                                                <td class="param-value">{{ .value }}</td>
                                            </tr>
                                        {{ end }}
                                    {{ end }}
                                </tbody>
                            </table>
                            {{ else }}
                            <p>暂无详细参数信息。</p>
                            {{ end }}
                        </div>
                        <div class="tab-pane fade" id="application" role="tabpanel" aria-labelledby="application-tab">
                            {{ with .Params.application_scenarios }}
                            <div class="content application-scenarios">
                                {{ . | markdownify }}
                            </div>
                            {{ else }}
                            <p>暂无应用场景信息。</p>
                            {{ end }}
                        </div>
                        <div class="tab-pane fade" id="download" role="tabpanel" aria-labelledby="download-tab">
                            {{ with .Params.data_download }}
                            <ul class="list-unstyled">
                                {{ range . }}
                                <li><a href="{{ .file_path | relURL }}" target="_blank">{{ .file_title }}</a></li>
                                {{ end }}
                            </ul>
                            {{ else }}
                            <p>暂无资料可供下载。</p>
                            {{ end }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {{ with .Params.related_products }}
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">相关产品</h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled row row-cols-1 row-cols-md-3 g-4">
                        {{ range . }}
                        {{ $relatedProduct := site.GetPage (printf "products/%s" .) }}
                        {{ with $relatedProduct }}
                        <li class="col">
                            <a href="{{ .Permalink }}" class="text-decoration-none">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="card-title text-dark">{{ .Title }}</h6>
                                        <p class="card-text text-muted small">{{ .Summary }}</p>
                                    </div>
                                </div>
                            </a>
                        </li>
                        {{ end }}
                        {{ end }}
                    </ul>
                </div>
            </div>
        </div>
    </div>
    {{ end }}
</div>

{{ partial "supplier_modal.html" . }}

<div class="modal fade" id="phoneContactModal" tabindex="-1" aria-labelledby="phoneContactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="phoneContactModalLabel">联系我们</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <h4 class="mb-3">咨询电话</h4>
                <div class="mb-3">
                    <p class="fs-6 mb-1 text-muted" id="supplier-company">公司名称</p>
                    <p class="fs-5 mb-2" id="contact-person">联系人</p>
                    <p class="fs-6 mb-2 text-muted" id="contact-position">职务</p>
                </div>
                <p class="fs-4 mb-4 fw-bold" id="contact-phone">电话号码</p>
                <p class="text-muted">工作时间：周一至周五 08:00-18:00</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                <a href="tel:" class="btn btn-primary" id="call-now-btn">立即拨打</a>
            </div>
        </div>
    </div>
</div>

<!-- 图片显示修复脚本 -->
<script>
// 修复localStorage中的图片显示问题
function fixLocalStorageImages() {
    try {
        const mediaLibrary = JSON.parse(localStorage.getItem('mediaLibrary') || '[]');

        // 查找所有需要修复的图片
        const images = document.querySelectorAll('img[src^="/images/products/"], img[src^="/images/content/"]');

        images.forEach(img => {
            const originalSrc = img.src;
            const relativePath = originalSrc.replace(window.location.origin, '');

            // 在媒体库中查找对应的图片
            const mediaItem = mediaLibrary.find(item => item.path === relativePath);

            if (mediaItem && mediaItem.data) {
                // 如果在localStorage中找到了图片数据，使用base64数据
                img.src = mediaItem.data;
                console.log(`✅ 修复图片显示: ${relativePath}`);
            } else {
                // 如果没有找到，检查图片是否真实存在
                const testImg = new Image();
                testImg.onload = function() {
                    // 图片存在，不需要修复
                    console.log(`✅ 图片正常: ${relativePath}`);
                };
                testImg.onerror = function() {
                    // 图片不存在，显示占位图
                    img.src = '/images/placeholder.svg';
                    img.alt = '图片加载失败';
                    console.log(`❌ 图片不存在: ${relativePath}`);
                };
                testImg.src = originalSrc;
            }
        });

        // 修复下载链接
        const downloadLinks = document.querySelectorAll('a[href^="/uploads/"]');
        downloadLinks.forEach(link => {
            const originalHref = link.href;
            const relativePath = originalHref.replace(window.location.origin, '');

            // 检查文件是否存在
            fetch(originalHref, { method: 'HEAD' })
                .then(response => {
                    if (!response.ok) {
                        // 文件不存在，禁用链接
                        link.style.color = '#6c757d';
                        link.style.textDecoration = 'line-through';
                        link.onclick = function(e) {
                            e.preventDefault();
                            alert('文件暂时不可用');
                        };
                        console.log(`❌ 下载文件不存在: ${relativePath}`);
                    } else {
                        console.log(`✅ 下载文件正常: ${relativePath}`);
                    }
                })
                .catch(error => {
                    console.log(`❌ 检查下载文件失败: ${relativePath}`, error);
                });
        });

    } catch (error) {
        console.error('修复图片显示时出错:', error);
    }
}

// 页面加载完成后执行修复
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(fixLocalStorageImages, 500);
});
</script>

<!-- 修复浏览次数的JavaScript -->
<script>
// 防止重复初始化的标记
let isInitialized = false;
let pageViewsElement;
let currentPath = '{{ .RelPermalink }}';
let pageTitle = '{{ .Title }}';

// LeanCloud配置
const LC_APP_ID = 'pUEgNUJ66pc7S4FqVpqxkTkx-MdYXbMMI';
const LC_APP_KEY = 'K9OXRf3L6Zp0s6TEzJElWQ5r';

function initPageViews() {
    // 防止重复初始化
    if (isInitialized) {
        console.log('页面访问统计已初始化，跳过重复初始化');
        return;
    }
    
    pageViewsElement = document.getElementById('page-views');
    if (!pageViewsElement) {
        console.log('未找到页面访问统计元素');
        return;
    }

    console.log('初始化页面访问统计, 路径:', currentPath);
    isInitialized = true;
    
    // 只使用LeanCloud直接API方式，避免Valine冲突
    initLeanCloudViews();
}

function initLeanCloudViews() {
    const url = 'https://pUEgNUJ66pc7S4FqVpqxkTkx.api.lncldglobal.com/1.1/classes/Counter';

    // 检查pageViewsElement是否存在
    if (!pageViewsElement) {
        console.error('pageViewsElement未初始化，无法显示浏览次数');
        return;
    }

    // 移除本地存储的重复访问检查，只统计网络访问次数
    // 每次访问都会增加计数，确保统计的是真实的网络访问量
    
    const queryUrl = url + '?where=' + encodeURIComponent(JSON.stringify({url: currentPath}));
    
    fetch(queryUrl, {
        method: 'GET',
        headers: {
            'X-LC-Id': LC_APP_ID,
            'X-LC-Key': LC_APP_KEY,
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return response.json();
    })
    .then(data => {
        console.log('查询Counter结果:', data);
        if (data.results && data.results.length > 0) {
            const record = data.results[0];
            const currentViews = record.time || 0;

            // 显示当前访问次数
            pageViewsElement.textContent = currentViews.toString();

            // 直接增加访问次数，不进行本地存储检查
            const newViews = currentViews + 1;
            updateCounter(record.objectId, newViews);
        } else {
            createCounter();
        }
    })
    .catch(error => {
        console.error('查询Counter失败:', error);
        // 网络失败时显示默认值
        pageViewsElement.textContent = '0';
    });
}

function createCounter() {
    const url = 'https://pUEgNUJ66pc7S4FqVpqxkTkx.api.lncldglobal.com/1.1/classes/Counter';
    
    // 显示初始值
    pageViewsElement.textContent = '1';
    
    // 更新访问记录
    const now = new Date().getTime();
    localStorage.setItem('last_visit_' + currentPath, now.toString());
    const visitedPages = JSON.parse(localStorage.getItem('visited_pages') || '[]');
    visitedPages.push(currentPath);
    localStorage.setItem('visited_pages', JSON.stringify(visitedPages));
    
    fetch(url, {
        method: 'POST',
        headers: {
            'X-LC-Id': LC_APP_ID,
            'X-LC-Key': LC_APP_KEY,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            url: currentPath,
            title: pageTitle,
            time: 1,
            createdAt: new Date().toISOString()
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return response.json();
    })
    .then(data => {
        console.log('创建Counter成功:', data);
        pageViewsElement.textContent = '1';
    })
    .catch(error => {
        console.error('创建Counter失败:', error);
        pageViewsElement.textContent = '1';
    });
}

function fetchCurrentViews() {
    const url = 'https://pUEgNUJ66pc7S4FqVpqxkTkx.api.lncldglobal.com/1.1/classes/Counter';
    const queryUrl = url + '?where=' + encodeURIComponent(JSON.stringify({url: currentPath}));

    fetch(queryUrl, {
        method: 'GET',
        headers: {
            'X-LC-Id': LC_APP_ID,
            'X-LC-Key': LC_APP_KEY,
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return response.json();
    })
    .then(data => {
        if (data.results && data.results.length > 0) {
            const record = data.results[0];
            const currentViews = record.time || 0;
            pageViewsElement.textContent = currentViews.toString();
        } else {
            pageViewsElement.textContent = '0';
        }
    })
    .catch(error => {
        console.error('获取浏览次数失败:', error);
        pageViewsElement.textContent = '0';
    });
}

function updateCounter(objectId, views) {
    const url = `https://pUEgNUJ66pc7S4FqVpqxkTkx.api.lncldglobal.com/1.1/classes/Counter/${objectId}`;
    
    fetch(url, {
        method: 'PUT',
        headers: {
            'X-LC-Id': LC_APP_ID,
            'X-LC-Key': LC_APP_KEY,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            time: views,
            updatedAt: new Date().toISOString()
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return response.json();
    })
    .then(data => {
        console.log('更新Counter成功:', data, '新访问次数:', views);
        pageViewsElement.textContent = views.toString();
    })
    .catch(error => {
        console.error('更新Counter失败:', error);
        // 更新失败时保持当前显示的数值
        console.log('更新失败，保持当前显示');
    });
}

// 页面加载完成后初始化 - 只初始化一次
document.addEventListener('DOMContentLoaded', function() {
    // 延迟初始化，确保页面完全加载
    setTimeout(initPageViews, 1000);
});
</script>

<script>
function switchMainImage(imageUrl, altText) {
    const mainImage = document.getElementById('main-product-image');
    const thumbnails = document.querySelectorAll('.thumbnail-image');
    
    if (mainImage) {
        mainImage.src = imageUrl;
        mainImage.alt = altText;
    }

    // 高亮当前选中的缩略图
    thumbnails.forEach(thumbnail => {
        if (thumbnail.src === imageUrl) {
            thumbnail.classList.add('active-thumbnail');
        } else {
            thumbnail.classList.remove('active-thumbnail');
        }
    });
}

// 为缩略图添加点击事件监听器
document.addEventListener('DOMContentLoaded', function() {
    const thumbnails = document.querySelectorAll('.thumbnail-image');
    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
            const imageUrl = this.getAttribute('data-full-image') || this.src;
            const altText = this.alt;
            switchMainImage(imageUrl, altText);
        });
    });
});
</script>

<style>
/* 产品页面样式 - SEO优化设计 */

/* 产品标题区域 */
.product-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem;
    border-radius: 15px;
    margin-bottom: 2rem;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
}

.product-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    line-height: 1.2;
}

.product-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 1rem;
}

.product-tags .badge {
    font-size: 0.85rem;
    padding: 0.5rem 0.8rem;
    border-radius: 20px;
}

/* 产品信息卡片 */
.product-info-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}

.product-core-info .info-item {
    text-align: center;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 10px;
    margin-bottom: 1rem;
}

.info-label {
    display: block;
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 0.25rem;
    font-weight: 500;
}

.info-value {
    display: block;
    font-size: 1.1rem;
    color: #212529;
    font-weight: 600;
}

.product-divider {
    border-color: #e9ecef;
    margin: 1.5rem 0;
}

/* 参数卡片优化 */
.product-params-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}

.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px 15px 0 0;
}

.param-item {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 10px;
    text-align: center;
    height: 100%;
    transition: all 0.3s ease;
}

.param-item:hover {
    background: #e9ecef;
    transform: translateY(-2px);
}

.param-label {
    display: block;
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.param-value {
    display: block;
    font-size: 1rem;
    color: #212529;
    font-weight: 600;
}

.product-details-list li {
    margin-bottom: 0.75rem;
    font-size: 14px;
    line-height: 1.5;
    color: #212121;
}

.product-details-list strong {
    color: #616161;
    font-weight: 500;
}

/* 内容区域样式 */
.tab-content {
    padding: 2rem;
    min-height: 400px;
}

.content img {
    max-width: 100%;
    height: auto;
    margin: 1.5rem 0;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
}

.content img:hover {
    transform: scale(1.02);
}

.content p {
    line-height: 1.7;
    margin-bottom: 1.5rem;
    font-size: 15px;
    color: #495057;
}

.content h2, .content h3, .content h4 {
    color: #667eea;
    font-weight: 600;
    margin-top: 2rem;
    margin-bottom: 1rem;
    position: relative;
}

.content h2::before {
    content: '';
    position: absolute;
    left: 0;
    bottom: -5px;
    width: 50px;
    height: 3px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 2px;
}

/* 产品图片网格 */
.content ul {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    list-style: none;
    padding: 0;
    margin: 2rem 0;
}

.content li {
    margin: 0;
}

.content li img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 10px;
    margin: 0;
}

/* 产品内容卡片 */
.product-content-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    overflow: hidden;
}

/* 标签页样式优化 */
.product-tabs {
    border-bottom: 2px solid #f8f9fa;
}

.product-tabs .nav-link {
    font-size: 14px;
    font-weight: 500;
    color: #6c757d;
    border: none;
    border-radius: 0;
    padding: 1rem 1.5rem;
    transition: all 0.3s ease;
    position: relative;
}

.product-tabs .nav-link:hover {
    color: #667eea;
    background-color: rgba(102, 126, 234, 0.05);
}

.product-tabs .nav-link.active {
    color: #667eea;
    background-color: transparent;
    border-bottom: 3px solid #667eea;
    font-weight: 600;
}

.product-tabs .nav-link.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 50%;
    transform: translateX(-50%);
    width: 30px;
    height: 3px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 2px;
}

.detailed-params-table {
    font-size: 14px;
}

.detailed-params-table .param-name {
    background-color: #fafafa;
    width: 30%;
    font-weight: 500;
    color: #616161;
    padding: 0.75rem;
}

.detailed-params-table .param-value {
    background-color: #ffffff;
    color: #212121;
    padding: 0.75rem;
}

.detailed-params-table .param-group-header {
    background-color: #f5f5f5;
    font-weight: 600;
    text-align: center;
    color: #1976d2;
    padding: 1rem;
}

.detailed-params-table .param-group-header h6 {
    margin: 0;
    font-size: 16px;
}

/* 主图容器 - 统一设计 */
.main-image-container {
    height: 400px;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background-color: #fafafa;
    border-radius: 12px;
    margin-bottom: 1rem;
    border: 1px solid #f5f5f5;
}

.main-product-image {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    transition: all 0.15s ease-in-out;
}

/* 缩略图容器 - 统一设计 */
.thumbnail-container {
    height: 100px;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background-color: #fafafa;
    border-radius: 8px;
    border: 1px solid #f5f5f5;
}

.thumbnail-image {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: cover;
    cursor: pointer;
    transition: all 0.15s ease-in-out;
    border: 2px solid transparent;
    border-radius: 6px;
}

.thumbnail-image:hover {
    transform: scale(1.02);
    border-color: #1976d2;
    box-shadow: 0 2px 8px rgba(25, 118, 210, 0.2);
}

.thumbnail-image.active-thumbnail {
    border: 2px solid #1976d2;
    transform: scale(1.02);
    box-shadow: 0 2px 8px rgba(25, 118, 210, 0.2);
}

/* 浏览次数样式 */
#page-views {
    color: #1976d2;
    font-weight: 500;
    transition: color 0.15s ease-in-out;
}

/* 产品标题样式 */
.card-body h2 {
    font-size: 24px;
    font-weight: 700;
    color: #212121;
    margin-bottom: 1rem;
    line-height: 1.3;
}

.card-body .lead {
    font-size: 16px;
    color: #616161;
    font-weight: 400;
    line-height: 1.5;
}

/* 按钮样式统一 */
.btn-primary {
    background-color: #1976d2;
    border-color: #1976d2;
    font-size: 14px;
    font-weight: 500;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    transition: all 0.15s ease-in-out;
}

.btn-primary:hover {
    background-color: #1565c0;
    border-color: #1565c0;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(25, 118, 210, 0.3);
}

.btn-outline-primary {
    color: #1976d2;
    border-color: #1976d2;
    font-size: 14px;
    font-weight: 500;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
}

.btn-outline-primary:hover {
    background-color: #1976d2;
    border-color: #1976d2;
    color: white;
}

/* 移动端响应式调整 */
@media (max-width: 768px) {
    .main-image-container {
        height: 250px;
    }

    .thumbnail-container {
        height: 80px;
    }

    .card-body h2 {
        font-size: 20px;
    }

    .product-details-list li {
        font-size: 13px;
    }

    .btn-primary, .btn-outline-primary {
        font-size: 13px;
        padding: 0.6rem 1.2rem;
    }
}

/* 更大屏幕的调整 */
@media (min-width: 1400px) {
    .main-image-container {
        height: 450px;
    }
}

/* 应用场景样式 - 统一设计 */
.application-scenarios img {
    max-width: 100%;
    height: auto;
    margin: 1.5rem 0;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07), 0 2px 4px rgba(0, 0, 0, 0.06);
}

.application-scenarios h2,
.application-scenarios h3 {
    margin-top: 2rem;
    margin-bottom: 1rem;
    color: #1976d2;
    font-weight: 600;
}

.application-scenarios h2 {
    font-size: 20px;
}

.application-scenarios h3 {
    font-size: 18px;
}

.application-scenarios p {
    line-height: 1.6;
    margin-bottom: 1rem;
    font-size: 14px;
    color: #212121;
}

.application-scenarios ul {
    padding-left: 1.5rem;
    margin-bottom: 1rem;
}

.application-scenarios li {
    margin-bottom: 0.5rem;
    font-size: 14px;
    color: #212121;
    line-height: 1.5;
}
</style>

<script>
// 电话沟通弹窗动态内容处理
document.addEventListener('DOMContentLoaded', function() {
    const phoneContactBtn = document.getElementById('phone-contact-btn');
    const phoneContactModal = document.getElementById('phoneContactModal');

    if (phoneContactBtn && phoneContactModal) {
        phoneContactBtn.addEventListener('click', function() {
            // 获取供应商信息
            const supplierTitle = this.getAttribute('data-supplier-title');
            const contactPerson = this.getAttribute('data-supplier-contact-person');
            const contactPosition = this.getAttribute('data-supplier-position');
            const contactPhone = this.getAttribute('data-supplier-phone');

            // 更新弹窗内容
            const supplierCompanyElement = phoneContactModal.querySelector('#supplier-company');
            const contactPersonElement = phoneContactModal.querySelector('#contact-person');
            const contactPositionElement = phoneContactModal.querySelector('#contact-position');
            const contactPhoneElement = phoneContactModal.querySelector('#contact-phone');
            const callNowBtn = phoneContactModal.querySelector('#call-now-btn');

            // 设置默认值
            const defaultCompany = '维森视觉检测仪器';
            const defaultContact = '客服';
            const defaultPosition = '销售顾问';
            const defaultPhone = '400-000-0000';

            // 更新显示内容
            if (supplierCompanyElement) {
                supplierCompanyElement.textContent = supplierTitle || defaultCompany;
            }

            if (contactPersonElement) {
                contactPersonElement.textContent = contactPerson || defaultContact;
            }

            if (contactPositionElement) {
                contactPositionElement.textContent = contactPosition || defaultPosition;
            }

            if (contactPhoneElement) {
                const displayPhone = contactPhone || defaultPhone;
                contactPhoneElement.textContent = displayPhone;
            }

            // 更新拨打电话链接
            if (callNowBtn) {
                const phoneNumber = contactPhone || defaultPhone;
                // 移除电话号码中的空格和特殊字符，只保留数字
                const cleanPhone = phoneNumber.replace(/\s+/g, '').replace(/[^\d]/g, '');
                callNowBtn.href = 'tel:' + cleanPhone;
            }
        });
    }
});
</script>

{{ end }}