<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>列表调试页面</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { margin: 5px; padding: 8px 16px; }
    </style>
</head>
<body>
    <h1>内容管理系统列表调试</h1>
    
    <div class="debug-section">
        <h3>1. 数据加载测试</h3>
        <button onclick="testDataLoading()">测试数据加载</button>
        <div id="dataLoadingResult"></div>
    </div>
    
    <div class="debug-section">
        <h3>2. 列表元素检查</h3>
        <button onclick="checkListElements()">检查列表元素</button>
        <div id="listElementsResult"></div>
    </div>
    
    <div class="debug-section">
        <h3>3. 手动触发列表更新</h3>
        <button onclick="manualUpdateLists()">手动更新所有列表</button>
        <div id="manualUpdateResult"></div>
    </div>

    <script>
        let projectData = {
            products: [],
            suppliers: [],
            news: [],
            cases: [],
            applications: [],
            categories: []
        };

        async function testDataLoading() {
            const resultDiv = document.getElementById('dataLoadingResult');
            try {
                const response = await fetch('/search-index.json');
                const searchData = await response.json();
                
                // 解析各类数据
                const products = searchData.filter(page => page.type === 'products' && page.title && !page.uri.includes('_index'));
                const suppliers = searchData.filter(page => page.type === 'suppliers' && page.title && !page.uri.includes('_index'));
                const news = searchData.filter(page => page.type === 'news' && page.title && !page.uri.includes('_index'));
                const cases = searchData.filter(page => page.type === 'cases' && page.title && !page.uri.includes('_index'));
                const applications = searchData.filter(page => page.type === 'applications' && page.title && !page.uri.includes('_index'));
                
                projectData.products = products;
                projectData.suppliers = suppliers;
                projectData.news = news;
                projectData.cases = cases;
                projectData.applications = applications;
                
                resultDiv.innerHTML = `
                    <div class="success">
                        <p>数据加载成功！</p>
                        <pre>
搜索索引总记录: ${searchData.length}
产品数量: ${products.length}
供应商数量: ${suppliers.length}
资讯数量: ${news.length}
案例数量: ${cases.length}
应用领域数量: ${applications.length}
                        </pre>
                        <h4>产品列表:</h4>
                        <pre>${JSON.stringify(products.map(p => ({title: p.title, type: p.type})), null, 2)}</pre>
                        <h4>供应商列表:</h4>
                        <pre>${JSON.stringify(suppliers.map(s => ({title: s.title, type: s.type})), null, 2)}</pre>
                        <h4>资讯列表:</h4>
                        <pre>${JSON.stringify(news.map(n => ({title: n.title, type: n.type})), null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <p>数据加载失败: ${error.message}</p>
                    </div>
                `;
            }
        }

        function checkListElements() {
            const resultDiv = document.getElementById('listElementsResult');
            
            // 在父窗口中查找元素
            const parentWindow = window.parent || window;
            const parentDoc = parentWindow.document;
            
            const elements = {
                productList: parentDoc.getElementById('productList'),
                supplierList: parentDoc.getElementById('supplierList'),
                newsList: parentDoc.getElementById('newsList'),
                caseList: parentDoc.getElementById('caseList'),
                applicationList: parentDoc.getElementById('applicationList'),
                categoryList: parentDoc.getElementById('categoryList')
            };
            
            let result = '<div class="success"><h4>列表元素检查结果:</h4><pre>';
            for (const [name, element] of Object.entries(elements)) {
                result += `${name}: ${element ? '✅ 存在' : '❌ 不存在'}\n`;
                if (element) {
                    result += `  - 当前内容: ${element.innerHTML.length > 100 ? element.innerHTML.substring(0, 100) + '...' : element.innerHTML}\n`;
                }
            }
            result += '</pre></div>';
            
            resultDiv.innerHTML = result;
        }

        function manualUpdateLists() {
            const resultDiv = document.getElementById('manualUpdateResult');
            
            try {
                // 在父窗口中执行列表更新
                const parentWindow = window.parent || window;
                
                if (parentWindow.updateCurrentSectionList) {
                    parentWindow.updateCurrentSectionList();
                    resultDiv.innerHTML = `
                        <div class="success">
                            <p>✅ 成功调用 updateCurrentSectionList()</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <p>❌ 未找到 updateCurrentSectionList 函数</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <p>❌ 手动更新失败: ${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
