<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分类数据测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>分类数据测试</h2>
        
        <div class="row">
            <div class="col-md-6">
                <h4>主要分类测试</h4>
                <div class="mb-3">
                    <label class="form-label">主要分类</label>
                    <select class="form-select" id="primaryCategory" onchange="updateSecondary()">
                        <option value="">选择主要分类</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">次要分类</label>
                    <select class="form-select" id="secondaryCategory">
                        <option value="">选择次要分类</option>
                    </select>
                </div>
                
                <div class="d-grid gap-2">
                    <button class="btn btn-primary" onclick="loadCategories()">加载分类数据</button>
                    <button class="btn btn-info" onclick="testCategories()">测试分类数据</button>
                    <button class="btn btn-success" onclick="showCategoryData()">显示分类结构</button>
                </div>
            </div>
            
            <div class="col-md-6">
                <h4>分类数据显示</h4>
                <div id="categoryDisplay" class="border p-3 bg-light" style="height: 400px; overflow-y: auto;">
                    <p>点击按钮加载分类数据...</p>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h4>测试日志</h4>
                <div id="logArea" class="border p-3 bg-light" style="height: 200px; overflow-y: auto;">
                    <p>等待操作...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 分类层级数据（与主页面相同 - 修正版本）
        const categoryHierarchyData = [
            {
                id: "electronic-endoscope",
                title: "电子内窥镜",
                icon: "fas fa-video",
                subcategories: [
                    { title: "工业视频内窥镜", icon: "fas fa-camera" },
                    { title: "工业管道内窥镜", icon: "fas fa-pipe-section" },
                    { title: "爬行机器人", icon: "fas fa-robot" }
                ]
            },
            {
                id: "fiber-endoscope",
                title: "光纤内窥镜",
                icon: "fas fa-fiber-optic",
                subcategories: [
                    { title: "柔性光纤内窥镜", icon: "fas fa-wave-square" },
                    { title: "硬性光纤内窥镜", icon: "fas fa-minus" }
                ]
            },
            {
                id: "optical-endoscope",
                title: "光学内窥镜",
                icon: "fas fa-eye",
                subcategories: [
                    { title: "硬性光学内窥镜", icon: "fas fa-binoculars" },
                    { title: "柔性光学内窥镜", icon: "fas fa-eye-dropper" }
                ]
            }
        ];

        let categoryHierarchy = {};

        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('p');
            logEntry.className = 'mb-1';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }

        function loadCategories() {
            log('🔄 开始加载分类数据...');
            
            // 构建分类层级对象
            categoryHierarchy = {};
            categoryHierarchyData.forEach(primary => {
                categoryHierarchy[primary.title] = primary.subcategories.map(sub => sub.title);
            });
            
            log(`✅ 分类层级对象构建完成: ${Object.keys(categoryHierarchy).length} 个主分类`);
            
            // 填充主要分类下拉框
            const primarySelect = document.getElementById('primaryCategory');
            primarySelect.innerHTML = '<option value="">选择主要分类</option>';
            
            const primaryCategories = categoryHierarchyData.map(category => category.title);
            log(`📋 主要分类列表: ${primaryCategories.join(', ')}`);
            
            primaryCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                primarySelect.appendChild(option);
            });
            
            log(`✅ 主要分类下拉框已填充: ${primarySelect.options.length - 1} 个选项`);
        }

        function updateSecondary() {
            const primaryCategory = document.getElementById('primaryCategory').value;
            const secondarySelect = document.getElementById('secondaryCategory');
            
            log(`🔄 更新次要分类，选择的主分类: ${primaryCategory}`);
            
            secondarySelect.innerHTML = '<option value="">选择次要分类</option>';
            
            if (primaryCategory && categoryHierarchy[primaryCategory]) {
                const subcategories = categoryHierarchy[primaryCategory];
                log(`📋 ${primaryCategory} 的子分类: ${subcategories.join(', ')}`);
                
                subcategories.forEach(subCategory => {
                    const option = document.createElement('option');
                    option.value = subCategory;
                    option.textContent = subCategory;
                    secondarySelect.appendChild(option);
                });
                
                log(`✅ 次要分类下拉框已更新: ${secondarySelect.options.length - 1} 个选项`);
            } else {
                log('⚠️ 没有找到对应的子分类');
            }
        }

        function testCategories() {
            log('🧪 开始测试分类数据...');
            
            const primarySelect = document.getElementById('primaryCategory');
            const secondarySelect = document.getElementById('secondaryCategory');
            
            log(`📊 主要分类下拉框选项数量: ${primarySelect.options.length}`);
            log(`📊 次要分类下拉框选项数量: ${secondarySelect.options.length}`);
            
            // 显示所有主要分类选项
            for (let i = 0; i < primarySelect.options.length; i++) {
                const option = primarySelect.options[i];
                log(`📋 主要分类选项 ${i}: "${option.value}" - "${option.text}"`);
            }
            
            log('✅ 分类数据测试完成');
        }

        function showCategoryData() {
            const display = document.getElementById('categoryDisplay');
            let html = '<h5>完整分类结构</h5>';
            
            categoryHierarchyData.forEach((primary, index) => {
                html += `
                    <div class="mb-3">
                        <h6><i class="${primary.icon}"></i> ${primary.title}</h6>
                        <ul class="list-group list-group-flush">
                `;
                
                primary.subcategories.forEach(sub => {
                    html += `
                        <li class="list-group-item py-1">
                            <i class="${sub.icon}"></i> ${sub.title}
                        </li>
                    `;
                });
                
                html += '</ul></div>';
            });
            
            display.innerHTML = html;
            log('✅ 分类结构已显示');
        }

        // 页面加载完成后自动加载分类
        document.addEventListener('DOMContentLoaded', function() {
            log('✅ 页面加载完成');
            setTimeout(() => {
                loadCategories();
                showCategoryData();
            }, 500);
        });
    </script>
</body>
</html>
