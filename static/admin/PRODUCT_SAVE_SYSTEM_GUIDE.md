# VisNDT 产品保存系统 - 使用指南

## 系统概述

我已经完全修复了产品保存功能，现在系统能够真正保存产品数据并实时同步前后台。新系统包含：

1. **前端管理界面** - 完整的产品编辑和管理功能
2. **后端API服务器** - 处理文件保存和数据同步
3. **实时状态监控** - 服务器状态和数据同步状态

## 🚀 快速启动

### 1. 启动服务器
```bash
# 方法1：启动所有服务（推荐）
npm run dev

# 方法2：分别启动
# 终端1：启动Hugo
hugo server --port 1313

# 终端2：启动产品管理服务器
node product-server.js

# 终端3：启动CMS（可选）
npm run cms
```

### 2. 访问管理系统
- 主入口：`http://localhost:1313/admin/`
- 直接访问：`http://localhost:1313/admin/complete-content-manager.html`

## 📋 功能特性

### ✅ 已修复的问题

1. **保存按钮响应** - 现在点击保存按钮有明确的反馈和状态
2. **真实文件保存** - 产品数据保存为Markdown文件到 `content/products/` 目录
3. **前后台同步** - 保存后立即在前台网站可见
4. **服务器状态监控** - 实时显示服务器连接状态
5. **离线模式支持** - 服务器不可用时自动保存到本地

### 🎯 核心功能

#### 产品管理
- **添加产品**：完整的产品信息录入
- **编辑产品**：修改现有产品信息
- **删除产品**：从文件系统中删除产品文件
- **批量操作**：支持批量导入导出

#### 数据同步
- **实时保存**：保存到 `content/products/产品ID.md`
- **前台同步**：Hugo自动重新加载，前台立即可见
- **状态反馈**：保存进度和结果通知

#### 离线支持
- **本地存储**：服务器不可用时保存到浏览器本地
- **自动同步**：服务器恢复后自动同步本地数据
- **状态指示**：清晰的在线/离线状态显示

## 🔧 技术架构

### 前端 (管理界面)
- **框架**：Bootstrap 5 + 原生JavaScript
- **富文本编辑器**：Quill.js
- **API客户端**：ProductAPI类
- **状态管理**：实时服务器状态检查

### 后端 (API服务器)
- **框架**：Express.js + Node.js
- **端口**：3001
- **文件操作**：直接读写Markdown文件
- **CORS支持**：允许跨域请求

### 数据流
```
管理界面 → ProductAPI → Express服务器 → 文件系统 → Hugo重载 → 前台显示
```

## 📝 使用流程

### 添加新产品

1. **打开管理系统**
   - 访问 `http://localhost:1313/admin/complete-content-manager.html`
   - 点击左侧"产品管理" → "产品列表"

2. **创建产品**
   - 点击"添加产品"按钮
   - 系统会自动生成6位数字编号

3. **填写基本信息**
   - 产品名称（必填）
   - 产品型号（必填）
   - 产品编号（自动生成，可修改）
   - 产品简述

4. **选择分类和供应商**
   - 选择一级分类（自动加载二级分类）
   - 选择供应商（自动加载对应系列）

5. **设置产品参数**
   - 点击"加载默认参数模板"获取8种标准参数
   - 可以添加、修改、删除参数

6. **编辑内容**
   - 使用富文本编辑器编辑应用场景
   - 编辑产品详细描述（支持图片插入）

7. **添加资料下载**
   - 点击"添加资料"
   - 输入文件标题
   - 上传文件（PDF、Word、Excel等）

8. **选择相关产品**
   - 从下拉列表选择相关产品

9. **保存产品**
   - 点击"保存产品"按钮
   - 观察保存状态：保存中 → 保存成功
   - 系统会显示成功通知

### 编辑现有产品

1. **找到产品**
   - 在产品列表中使用筛选或搜索
   - 支持按供应商、分类、状态筛选

2. **编辑产品**
   - 点击产品行的"编辑"按钮
   - 系统自动预填充所有现有数据

3. **修改信息**
   - 修改需要更新的字段
   - 所有功能与添加产品相同

4. **保存更改**
   - 点击"保存产品"
   - 系统会更新现有文件

## 🔍 状态监控

### 服务器状态指示器
位于顶部导航栏，显示：
- 🟢 **服务器在线** - 正常工作状态
- 🟡 **离线模式** - 服务器不可用，使用本地存储
- 🔴 **连接失败** - 无法连接到服务器

### 同步状态
- **同步数据按钮** - 当有未同步的本地数据时显示
- **自动检查** - 每30秒自动检查服务器状态

## 📁 文件结构

### 保存的产品文件
```
content/products/
├── 123456.md          # 产品ID.md
├── WS-K08510-a.md     # 现有产品文件
└── ...
```

### 产品文件格式
```yaml
---
title: "产品名称"
summary: "产品简述"
primary_category: "电子内窥镜"
secondary_category: "工业视频内窥镜"
model: "WS-K08510"
series: "K系列"
supplier: "深圳市微视光电科技有限公司"
published: 2024-01-01T00:00:00Z
gallery:
  - image: "/images/products/main.jpg"
    alt: "主图"
    is_main: true
parameters:
  - name: "主机屏幕"
    value: "6英寸"
  - name: "待机时长"
    value: "8小时"
application_scenarios: |
  应用场景的HTML内容
data_download:
  - file_title: "产品说明书"
    file_path: "/uploads/manual.pdf"
related_products:
  - "related-product-id"
---

# 产品详细描述

产品的详细内容...
```

## 🛠️ 故障排除

### 保存按钮无响应
1. **检查服务器状态** - 查看顶部状态指示器
2. **检查控制台** - 按F12查看浏览器控制台错误
3. **重启服务器** - `node product-server.js`

### 服务器连接失败
1. **确认服务器运行** - 访问 `http://localhost:3001/api/products/status`
2. **检查端口占用** - 确保3001端口未被占用
3. **防火墙设置** - 确保防火墙允许本地连接

### 数据未同步到前台
1. **检查Hugo服务器** - 确保Hugo在1313端口运行
2. **手动刷新** - 刷新前台页面
3. **检查文件** - 确认 `content/products/` 目录中有新文件

### 本地数据丢失
1. **检查localStorage** - 浏览器开发者工具 → Application → Local Storage
2. **导出备份** - 使用导出功能备份数据
3. **重新同步** - 点击"同步数据"按钮

## 📊 API端点

### 产品管理API
- `GET /api/products/status` - 检查服务器状态
- `POST /api/products/save` - 保存产品
- `POST /api/products/delete` - 删除产品
- `GET /api/products/list` - 获取产品列表
- `GET /api/products/:id` - 获取单个产品
- `POST /api/products/batch` - 批量操作

### 使用示例
```javascript
// 保存产品
const result = await fetch('http://localhost:3001/api/products/save', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        id: '123456',
        content: '产品的Markdown内容'
    })
});
```

## 🎉 总结

现在系统已经完全修复：
- ✅ 保存按钮正常工作
- ✅ 数据真实保存到文件系统
- ✅ 前后台实时同步
- ✅ 完整的状态反馈
- ✅ 离线模式支持
- ✅ 自动数据同步

您可以立即开始使用这个完整的产品管理系统！
