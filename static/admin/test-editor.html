<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>编辑器测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Quill编辑器测试</h2>
        
        <div class="row">
            <div class="col-md-6">
                <h4>编辑器1 - 详细描述</h4>
                <div id="editor1" style="height: 200px;"></div>
                <div class="mt-2">
                    <button class="btn btn-primary" onclick="initEditor1()">初始化编辑器1</button>
                    <button class="btn btn-danger" onclick="destroyEditor1()">销毁编辑器1</button>
                    <button class="btn btn-info" onclick="getEditor1Content()">获取内容</button>
                </div>
            </div>
            
            <div class="col-md-6">
                <h4>编辑器2 - 应用场景</h4>
                <div id="editor2" style="height: 200px;"></div>
                <div class="mt-2">
                    <button class="btn btn-primary" onclick="initEditor2()">初始化编辑器2</button>
                    <button class="btn btn-danger" onclick="destroyEditor2()">销毁编辑器2</button>
                    <button class="btn btn-info" onclick="getEditor2Content()">获取内容</button>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h4>测试日志</h4>
                <div id="logArea" class="border p-3 bg-light" style="height: 200px; overflow-y: auto;">
                    <p>等待操作...</p>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h4>批量测试</h4>
                <div class="d-flex gap-2">
                    <button class="btn btn-success" onclick="initBothEditors()">初始化所有编辑器</button>
                    <button class="btn btn-warning" onclick="destroyBothEditors()">销毁所有编辑器</button>
                    <button class="btn btn-info" onclick="testReinitialization()">测试重新初始化</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script>
        let editor1 = null;
        let editor2 = null;
        
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('p');
            logEntry.className = 'mb-1';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }
        
        function initEditor1() {
            try {
                if (editor1) {
                    log('⚠️ 编辑器1已存在，先销毁...');
                    destroyEditor1();
                }
                
                log('🔧 初始化编辑器1...');
                editor1 = new Quill('#editor1', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline'],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                            ['link', 'image'],
                            ['clean']
                        ]
                    }
                });
                log('✅ 编辑器1初始化成功');
            } catch (error) {
                log('❌ 编辑器1初始化失败: ' + error.message);
            }
        }
        
        function destroyEditor1() {
            try {
                if (editor1) {
                    log('🗑️ 销毁编辑器1...');
                    editor1 = null;
                    document.getElementById('editor1').innerHTML = '';
                    log('✅ 编辑器1已销毁');
                } else {
                    log('⚠️ 编辑器1不存在');
                }
            } catch (error) {
                log('❌ 销毁编辑器1失败: ' + error.message);
            }
        }
        
        function getEditor1Content() {
            if (editor1) {
                const content = editor1.root.innerHTML;
                log('📄 编辑器1内容: ' + content.substring(0, 50) + '...');
                alert('编辑器1内容:\n' + content);
            } else {
                log('⚠️ 编辑器1未初始化');
                alert('编辑器1未初始化');
            }
        }
        
        function initEditor2() {
            try {
                if (editor2) {
                    log('⚠️ 编辑器2已存在，先销毁...');
                    destroyEditor2();
                }
                
                log('🔧 初始化编辑器2...');
                editor2 = new Quill('#editor2', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline'],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                            ['link'],
                            ['clean']
                        ]
                    }
                });
                log('✅ 编辑器2初始化成功');
            } catch (error) {
                log('❌ 编辑器2初始化失败: ' + error.message);
            }
        }
        
        function destroyEditor2() {
            try {
                if (editor2) {
                    log('🗑️ 销毁编辑器2...');
                    editor2 = null;
                    document.getElementById('editor2').innerHTML = '';
                    log('✅ 编辑器2已销毁');
                } else {
                    log('⚠️ 编辑器2不存在');
                }
            } catch (error) {
                log('❌ 销毁编辑器2失败: ' + error.message);
            }
        }
        
        function getEditor2Content() {
            if (editor2) {
                const content = editor2.root.innerHTML;
                log('📄 编辑器2内容: ' + content.substring(0, 50) + '...');
                alert('编辑器2内容:\n' + content);
            } else {
                log('⚠️ 编辑器2未初始化');
                alert('编辑器2未初始化');
            }
        }
        
        function initBothEditors() {
            log('🚀 批量初始化编辑器...');
            initEditor1();
            setTimeout(() => initEditor2(), 100);
        }
        
        function destroyBothEditors() {
            log('🧹 批量销毁编辑器...');
            destroyEditor1();
            destroyEditor2();
        }
        
        function testReinitialization() {
            log('🔄 测试重新初始化...');
            destroyBothEditors();
            setTimeout(() => {
                initBothEditors();
            }, 500);
        }
        
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            log('✅ 页面加载完成');
            log('🔍 Quill版本: ' + (typeof Quill !== 'undefined' ? 'Available' : 'Not Available'));
            
            // 自动初始化编辑器
            setTimeout(() => {
                log('🔄 自动初始化编辑器...');
                initBothEditors();
            }, 1000);
        });
    </script>
</body>
</html>
