<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisNDT ç¼–ç åè°ƒæœºåˆ¶æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .test-pass {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .test-fail {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .test-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .code-display {
            background-color: #f1f3f4;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">
                    <i class="fas fa-globe text-primary"></i>
                    VisNDT ç¼–ç åè°ƒæœºåˆ¶æµ‹è¯•
                </h1>
                
                <div class="alert alert-info">
                    <h5><i class="fas fa-info-circle"></i> æµ‹è¯•è¯´æ˜</h5>
                    <p>æ­¤é¡µé¢ç”¨äºå…¨é¢æµ‹è¯•é¡¹ç›®ä¸­å„ä¸ªç¯èŠ‚çš„æ–‡å­—ç¼–ç åè°ƒæœºåˆ¶ï¼Œç¡®ä¿ä¸­æ–‡å­—ç¬¦åœ¨æ‰€æœ‰ç»„ä»¶ä¸­æ­£ç¡®å¤„ç†ã€‚</p>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•ç»Ÿè®¡ -->
        <div class="row">
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <h3 id="total-tests">0</h3>
                    <p>æ€»æµ‹è¯•é¡¹</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <h3 id="passed-tests">0</h3>
                    <p>é€šè¿‡æµ‹è¯•</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <h3 id="warning-tests">0</h3>
                    <p>è­¦å‘Šé¡¹</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <h3 id="failed-tests">0</h3>
                    <p>å¤±è´¥é¡¹</p>
                </div>
            </div>
        </div>

        <!-- æµè§ˆå™¨ç¯å¢ƒæµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-browser"></i> æµè§ˆå™¨ç¯å¢ƒæµ‹è¯•</h3>
            <div id="browser-env-results"></div>
            <button class="btn btn-primary" onclick="testBrowserEnvironment()">
                <i class="fas fa-play"></i> å¼€å§‹æµ‹è¯•
            </button>
        </div>

        <!-- å­—ç¬¦ç¼–ç åŸºç¡€æµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-font"></i> å­—ç¬¦ç¼–ç åŸºç¡€æµ‹è¯•</h3>
            <div id="encoding-basic-results"></div>
            <button class="btn btn-success" onclick="testBasicEncoding()">
                <i class="fas fa-test-tube"></i> æµ‹è¯•åŸºç¡€ç¼–ç 
            </button>
        </div>

        <!-- URLç¼–ç æµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-link"></i> URLç¼–ç æµ‹è¯•</h3>
            <div id="url-encoding-results"></div>
            <button class="btn btn-info" onclick="testUrlEncoding()">
                <i class="fas fa-globe"></i> æµ‹è¯•URLç¼–ç 
            </button>
        </div>

        <!-- JSONæ•°æ®å¤„ç†æµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-database"></i> JSONæ•°æ®å¤„ç†æµ‹è¯•</h3>
            <div id="json-processing-results"></div>
            <button class="btn btn-warning" onclick="testJsonProcessing()">
                <i class="fas fa-code"></i> æµ‹è¯•JSONå¤„ç†
            </button>
        </div>

        <!-- è¡¨å•æ•°æ®æµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-wpforms"></i> è¡¨å•æ•°æ®æµ‹è¯•</h3>
            <div class="mb-3">
                <label for="test-form-input" class="form-label">æµ‹è¯•è¾“å…¥ï¼š</label>
                <input type="text" class="form-control" id="test-form-input" 
                       value="ç»´æ£®è§†è§‰æ£€æµ‹ä»ªå™¨ - ä¸“ä¸šçš„å·¥ä¸šå†…çª¥é•œè§£å†³æ–¹æ¡ˆ">
            </div>
            <div id="form-data-results"></div>
            <button class="btn btn-secondary" onclick="testFormData()">
                <i class="fas fa-keyboard"></i> æµ‹è¯•è¡¨å•æ•°æ®
            </button>
        </div>

        <!-- æœ¬åœ°å­˜å‚¨æµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-save"></i> æœ¬åœ°å­˜å‚¨æµ‹è¯•</h3>
            <div id="storage-results"></div>
            <button class="btn btn-dark" onclick="testLocalStorage()">
                <i class="fas fa-hdd"></i> æµ‹è¯•æœ¬åœ°å­˜å‚¨
            </button>
        </div>

        <!-- ç½‘ç»œè¯·æ±‚æµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-wifi"></i> ç½‘ç»œè¯·æ±‚æµ‹è¯•</h3>
            <div id="network-results"></div>
            <button class="btn btn-danger" onclick="testNetworkRequests()">
                <i class="fas fa-cloud"></i> æµ‹è¯•ç½‘ç»œè¯·æ±‚
            </button>
        </div>

        <!-- ç»¼åˆæŠ¥å‘Š -->
        <div class="test-section">
            <h3><i class="fas fa-chart-bar"></i> ç»¼åˆæµ‹è¯•æŠ¥å‘Š</h3>
            <div id="comprehensive-report"></div>
            <button class="btn btn-outline-primary" onclick="generateComprehensiveReport()">
                <i class="fas fa-file-alt"></i> ç”Ÿæˆç»¼åˆæŠ¥å‘Š
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // æµ‹è¯•ç»Ÿè®¡
        let testStats = {
            total: 0,
            passed: 0,
            warning: 0,
            failed: 0
        };

        // æµ‹è¯•ç»“æœå­˜å‚¨
        let allTestResults = [];

        // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
        function updateStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('warning-tests').textContent = testStats.warning;
            document.getElementById('failed-tests').textContent = testStats.failed;
        }

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(test, result, status, details = '') {
            testStats.total++;
            testStats[status]++;
            
            allTestResults.push({
                test: test,
                result: result,
                status: status,
                details: details,
                timestamp: new Date().toISOString()
            });
            
            updateStats();
        }

        // æ¸²æŸ“æµ‹è¯•ç»“æœ
        function renderResults(results, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            let html = '';
            results.forEach(result => {
                const statusClass = result.status === 'passed' ? 'test-pass' : 
                                   result.status === 'warning' ? 'test-warning' : 'test-fail';
                const statusIcon = result.status === 'passed' ? 'fa-check-circle' : 
                                  result.status === 'warning' ? 'fa-exclamation-triangle' : 'fa-times-circle';
                
                html += `
                    <div class="test-result ${statusClass}">
                        <i class="fas ${statusIcon}"></i>
                        <strong>${result.test}:</strong> ${result.result}
                        ${result.details ? `<br><small>${result.details}</small>` : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // æµ‹è¯•æµè§ˆå™¨ç¯å¢ƒ
        function testBrowserEnvironment() {
            const results = [];
            
            // æ£€æŸ¥æ–‡æ¡£ç¼–ç 
            const docCharset = document.characterSet || document.charset;
            const charsetTest = docCharset.toLowerCase() === 'utf-8';
            results.push({
                test: 'æ–‡æ¡£å­—ç¬¦é›†',
                result: docCharset,
                status: charsetTest ? 'passed' : 'failed'
            });
            addTestResult('æ–‡æ¡£å­—ç¬¦é›†', docCharset, charsetTest ? 'passed' : 'failed');

            // æ£€æŸ¥è¯­è¨€è®¾ç½®
            const docLang = document.documentElement.lang;
            const langTest = docLang === 'zh-CN';
            results.push({
                test: 'æ–‡æ¡£è¯­è¨€',
                result: docLang,
                status: langTest ? 'passed' : 'warning'
            });
            addTestResult('æ–‡æ¡£è¯­è¨€', docLang, langTest ? 'passed' : 'warning');

            // æ£€æŸ¥æµè§ˆå™¨è¯­è¨€
            const browserLang = navigator.language;
            const browserLangTest = browserLang.includes('zh');
            results.push({
                test: 'æµè§ˆå™¨è¯­è¨€',
                result: browserLang,
                status: browserLangTest ? 'passed' : 'warning'
            });
            addTestResult('æµè§ˆå™¨è¯­è¨€', browserLang, browserLangTest ? 'passed' : 'warning');

            // æ£€æŸ¥æ—¶åŒº
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const timezoneTest = timezone.includes('Asia');
            results.push({
                test: 'æ—¶åŒºè®¾ç½®',
                result: timezone,
                status: timezoneTest ? 'passed' : 'warning'
            });
            addTestResult('æ—¶åŒºè®¾ç½®', timezone, timezoneTest ? 'passed' : 'warning');

            renderResults(results, 'browser-env-results');
        }

        // æµ‹è¯•åŸºç¡€ç¼–ç 
        function testBasicEncoding() {
            const results = [];
            const testString = "ç»´æ£®è§†è§‰æ£€æµ‹ä»ªå™¨ - ä¸“ä¸šçš„å·¥ä¸šå†…çª¥é•œè§£å†³æ–¹æ¡ˆ";

            try {
                // å­—ç¬¦ä¸²é•¿åº¦æµ‹è¯•
                results.push({
                    test: 'å­—ç¬¦ä¸²é•¿åº¦',
                    result: `${testString.length} å­—ç¬¦`,
                    status: 'passed'
                });
                addTestResult('å­—ç¬¦ä¸²é•¿åº¦', `${testString.length} å­—ç¬¦`, 'passed');

                // å­—èŠ‚é•¿åº¦æµ‹è¯•
                const byteLength = new Blob([testString]).size;
                results.push({
                    test: 'å­—èŠ‚é•¿åº¦',
                    result: `${byteLength} å­—èŠ‚`,
                    status: 'passed'
                });
                addTestResult('å­—èŠ‚é•¿åº¦', `${byteLength} å­—èŠ‚`, 'passed');

                // Unicodeæ ‡å‡†åŒ–æµ‹è¯•
                const normalized = testString.normalize('NFC');
                const normalizeTest = testString === normalized;
                results.push({
                    test: 'Unicodeæ ‡å‡†åŒ–',
                    result: normalizeTest ? 'å·²æ ‡å‡†åŒ–' : 'éœ€è¦æ ‡å‡†åŒ–',
                    status: normalizeTest ? 'passed' : 'warning'
                });
                addTestResult('Unicodeæ ‡å‡†åŒ–', normalizeTest ? 'å·²æ ‡å‡†åŒ–' : 'éœ€è¦æ ‡å‡†åŒ–', normalizeTest ? 'passed' : 'warning');

                // ä¸­æ–‡å­—ç¬¦æ£€æµ‹
                const hasChinese = /[\u4e00-\u9fff]/.test(testString);
                results.push({
                    test: 'ä¸­æ–‡å­—ç¬¦æ£€æµ‹',
                    result: hasChinese ? 'æ£€æµ‹åˆ°ä¸­æ–‡' : 'æœªæ£€æµ‹åˆ°ä¸­æ–‡',
                    status: hasChinese ? 'passed' : 'failed'
                });
                addTestResult('ä¸­æ–‡å­—ç¬¦æ£€æµ‹', hasChinese ? 'æ£€æµ‹åˆ°ä¸­æ–‡' : 'æœªæ£€æµ‹åˆ°ä¸­æ–‡', hasChinese ? 'passed' : 'failed');

            } catch (error) {
                results.push({
                    test: 'åŸºç¡€ç¼–ç æµ‹è¯•',
                    result: `é”™è¯¯: ${error.message}`,
                    status: 'failed'
                });
                addTestResult('åŸºç¡€ç¼–ç æµ‹è¯•', `é”™è¯¯: ${error.message}`, 'failed');
            }

            renderResults(results, 'encoding-basic-results');
        }

        // æµ‹è¯•URLç¼–ç 
        function testUrlEncoding() {
            const results = [];
            const testUrls = [
                "https://visndt.com/products/å·¥ä¸šå†…çª¥é•œ",
                "https://visndt.com/search?q=ç»´æ£®æ£€æµ‹",
                "https://visndt.com/cases/èˆªç©ºå‘åŠ¨æœºå¶ç‰‡æ£€æµ‹"
            ];

            testUrls.forEach((url, index) => {
                try {
                    const encoded = encodeURIComponent(url);
                    const decoded = decodeURIComponent(encoded);
                    const urlTest = url === decoded;
                    
                    results.push({
                        test: `URLç¼–ç æµ‹è¯• ${index + 1}`,
                        result: urlTest ? 'ç¼–ç æ­£å¸¸' : 'ç¼–ç å¼‚å¸¸',
                        status: urlTest ? 'passed' : 'failed',
                        details: `åŸå§‹: ${url}<br>ç¼–ç : ${encoded}<br>è§£ç : ${decoded}`
                    });
                    addTestResult(`URLç¼–ç æµ‹è¯• ${index + 1}`, urlTest ? 'ç¼–ç æ­£å¸¸' : 'ç¼–ç å¼‚å¸¸', urlTest ? 'passed' : 'failed');

                } catch (error) {
                    results.push({
                        test: `URLç¼–ç æµ‹è¯• ${index + 1}`,
                        result: `é”™è¯¯: ${error.message}`,
                        status: 'failed'
                    });
                    addTestResult(`URLç¼–ç æµ‹è¯• ${index + 1}`, `é”™è¯¯: ${error.message}`, 'failed');
                }
            });

            renderResults(results, 'url-encoding-results');
        }

        // æµ‹è¯•JSONå¤„ç†
        function testJsonProcessing() {
            const results = [];
            const testData = {
                title: "ç»´æ£®è§†è§‰æ£€æµ‹ä»ªå™¨",
                description: "ä¸“ä¸šçš„å·¥ä¸šå†…çª¥é•œè§£å†³æ–¹æ¡ˆ",
                categories: ["å·¥ä¸šæ£€æµ‹", "å†…çª¥é•œ", "è´¨é‡æ§åˆ¶"],
                specs: {
                    "åˆ†è¾¨ç‡": "1920x1080",
                    "å·¥ä½œæ¸©åº¦": "-20Â°C ~ +80Â°C",
                    "é˜²æŠ¤ç­‰çº§": "IP67"
                }
            };

            try {
                // JSONåºåˆ—åŒ–æµ‹è¯•
                const jsonString = JSON.stringify(testData);
                results.push({
                    test: 'JSONåºåˆ—åŒ–',
                    result: 'æˆåŠŸ',
                    status: 'passed',
                    details: `é•¿åº¦: ${jsonString.length} å­—ç¬¦`
                });
                addTestResult('JSONåºåˆ—åŒ–', 'æˆåŠŸ', 'passed');

                // JSONè§£ææµ‹è¯•
                const parsed = JSON.parse(jsonString);
                const parseTest = parsed.title === testData.title;
                results.push({
                    test: 'JSONè§£æ',
                    result: parseTest ? 'æˆåŠŸ' : 'å¤±è´¥',
                    status: parseTest ? 'passed' : 'failed'
                });
                addTestResult('JSONè§£æ', parseTest ? 'æˆåŠŸ' : 'å¤±è´¥', parseTest ? 'passed' : 'failed');

                // æ·±åº¦æ¯”è¾ƒæµ‹è¯•
                const deepEqual = JSON.stringify(parsed) === JSON.stringify(testData);
                results.push({
                    test: 'JSONæ·±åº¦æ¯”è¾ƒ',
                    result: deepEqual ? 'ä¸€è‡´' : 'ä¸ä¸€è‡´',
                    status: deepEqual ? 'passed' : 'failed'
                });
                addTestResult('JSONæ·±åº¦æ¯”è¾ƒ', deepEqual ? 'ä¸€è‡´' : 'ä¸ä¸€è‡´', deepEqual ? 'passed' : 'failed');

            } catch (error) {
                results.push({
                    test: 'JSONå¤„ç†',
                    result: `é”™è¯¯: ${error.message}`,
                    status: 'failed'
                });
                addTestResult('JSONå¤„ç†', `é”™è¯¯: ${error.message}`, 'failed');
            }

            renderResults(results, 'json-processing-results');
        }

        // æµ‹è¯•è¡¨å•æ•°æ®
        function testFormData() {
            const results = [];
            const input = document.getElementById('test-form-input');
            const inputValue = input.value;

            try {
                // è¡¨å•å€¼è·å–æµ‹è¯•
                results.push({
                    test: 'è¡¨å•å€¼è·å–',
                    result: 'æˆåŠŸ',
                    status: 'passed',
                    details: `å€¼: ${inputValue}`
                });
                addTestResult('è¡¨å•å€¼è·å–', 'æˆåŠŸ', 'passed');

                // è¡¨å•æ•°æ®ç¼–ç æµ‹è¯•
                const formData = new FormData();
                formData.append('title', inputValue);
                
                const formValue = formData.get('title');
                const formTest = formValue === inputValue;
                results.push({
                    test: 'FormDataç¼–ç ',
                    result: formTest ? 'æ­£å¸¸' : 'å¼‚å¸¸',
                    status: formTest ? 'passed' : 'failed'
                });
                addTestResult('FormDataç¼–ç ', formTest ? 'æ­£å¸¸' : 'å¼‚å¸¸', formTest ? 'passed' : 'failed');

                // URLSearchParamsæµ‹è¯•
                const params = new URLSearchParams();
                params.append('q', inputValue);
                const paramValue = params.get('q');
                const paramTest = paramValue === inputValue;
                results.push({
                    test: 'URLSearchParamsç¼–ç ',
                    result: paramTest ? 'æ­£å¸¸' : 'å¼‚å¸¸',
                    status: paramTest ? 'passed' : 'failed'
                });
                addTestResult('URLSearchParamsç¼–ç ', paramTest ? 'æ­£å¸¸' : 'å¼‚å¸¸', paramTest ? 'passed' : 'failed');

            } catch (error) {
                results.push({
                    test: 'è¡¨å•æ•°æ®æµ‹è¯•',
                    result: `é”™è¯¯: ${error.message}`,
                    status: 'failed'
                });
                addTestResult('è¡¨å•æ•°æ®æµ‹è¯•', `é”™è¯¯: ${error.message}`, 'failed');
            }

            renderResults(results, 'form-data-results');
        }

        // æµ‹è¯•æœ¬åœ°å­˜å‚¨
        function testLocalStorage() {
            const results = [];
            const testKey = 'visndt_encoding_test';
            const testData = {
                title: "ç»´æ£®è§†è§‰æ£€æµ‹ä»ªå™¨",
                timestamp: new Date().toISOString(),
                chinese: "ä¸­æ–‡å­—ç¬¦æµ‹è¯•"
            };

            try {
                // localStorageå­˜å‚¨æµ‹è¯•
                localStorage.setItem(testKey, JSON.stringify(testData));
                results.push({
                    test: 'localStorageå­˜å‚¨',
                    result: 'æˆåŠŸ',
                    status: 'passed'
                });
                addTestResult('localStorageå­˜å‚¨', 'æˆåŠŸ', 'passed');

                // localStorageè¯»å–æµ‹è¯•
                const stored = localStorage.getItem(testKey);
                const parsed = JSON.parse(stored);
                const storageTest = parsed.title === testData.title;
                results.push({
                    test: 'localStorageè¯»å–',
                    result: storageTest ? 'æˆåŠŸ' : 'å¤±è´¥',
                    status: storageTest ? 'passed' : 'failed'
                });
                addTestResult('localStorageè¯»å–', storageTest ? 'æˆåŠŸ' : 'å¤±è´¥', storageTest ? 'passed' : 'failed');

                // sessionStorageæµ‹è¯•
                sessionStorage.setItem(testKey, JSON.stringify(testData));
                const sessionStored = sessionStorage.getItem(testKey);
                const sessionParsed = JSON.parse(sessionStored);
                const sessionTest = sessionParsed.title === testData.title;
                results.push({
                    test: 'sessionStorageæµ‹è¯•',
                    result: sessionTest ? 'æˆåŠŸ' : 'å¤±è´¥',
                    status: sessionTest ? 'passed' : 'failed'
                });
                addTestResult('sessionStorageæµ‹è¯•', sessionTest ? 'æˆåŠŸ' : 'å¤±è´¥', sessionTest ? 'passed' : 'failed');

                // æ¸…ç†æµ‹è¯•æ•°æ®
                localStorage.removeItem(testKey);
                sessionStorage.removeItem(testKey);

            } catch (error) {
                results.push({
                    test: 'æœ¬åœ°å­˜å‚¨æµ‹è¯•',
                    result: `é”™è¯¯: ${error.message}`,
                    status: 'failed'
                });
                addTestResult('æœ¬åœ°å­˜å‚¨æµ‹è¯•', `é”™è¯¯: ${error.message}`, 'failed');
            }

            renderResults(results, 'storage-results');
        }

        // æµ‹è¯•ç½‘ç»œè¯·æ±‚
        function testNetworkRequests() {
            const results = [];
            
            // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚æµ‹è¯•
            const testData = {
                title: "ç»´æ£®è§†è§‰æ£€æµ‹ä»ªå™¨",
                description: "ä¸“ä¸šçš„å·¥ä¸šå†…çª¥é•œè§£å†³æ–¹æ¡ˆ"
            };

            try {
                // æµ‹è¯•è¯·æ±‚å¤´ç¼–ç 
                const headers = new Headers();
                headers.append('Content-Type', 'application/json; charset=utf-8');
                headers.append('Accept', 'application/json');
                
                results.push({
                    test: 'è¯·æ±‚å¤´è®¾ç½®',
                    result: 'æˆåŠŸ',
                    status: 'passed',
                    details: 'Content-Type: application/json; charset=utf-8'
                });
                addTestResult('è¯·æ±‚å¤´è®¾ç½®', 'æˆåŠŸ', 'passed');

                // æµ‹è¯•è¯·æ±‚ä½“ç¼–ç 
                const requestBody = JSON.stringify(testData);
                const bodyTest = requestBody.includes(testData.title);
                results.push({
                    test: 'è¯·æ±‚ä½“ç¼–ç ',
                    result: bodyTest ? 'æ­£å¸¸' : 'å¼‚å¸¸',
                    status: bodyTest ? 'passed' : 'failed'
                });
                addTestResult('è¯·æ±‚ä½“ç¼–ç ', bodyTest ? 'æ­£å¸¸' : 'å¼‚å¸¸', bodyTest ? 'passed' : 'failed');

                // æµ‹è¯•Blobç¼–ç 
                const blob = new Blob([requestBody], { type: 'application/json; charset=utf-8' });
                results.push({
                    test: 'Blobç¼–ç ',
                    result: 'æˆåŠŸ',
                    status: 'passed',
                    details: `å¤§å°: ${blob.size} å­—èŠ‚`
                });
                addTestResult('Blobç¼–ç ', 'æˆåŠŸ', 'passed');

            } catch (error) {
                results.push({
                    test: 'ç½‘ç»œè¯·æ±‚æµ‹è¯•',
                    result: `é”™è¯¯: ${error.message}`,
                    status: 'failed'
                });
                addTestResult('ç½‘ç»œè¯·æ±‚æµ‹è¯•', `é”™è¯¯: ${error.message}`, 'failed');
            }

            renderResults(results, 'network-results');
        }

        // ç”Ÿæˆç»¼åˆæŠ¥å‘Š
        function generateComprehensiveReport() {
            const report = {
                timestamp: new Date().toLocaleString('zh-CN'),
                stats: testStats,
                environment: {
                    userAgent: navigator.userAgent,
                    language: navigator.language,
                    charset: document.characterSet,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                },
                results: allTestResults
            };

            const reportHtml = `
                <div class="alert alert-primary">
                    <h5>ğŸ“Š ç»¼åˆæµ‹è¯•æŠ¥å‘Š</h5>
                    <p><strong>ç”Ÿæˆæ—¶é—´:</strong> ${report.timestamp}</p>
                    <p><strong>æ€»æµ‹è¯•é¡¹:</strong> ${report.stats.total}</p>
                    <p><strong>é€šè¿‡:</strong> <span class="text-success">${report.stats.passed}</span></p>
                    <p><strong>è­¦å‘Š:</strong> <span class="text-warning">${report.stats.warning}</span></p>
                    <p><strong>å¤±è´¥:</strong> <span class="text-danger">${report.stats.failed}</span></p>
                    <p><strong>æˆåŠŸç‡:</strong> ${report.stats.total > 0 ? ((report.stats.passed / report.stats.total) * 100).toFixed(1) : 0}%</p>
                </div>
                <div class="code-display">
                    ${JSON.stringify(report, null, 2)}
                </div>
                <button class="btn btn-outline-secondary mt-2" onclick="downloadReport()">
                    <i class="fas fa-download"></i> ä¸‹è½½æŠ¥å‘Š
                </button>
            `;

            document.getElementById('comprehensive-report').innerHTML = reportHtml;
            
            // å­˜å‚¨æŠ¥å‘Šæ•°æ®ä¾›ä¸‹è½½ä½¿ç”¨
            window.encodingTestReport = report;
        }

        // ä¸‹è½½æŠ¥å‘Š
        function downloadReport() {
            if (!window.encodingTestReport) {
                alert('è¯·å…ˆç”ŸæˆæŠ¥å‘Š');
                return;
            }

            const reportJson = JSON.stringify(window.encodingTestReport, null, 2);
            const blob = new Blob([reportJson], { type: 'application/json; charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `visndt-encoding-test-report-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            testBrowserEnvironment();
            testBasicEncoding();
        });
    </script>
</body>
</html>
