<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº§å“è¡¨å•æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>äº§å“è¡¨å•åŠŸèƒ½æµ‹è¯•</h2>
        
        <div class="row">
            <div class="col-md-6">
                <h4>åˆ†ç±»é€‰æ‹©æµ‹è¯•</h4>
                <div class="mb-3">
                    <label class="form-label">ä¸»è¦åˆ†ç±»</label>
                    <select class="form-select" id="testPrimaryCategory" onchange="updateTestSecondaryCategories()">
                        <option value="">é€‰æ‹©ä¸»è¦åˆ†ç±»</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">æ¬¡è¦åˆ†ç±»</label>
                    <select class="form-select" id="testSecondaryCategory">
                        <option value="">é€‰æ‹©æ¬¡è¦åˆ†ç±»</option>
                    </select>
                </div>
            </div>
            
            <div class="col-md-6">
                <h4>ä¾›åº”å•†é€‰æ‹©æµ‹è¯•</h4>
                <div class="mb-3">
                    <label class="form-label">ä¾›åº”å•†</label>
                    <select class="form-select" id="testSupplier" onchange="updateTestProductSeries()">
                        <option value="">é€‰æ‹©ä¾›åº”å•†</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">äº§å“ç³»åˆ—</label>
                    <select class="form-select" id="testProductSeries">
                        <option value="">é€‰æ‹©äº§å“ç³»åˆ—</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h4>å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æµ‹è¯•</h4>
                <div class="mb-3">
                    <label class="form-label">è¯¦ç»†æè¿°</label>
                    <div id="testDescriptionEditor" style="height: 200px;"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label">åº”ç”¨åœºæ™¯</label>
                    <div id="testApplicationEditor" style="height: 150px;"></div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h4>å‚æ•°æ¨¡æ¿æµ‹è¯•</h4>
                <div class="mb-3">
                    <button type="button" class="btn btn-primary" onclick="loadTestParameterTemplate()">
                        <i class="fas fa-magic me-1"></i>åŠ è½½å‚æ•°æ¨¡æ¿
                    </button>
                    <button type="button" class="btn btn-success" onclick="addTestParameter()">
                        <i class="fas fa-plus me-1"></i>æ·»åŠ å‚æ•°
                    </button>
                </div>
                <div id="testParametersContainer"></div>
            </div>
        </div>
        
        <div class="mt-4">
            <button type="button" class="btn btn-info" onclick="initializeTestForm()">
                <i class="fas fa-sync me-1"></i>åˆå§‹åŒ–è¡¨å•
            </button>
            <button type="button" class="btn btn-warning" onclick="debugTestData()">
                <i class="fas fa-bug me-1"></i>è°ƒè¯•æ•°æ®
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script>
        // æµ‹è¯•æ•°æ®
        const testCategoryHierarchy = {
            'ç”µå­å†…çª¥é•œ': ['å·¥ä¸šç®¡é“å†…çª¥é•œ', 'æ±½è½¦æ£€æµ‹å†…çª¥é•œ', 'ç”µå­è®¾å¤‡å†…çª¥é•œ', 'ä¾¿æºå¼å†…çª¥é•œ'],
            'å…‰çº¤å†…çª¥é•œ': ['åŒ»ç–—å…‰çº¤å†…çª¥é•œ', 'å·¥ä¸šå…‰çº¤å†…çª¥é•œ', 'ç§‘ç ”å…‰çº¤å†…çª¥é•œ', 'é«˜ç²¾åº¦å…‰çº¤å†…çª¥é•œ'],
            'å…‰å­¦å†…çª¥é•œ': ['ä¼ ç»Ÿå…‰å­¦å†…çª¥é•œ', 'é«˜å€å…‰å­¦å†…çª¥é•œ', 'ä¾¿æºå…‰å­¦å†…çª¥é•œ', 'ä¸“ä¸šå…‰å­¦å†…çª¥é•œ'],
            'å†…çª¥é•œé…ä»¶': ['æ¢å¤´é…ä»¶', 'å…‰æºé…ä»¶', 'æ˜¾ç¤ºé…ä»¶', 'å­˜å‚¨é…ä»¶']
        };

        const testSupplierSeriesMap = {
            'æ·±åœ³å¸‚å¾®è§†å…‰ç”µç§‘æŠ€æœ‰é™å…¬å¸': ['Kç³»åˆ—', 'Pç³»åˆ—', 'DZç³»åˆ—', 'Sç³»åˆ—', 'Fç³»åˆ—', 'LAç³»åˆ—'],
            'å¤©æ´¥ç»´æ£®ç§‘æŠ€æœ‰é™å…¬å¸': ['VIS-Pç³»åˆ—', 'VIS-Tç³»åˆ—'],
            'ä¸Šæµ·å°šå“ç§‘æŠ€æœ‰é™å…¬å¸': ['Gç³»åˆ—', 'Lç³»åˆ—', 'Mç³»åˆ—']
        };

        const testDefaultParameterTemplates = {
            'ç”µå­å†…çª¥é•œ': [
                { name: 'ä¸»æœºå±å¹•', value: '6è‹±å¯¸' },
                { name: 'å¾…æœºæ—¶é•¿', value: '8å°æ—¶' },
                { name: 'æ¢å¤´ç›´å¾„', value: '2.8mm' },
                { name: 'åƒç´ ', value: '100ä¸‡' },
                { name: 'æ™¯æ·±', value: '3mm~70mm' },
                { name: 'è§†åœºè§’', value: '120åº¦' },
                { name: 'è§†å‘', value: 'ç›´è§†' },
                { name: 'å…‰æº', value: 'å…‰çº¤å…‰æº' }
            ]
        };

        let testDescriptionEditor = null;
        let testApplicationEditor = null;

        function initializeTestForm() {
            console.log('ğŸ”§ åˆå§‹åŒ–æµ‹è¯•è¡¨å•...');
            
            // åˆå§‹åŒ–åˆ†ç±»é€‰é¡¹
            const primaryCategorySelect = document.getElementById('testPrimaryCategory');
            primaryCategorySelect.innerHTML = '<option value="">é€‰æ‹©ä¸»è¦åˆ†ç±»</option>';
            Object.keys(testCategoryHierarchy).forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                primaryCategorySelect.appendChild(option);
            });

            // åˆå§‹åŒ–ä¾›åº”å•†é€‰é¡¹
            const supplierSelect = document.getElementById('testSupplier');
            supplierSelect.innerHTML = '<option value="">é€‰æ‹©ä¾›åº”å•†</option>';
            Object.keys(testSupplierSeriesMap).forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier;
                option.textContent = supplier;
                supplierSelect.appendChild(option);
            });

            // åˆå§‹åŒ–ç¼–è¾‘å™¨
            initializeTestEditors();
            
            console.log('âœ… æµ‹è¯•è¡¨å•åˆå§‹åŒ–å®Œæˆ');
        }

        function initializeTestEditors() {
            console.log('ğŸ“ åˆå§‹åŒ–æµ‹è¯•ç¼–è¾‘å™¨...');
            console.log('ğŸ” Quillæ˜¯å¦å¯ç”¨:', typeof Quill !== 'undefined');
            
            if (!testDescriptionEditor && typeof Quill !== 'undefined') {
                testDescriptionEditor = new Quill('#testDescriptionEditor', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline'],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                            ['link', 'image'],
                            ['clean']
                        ]
                    }
                });
                console.log('âœ… è¯¦ç»†æè¿°ç¼–è¾‘å™¨åˆ›å»ºæˆåŠŸ');
            }

            if (!testApplicationEditor && typeof Quill !== 'undefined') {
                testApplicationEditor = new Quill('#testApplicationEditor', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            [{ 'header': [1, 2, 3, false] }],
                            ['bold', 'italic', 'underline'],
                            ['link'],
                            ['clean']
                        ]
                    }
                });
                console.log('âœ… åº”ç”¨åœºæ™¯ç¼–è¾‘å™¨åˆ›å»ºæˆåŠŸ');
            }
        }

        function updateTestSecondaryCategories() {
            const primaryCategory = document.getElementById('testPrimaryCategory').value;
            const secondarySelect = document.getElementById('testSecondaryCategory');
            
            secondarySelect.innerHTML = '<option value="">é€‰æ‹©æ¬¡è¦åˆ†ç±»</option>';
            
            if (primaryCategory && testCategoryHierarchy[primaryCategory]) {
                testCategoryHierarchy[primaryCategory].forEach(subCategory => {
                    const option = document.createElement('option');
                    option.value = subCategory;
                    option.textContent = subCategory;
                    secondarySelect.appendChild(option);
                });
            }
        }

        function updateTestProductSeries() {
            const supplier = document.getElementById('testSupplier').value;
            const seriesSelect = document.getElementById('testProductSeries');
            
            seriesSelect.innerHTML = '<option value="">é€‰æ‹©äº§å“ç³»åˆ—</option>';
            
            if (supplier && testSupplierSeriesMap[supplier]) {
                testSupplierSeriesMap[supplier].forEach(series => {
                    const option = document.createElement('option');
                    option.value = series;
                    option.textContent = series;
                    seriesSelect.appendChild(option);
                });
            }
        }

        function loadTestParameterTemplate() {
            const category = document.getElementById('testPrimaryCategory').value;
            const container = document.getElementById('testParametersContainer');

            if (!category || !testDefaultParameterTemplates[category]) {
                alert('è¯·å…ˆé€‰æ‹©äº§å“åˆ†ç±»');
                return;
            }

            container.innerHTML = '';
            testDefaultParameterTemplates[category].forEach(param => {
                addTestParameter(param.name, param.value);
            });
        }

        function addTestParameter(name = '', value = '') {
            const container = document.getElementById('testParametersContainer');
            const parameterId = 'param-' + Date.now();

            const parameterDiv = document.createElement('div');
            parameterDiv.className = 'row mb-2';
            parameterDiv.innerHTML = `
                <div class="col-md-5">
                    <input type="text" class="form-control" placeholder="å‚æ•°åç§°" value="${name}">
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control" placeholder="å‚æ•°å€¼" value="${value}">
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="this.closest('.row').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            container.appendChild(parameterDiv);
        }

        function debugTestData() {
            console.log('ğŸ› è°ƒè¯•æµ‹è¯•æ•°æ®...');
            console.log('åˆ†ç±»æ•°æ®:', testCategoryHierarchy);
            console.log('ä¾›åº”å•†æ•°æ®:', testSupplierSeriesMap);
            console.log('å‚æ•°æ¨¡æ¿:', testDefaultParameterTemplates);
            console.log('ç¼–è¾‘å™¨çŠ¶æ€:', {
                description: testDescriptionEditor,
                application: testApplicationEditor
            });
            alert('è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            setTimeout(() => {
                initializeTestForm();
            }, 500);
        });
    </script>
</body>
</html>
