<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>供应商管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .supplier-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        .supplier-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .supplier-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }
        .supplier-info {
            flex: 1;
        }
        .supplier-actions {
            display: flex;
            gap: 8px;
        }
        .supplier-logo {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
            border: 2px solid #e9ecef;
        }
        .supplier-stats {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .form-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .section-title {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        .series-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin: 2px;
            display: inline-block;
        }
        .model-tag {
            background: #f3e5f5;
            color: #7b1fa2;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 11px;
            margin: 2px;
            display: inline-block;
        }
        .contact-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        .gallery-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .gallery-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 1;
        }
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .gallery-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(220, 53, 69, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tag-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            padding: 8px;
            min-height: 38px;
            align-items: center;
        }
        .tag-item {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .tag-item .remove {
            cursor: pointer;
            font-weight: bold;
        }
        .tag-input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 100px;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1><i class="fas fa-truck me-2"></i>供应商管理系统</h1>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="showAddSupplierForm()">
                            <i class="fas fa-plus me-1"></i>添加供应商
                        </button>
                        <button class="btn btn-primary" onclick="syncSuppliers()">
                            <i class="fas fa-sync me-1"></i>同步数据
                        </button>
                        <button class="btn btn-info" onclick="exportSuppliers()">
                            <i class="fas fa-download me-1"></i>导出数据
                        </button>
                    </div>
                </div>

                <!-- 统计信息 -->
                <div class="supplier-stats">
                    <div class="row text-center">
                        <div class="col-3">
                            <div class="h4 mb-1" id="totalSuppliers">0</div>
                            <div class="small">总供应商数</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="manufacturerCount">0</div>
                            <div class="small">制造商</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="traderCount">0</div>
                            <div class="small">贸易商</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="totalProducts">0</div>
                            <div class="small">关联产品</div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- 供应商表单 -->
                    <div class="col-md-5">
                        <div class="form-section" id="supplierForm">
                            <h3 class="section-title">供应商信息</h3>
                            
                            <div class="mb-3">
                                <label class="form-label">供应商名称 *</label>
                                <input type="text" class="form-control" id="supplierName" placeholder="输入供应商完整名称">
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">供应商类型</label>
                                        <select class="form-select" id="supplierType">
                                            <option value="制造商">制造商</option>
                                            <option value="贸易商">贸易商</option>
                                            <option value="代理商">代理商</option>
                                            <option value="经销商">经销商</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">状态</label>
                                        <select class="form-select" id="supplierStatus">
                                            <option value="active">活跃</option>
                                            <option value="inactive">停用</option>
                                            <option value="pending">待审核</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">公司地址</label>
                                <input type="text" class="form-control" id="supplierAddress" placeholder="输入详细地址">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">公司描述</label>
                                <textarea class="form-control" id="supplierDescription" rows="4" placeholder="描述公司业务范围、优势等"></textarea>
                            </div>

                            <!-- 产品系列 -->
                            <div class="mb-3">
                                <label class="form-label">产品系列</label>
                                <div class="tag-input-container" id="seriesContainer">
                                    <input type="text" class="tag-input" id="seriesInput" placeholder="输入系列名称，按回车添加" onkeypress="addSeries(event)">
                                </div>
                                <small class="text-muted">输入系列名称后按回车键添加</small>
                            </div>

                            <!-- 产品型号 -->
                            <div class="mb-3">
                                <label class="form-label">产品型号</label>
                                <div class="tag-input-container" id="modelsContainer">
                                    <input type="text" class="tag-input" id="modelsInput" placeholder="输入型号，按回车添加" onkeypress="addModel(event)">
                                </div>
                                <small class="text-muted">输入产品型号后按回车键添加</small>
                            </div>

                            <!-- 联系信息 -->
                            <h6 class="text-muted mt-4 mb-3">联系信息</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">联系人</label>
                                        <input type="text" class="form-control" id="contactPerson" placeholder="联系人姓名">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">职位</label>
                                        <input type="text" class="form-control" id="contactPosition" placeholder="联系人职位">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">联系电话</label>
                                        <input type="tel" class="form-control" id="contactPhone" placeholder="联系电话">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">邮箱</label>
                                        <input type="email" class="form-control" id="contactEmail" placeholder="联系邮箱">
                                    </div>
                                </div>
                            </div>

                            <!-- 公司图库 -->
                            <div class="mb-3">
                                <label class="form-label">公司图库</label>
                                <div class="d-flex gap-2 mb-2">
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addGalleryImage()">
                                        <i class="fas fa-plus me-1"></i>添加图片
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearGallery()">
                                        <i class="fas fa-trash me-1"></i>清空图库
                                    </button>
                                </div>
                                <div class="gallery-preview" id="galleryPreview">
                                    <!-- 图片预览将在这里显示 -->
                                </div>
                            </div>

                            <div class="d-flex gap-2">
                                <button class="btn btn-primary" onclick="saveSupplier()">
                                    <i class="fas fa-save me-1"></i>保存供应商
                                </button>
                                <button class="btn btn-secondary" onclick="clearForm()">
                                    <i class="fas fa-times me-1"></i>清空表单
                                </button>
                                <button class="btn btn-info" onclick="previewSupplier()">
                                    <i class="fas fa-eye me-1"></i>预览
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 供应商列表 -->
                    <div class="col-md-7">
                        <div class="form-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h3 class="section-title mb-0">供应商列表</h3>
                                <div class="d-flex gap-2">
                                    <input type="text" class="form-control form-control-sm" placeholder="搜索供应商..." id="searchInput" onkeyup="searchSuppliers()">
                                    <select class="form-select form-select-sm" id="typeFilter" onchange="filterSuppliers()">
                                        <option value="">所有类型</option>
                                        <option value="制造商">制造商</option>
                                        <option value="贸易商">贸易商</option>
                                        <option value="代理商">代理商</option>
                                        <option value="经销商">经销商</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div id="supplierList">
                                <!-- 供应商卡片将动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 预览模态框 -->
    <div class="modal fade" id="previewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">供应商预览</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="previewContent">
                    <!-- 预览内容 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="generateMarkdown()">生成Markdown</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 全局变量
        let suppliers = [];
        let currentEditingId = null;
        let seriesList = [];
        let modelsList = [];
        let galleryImages = [];

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeSupplierManager();
            loadSuppliers();
        });

        // 初始化供应商管理器
        function initializeSupplierManager() {
            console.log('🚀 供应商管理系统初始化');
            updateStats();
        }

        // 加载供应商数据（模拟）
        function loadSuppliers() {
            // 模拟供应商数据
            suppliers = [
                {
                    id: 1,
                    name: '深圳市微视光电科技有限公司',
                    type: '制造商',
                    address: '广东省深圳市南山区科技园',
                    description: '深圳市微视光电科技有限公司位于深圳坪山首座大厦，是一家集研发、生产、销售、项目和服务于一体的国家高新技术企业。',
                    series: ['DZ系列', 'S系列', 'F系列', 'P系列', 'K系列', 'LA系列'],
                    models: ['0.85mm', '0.95mm', '1mm', '1.2mm', '1.8mm', '2mm', '2.2mm', '2.4mm', '2.8mm', '3.9mm', '6mm'],
                    contactPerson: '王轩',
                    contactPosition: '区域经理',
                    contactPhone: '15222189183',
                    contactEmail: 'wangxuan@sz-wise.cn',
                    gallery: ['/images/supplier/vsndt-1.png', '/images/supplier/vsndt-2.png', '/images/supplier/vsndt-3.png'],
                    status: 'active',
                    productCount: 25
                },
                {
                    id: 2,
                    name: '天津维森科技有限公司',
                    type: '贸易商',
                    address: '天津市河西区',
                    description: '天津维森科技有限公司是一家专注仪器仪表、检测量具、刀具的机电设备服务商。',
                    series: ['VIS-P系列', 'VIS-T系列'],
                    models: ['0.95mm', '1.8mm', '2.8mm', '3.9mm', '6mm'],
                    contactPerson: '张经理',
                    contactPosition: '市场经理',
                    contactPhone: '13000000000',
                    contactEmail: '738373748@qq.com',
                    gallery: ['https://picsum.photos/300/200', 'https://picsum.photos/300/200', 'https://picsum.photos/300/200'],
                    status: 'active',
                    productCount: 12
                }
            ];

            renderSupplierList();
            updateStats();
        }

        // 渲染供应商列表
        function renderSupplierList() {
            const listContainer = document.getElementById('supplierList');

            if (suppliers.length === 0) {
                listContainer.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-truck fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">暂无供应商</h5>
                        <p class="text-muted">点击"添加供应商"创建第一个供应商</p>
                    </div>
                `;
                return;
            }

            listContainer.innerHTML = suppliers.map(supplier => `
                <div class="supplier-card" data-supplier-id="${supplier.id}">
                    <div class="supplier-header">
                        <div class="supplier-info">
                            <div class="d-flex align-items-center mb-2">
                                <h5 class="mb-0 me-2">${supplier.name}</h5>
                                <span class="badge bg-${getTypeColor(supplier.type)}">${supplier.type}</span>
                                <span class="badge bg-${supplier.status === 'active' ? 'success' : 'secondary'} ms-1">
                                    ${getStatusText(supplier.status)}
                                </span>
                            </div>
                            <div class="text-muted small mb-2">
                                <i class="fas fa-map-marker-alt me-1"></i>${supplier.address}
                            </div>
                            <div class="text-muted small">${supplier.description}</div>
                        </div>
                        <div class="supplier-actions">
                            <button class="btn btn-sm btn-outline-primary" onclick="editSupplier(${supplier.id})" title="编辑">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-info" onclick="viewSupplierProducts(${supplier.id})" title="查看产品">
                                <i class="fas fa-box"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteSupplier(${supplier.id})" title="删除">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="contact-info">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <strong>联系人:</strong> ${supplier.contactPerson} (${supplier.contactPosition})
                                </div>
                                <div class="mb-2">
                                    <strong>电话:</strong> ${supplier.contactPhone}
                                </div>
                                <div class="mb-2">
                                    <strong>邮箱:</strong> ${supplier.contactEmail}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <strong>产品系列:</strong><br>
                                    ${supplier.series.map(series => `<span class="series-tag">${series}</span>`).join('')}
                                </div>
                                <div class="mb-2">
                                    <strong>产品型号:</strong><br>
                                    ${supplier.models.slice(0, 8).map(model => `<span class="model-tag">${model}</span>`).join('')}
                                    ${supplier.models.length > 8 ? `<span class="model-tag">+${supplier.models.length - 8}更多</span>` : ''}
                                </div>
                                <div class="mb-2">
                                    <strong>关联产品:</strong> <span class="badge bg-primary">${supplier.productCount}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // 获取类型颜色
        function getTypeColor(type) {
            const colors = {
                '制造商': 'primary',
                '贸易商': 'info',
                '代理商': 'warning',
                '经销商': 'secondary'
            };
            return colors[type] || 'secondary';
        }

        // 获取状态文本
        function getStatusText(status) {
            const texts = {
                'active': '活跃',
                'inactive': '停用',
                'pending': '待审核'
            };
            return texts[status] || status;
        }

        // 更新统计信息
        function updateStats() {
            const totalSuppliers = suppliers.length;
            const manufacturerCount = suppliers.filter(s => s.type === '制造商').length;
            const traderCount = suppliers.filter(s => s.type === '贸易商').length;
            const totalProducts = suppliers.reduce((sum, s) => sum + (s.productCount || 0), 0);

            document.getElementById('totalSuppliers').textContent = totalSuppliers;
            document.getElementById('manufacturerCount').textContent = manufacturerCount;
            document.getElementById('traderCount').textContent = traderCount;
            document.getElementById('totalProducts').textContent = totalProducts;
        }

        // 添加系列
        function addSeries(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = event.target;
                const value = input.value.trim();

                if (value && !seriesList.includes(value)) {
                    seriesList.push(value);
                    renderSeriesTags();
                    input.value = '';
                }
            }
        }

        // 渲染系列标签
        function renderSeriesTags() {
            const container = document.getElementById('seriesContainer');
            const input = container.querySelector('.tag-input');

            // 清除现有标签
            container.querySelectorAll('.tag-item').forEach(tag => tag.remove());

            // 添加新标签
            seriesList.forEach((series, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag-item';
                tagElement.innerHTML = `
                    ${series}
                    <span class="remove" onclick="removeSeries(${index})">&times;</span>
                `;
                container.insertBefore(tagElement, input);
            });
        }

        // 删除系列
        function removeSeries(index) {
            seriesList.splice(index, 1);
            renderSeriesTags();
        }

        // 添加型号
        function addModel(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = event.target;
                const value = input.value.trim();

                if (value && !modelsList.includes(value)) {
                    modelsList.push(value);
                    renderModelTags();
                    input.value = '';
                }
            }
        }

        // 渲染型号标签
        function renderModelTags() {
            const container = document.getElementById('modelsContainer');
            const input = container.querySelector('.tag-input');

            // 清除现有标签
            container.querySelectorAll('.tag-item').forEach(tag => tag.remove());

            // 添加新标签
            modelsList.forEach((model, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag-item';
                tagElement.innerHTML = `
                    ${model}
                    <span class="remove" onclick="removeModel(${index})">&times;</span>
                `;
                container.insertBefore(tagElement, input);
            });
        }

        // 删除型号
        function removeModel(index) {
            modelsList.splice(index, 1);
            renderModelTags();
        }

        // 添加图库图片
        function addGalleryImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.multiple = true;
            input.onchange = function(e) {
                Array.from(e.target.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        galleryImages.push(e.target.result);
                        renderGallery();
                    };
                    reader.readAsDataURL(file);
                });
            };
            input.click();
        }

        // 渲染图库
        function renderGallery() {
            const container = document.getElementById('galleryPreview');

            if (galleryImages.length === 0) {
                container.innerHTML = '<div class="text-muted text-center py-3">暂无图片</div>';
                return;
            }

            container.innerHTML = galleryImages.map((image, index) => `
                <div class="gallery-item">
                    <img src="${image}" alt="供应商图片 ${index + 1}">
                    <button class="remove-btn" onclick="removeGalleryImage(${index})" title="删除">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        // 删除图库图片
        function removeGalleryImage(index) {
            galleryImages.splice(index, 1);
            renderGallery();
        }

        // 清空图库
        function clearGallery() {
            galleryImages = [];
            renderGallery();
        }

        // 显示添加供应商表单
        function showAddSupplierForm() {
            clearForm();
            currentEditingId = null;
            document.querySelector('.section-title').textContent = '添加供应商';
        }

        // 编辑供应商
        function editSupplier(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;

            currentEditingId = supplierId;

            // 填充表单
            document.getElementById('supplierName').value = supplier.name;
            document.getElementById('supplierType').value = supplier.type;
            document.getElementById('supplierAddress').value = supplier.address;
            document.getElementById('supplierDescription').value = supplier.description;
            document.getElementById('contactPerson').value = supplier.contactPerson;
            document.getElementById('contactPosition').value = supplier.contactPosition;
            document.getElementById('contactPhone').value = supplier.contactPhone;
            document.getElementById('contactEmail').value = supplier.contactEmail;
            document.getElementById('supplierStatus').value = supplier.status;

            // 填充系列和型号
            seriesList = [...supplier.series];
            modelsList = [...supplier.models];
            galleryImages = [...supplier.gallery];

            renderSeriesTags();
            renderModelTags();
            renderGallery();

            document.querySelector('.section-title').textContent = '编辑供应商';
        }

        // 保存供应商
        function saveSupplier() {
            const supplierData = collectFormData();

            if (!validateSupplierData(supplierData)) {
                return;
            }

            if (currentEditingId) {
                // 更新现有供应商
                const index = suppliers.findIndex(s => s.id === currentEditingId);
                if (index !== -1) {
                    suppliers[index] = { ...suppliers[index], ...supplierData, id: currentEditingId };
                }
            } else {
                // 添加新供应商
                const newId = Math.max(...suppliers.map(s => s.id), 0) + 1;
                suppliers.push({ ...supplierData, id: newId, productCount: 0 });
            }

            renderSupplierList();
            updateStats();
            clearForm();

            showNotification(currentEditingId ? '供应商更新成功！' : '供应商添加成功！', 'success');
            currentEditingId = null;
        }

        // 收集表单数据
        function collectFormData() {
            return {
                name: document.getElementById('supplierName').value,
                type: document.getElementById('supplierType').value,
                address: document.getElementById('supplierAddress').value,
                description: document.getElementById('supplierDescription').value,
                contactPerson: document.getElementById('contactPerson').value,
                contactPosition: document.getElementById('contactPosition').value,
                contactPhone: document.getElementById('contactPhone').value,
                contactEmail: document.getElementById('contactEmail').value,
                status: document.getElementById('supplierStatus').value,
                series: [...seriesList],
                models: [...modelsList],
                gallery: [...galleryImages]
            };
        }

        // 验证供应商数据
        function validateSupplierData(data) {
            const errors = [];

            if (!data.name.trim()) {
                errors.push('供应商名称不能为空');
            }

            if (!data.contactPerson.trim()) {
                errors.push('联系人不能为空');
            }

            if (data.contactPhone && !/^1[3-9]\d{9}$/.test(data.contactPhone)) {
                errors.push('请输入正确的手机号码');
            }

            if (data.contactEmail && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.contactEmail)) {
                errors.push('请输入正确的邮箱地址');
            }

            // 检查名称重复
            const existingSupplier = suppliers.find(s =>
                s.name === data.name && s.id !== currentEditingId
            );
            if (existingSupplier) {
                errors.push('供应商名称已存在');
            }

            if (errors.length > 0) {
                alert('请修正以下错误：\n\n' + errors.join('\n'));
                return false;
            }

            return true;
        }

        // 删除供应商
        function deleteSupplier(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;

            // 检查是否有关联产品
            if (supplier.productCount > 0) {
                if (!confirm(`该供应商下有 ${supplier.productCount} 个产品，删除后这些产品将失去供应商关联。确定要删除吗？`)) {
                    return;
                }
            }

            if (confirm(`确定要删除供应商"${supplier.name}"吗？此操作不可撤销！`)) {
                suppliers = suppliers.filter(s => s.id !== supplierId);
                renderSupplierList();
                updateStats();
                showNotification('供应商删除成功！', 'success');
            }
        }

        // 查看供应商产品
        function viewSupplierProducts(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;

            showNotification(`查看供应商"${supplier.name}"的产品功能开发中...`, 'info');
        }

        // 清空表单
        function clearForm() {
            document.getElementById('supplierName').value = '';
            document.getElementById('supplierType').value = '制造商';
            document.getElementById('supplierAddress').value = '';
            document.getElementById('supplierDescription').value = '';
            document.getElementById('contactPerson').value = '';
            document.getElementById('contactPosition').value = '';
            document.getElementById('contactPhone').value = '';
            document.getElementById('contactEmail').value = '';
            document.getElementById('supplierStatus').value = 'active';

            seriesList = [];
            modelsList = [];
            galleryImages = [];

            renderSeriesTags();
            renderModelTags();
            renderGallery();

            currentEditingId = null;
        }

        // 搜索供应商
        function searchSuppliers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;

            const supplierCards = document.querySelectorAll('.supplier-card');

            supplierCards.forEach(card => {
                const supplierId = parseInt(card.getAttribute('data-supplier-id'));
                const supplier = suppliers.find(s => s.id === supplierId);

                if (!supplier) {
                    card.style.display = 'none';
                    return;
                }

                let visible = true;

                // 文本搜索
                if (searchTerm) {
                    const searchText = `${supplier.name} ${supplier.address} ${supplier.description} ${supplier.contactPerson}`.toLowerCase();
                    if (!searchText.includes(searchTerm)) {
                        visible = false;
                    }
                }

                // 类型过滤
                if (typeFilter && supplier.type !== typeFilter) {
                    visible = false;
                }

                card.style.display = visible ? 'block' : 'none';
            });
        }

        // 过滤供应商
        function filterSuppliers() {
            searchSuppliers(); // 复用搜索逻辑
        }

        // 预览供应商
        function previewSupplier() {
            const data = collectFormData();

            if (!data.name.trim()) {
                alert('请先输入供应商名称');
                return;
            }

            const modal = new bootstrap.Modal(document.getElementById('previewModal'));
            const content = document.getElementById('previewContent');

            let previewHTML = `
                <div class="row">
                    <div class="col-md-8">
                        <h4>${data.name}</h4>
                        <div class="mb-3">
                            <span class="badge bg-${getTypeColor(data.type)} me-2">${data.type}</span>
                            <span class="badge bg-${data.status === 'active' ? 'success' : 'secondary'}">${getStatusText(data.status)}</span>
                        </div>

                        <div class="mb-3">
                            <strong>地址:</strong> ${data.address}
                        </div>

                        <div class="mb-3">
                            <strong>描述:</strong><br>
                            ${data.description}
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <h6>联系信息</h6>
                                <ul class="list-unstyled">
                                    <li><strong>联系人:</strong> ${data.contactPerson}</li>
                                    <li><strong>职位:</strong> ${data.contactPosition}</li>
                                    <li><strong>电话:</strong> ${data.contactPhone}</li>
                                    <li><strong>邮箱:</strong> ${data.contactEmail}</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>产品信息</h6>
                                <div class="mb-2">
                                    <strong>产品系列:</strong><br>
                                    ${data.series.map(series => `<span class="series-tag">${series}</span>`).join('')}
                                </div>
                                <div class="mb-2">
                                    <strong>产品型号:</strong><br>
                                    ${data.models.map(model => `<span class="model-tag">${model}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h6>公司图库</h6>
                        <div class="gallery-preview">
                            ${data.gallery.map(image => `
                                <div class="gallery-item">
                                    <img src="${image}" alt="公司图片" style="width: 100%; height: 100%; object-fit: cover;">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            content.innerHTML = previewHTML;
            modal.show();
        }

        // 生成Markdown
        function generateMarkdown() {
            const data = collectFormData();

            const markdown = `---
title: "${data.name}"
address: "${data.address}"
type: "${data.type}"
series:
${data.series.map(series => `  - "${series}"`).join('\n')}
models:
${data.models.map(model => `  - "${model}"`).join('\n')}
gallery:
${data.gallery.map(image => `  - "${image}"`).join('\n')}
contact_person: "${data.contactPerson}"
position: "${data.contactPosition}"
phone: "${data.contactPhone}"
email: "${data.contactEmail}"
description: "${data.description}"
---

${data.description}
`;

            // 创建下载链接
            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${data.name.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '-')}.md`;
            a.click();
            URL.revokeObjectURL(url);

            showNotification('Markdown文件生成成功！', 'success');
        }

        // 同步供应商数据
        function syncSuppliers() {
            if (suppliers.length === 0) {
                alert('没有供应商数据可同步');
                return;
            }

            showNotification('正在同步供应商数据...', 'info');

            // 模拟同步过程
            setTimeout(() => {
                showNotification('供应商数据同步成功！', 'success');
            }, 2000);
        }

        // 导出供应商数据
        function exportSuppliers() {
            if (suppliers.length === 0) {
                alert('没有供应商数据可导出');
                return;
            }

            const exportData = {
                suppliers: suppliers,
                exportTime: new Date().toISOString(),
                totalCount: suppliers.length
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `suppliers-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showNotification('供应商数据导出成功！', 'success');
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 1060; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(alertDiv);

            // 3秒后自动移除
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>
