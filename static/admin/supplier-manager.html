<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¾›åº”å•†ç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .supplier-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        .supplier-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .supplier-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }
        .supplier-info {
            flex: 1;
        }
        .supplier-actions {
            display: flex;
            gap: 8px;
        }
        .supplier-logo {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
            border: 2px solid #e9ecef;
        }
        .supplier-stats {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .form-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .section-title {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        .series-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin: 2px;
            display: inline-block;
        }
        .model-tag {
            background: #f3e5f5;
            color: #7b1fa2;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 11px;
            margin: 2px;
            display: inline-block;
        }
        .contact-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        .gallery-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .gallery-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 1;
        }
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .gallery-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(220, 53, 69, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tag-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            padding: 8px;
            min-height: 38px;
            align-items: center;
        }
        .tag-item {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .tag-item .remove {
            cursor: pointer;
            font-weight: bold;
        }
        .tag-input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 100px;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1><i class="fas fa-truck me-2"></i>ä¾›åº”å•†ç®¡ç†ç³»ç»Ÿ</h1>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="showAddSupplierForm()">
                            <i class="fas fa-plus me-1"></i>æ·»åŠ ä¾›åº”å•†
                        </button>
                        <button class="btn btn-primary" onclick="syncSuppliers()">
                            <i class="fas fa-sync me-1"></i>åŒæ­¥æ•°æ®
                        </button>
                        <button class="btn btn-info" onclick="exportSuppliers()">
                            <i class="fas fa-download me-1"></i>å¯¼å‡ºæ•°æ®
                        </button>
                    </div>
                </div>

                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="supplier-stats">
                    <div class="row text-center">
                        <div class="col-3">
                            <div class="h4 mb-1" id="totalSuppliers">0</div>
                            <div class="small">æ€»ä¾›åº”å•†æ•°</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="manufacturerCount">0</div>
                            <div class="small">åˆ¶é€ å•†</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="traderCount">0</div>
                            <div class="small">è´¸æ˜“å•†</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="totalProducts">0</div>
                            <div class="small">å…³è”äº§å“</div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- ä¾›åº”å•†è¡¨å• -->
                    <div class="col-md-5">
                        <div class="form-section" id="supplierForm">
                            <h3 class="section-title">ä¾›åº”å•†ä¿¡æ¯</h3>
                            
                            <div class="mb-3">
                                <label class="form-label">ä¾›åº”å•†åç§° *</label>
                                <input type="text" class="form-control" id="supplierName" placeholder="è¾“å…¥ä¾›åº”å•†å®Œæ•´åç§°">
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">ä¾›åº”å•†ç±»å‹</label>
                                        <select class="form-select" id="supplierType">
                                            <option value="åˆ¶é€ å•†">åˆ¶é€ å•†</option>
                                            <option value="è´¸æ˜“å•†">è´¸æ˜“å•†</option>
                                            <option value="ä»£ç†å•†">ä»£ç†å•†</option>
                                            <option value="ç»é”€å•†">ç»é”€å•†</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">çŠ¶æ€</label>
                                        <select class="form-select" id="supplierStatus">
                                            <option value="active">æ´»è·ƒ</option>
                                            <option value="inactive">åœç”¨</option>
                                            <option value="pending">å¾…å®¡æ ¸</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">å…¬å¸åœ°å€</label>
                                <input type="text" class="form-control" id="supplierAddress" placeholder="è¾“å…¥è¯¦ç»†åœ°å€">
                            </div>

                            <div class="mb-3">
                                <label class="form-label">å…¬å¸æè¿°</label>
                                <textarea class="form-control" id="supplierDescription" rows="4" placeholder="æè¿°å…¬å¸ä¸šåŠ¡èŒƒå›´ã€ä¼˜åŠ¿ç­‰"></textarea>
                            </div>

                            <!-- äº§å“ç³»åˆ— -->
                            <div class="mb-3">
                                <label class="form-label">äº§å“ç³»åˆ—</label>
                                <div class="tag-input-container" id="seriesContainer">
                                    <input type="text" class="tag-input" id="seriesInput" placeholder="è¾“å…¥ç³»åˆ—åç§°ï¼ŒæŒ‰å›è½¦æ·»åŠ " onkeypress="addSeries(event)">
                                </div>
                                <small class="text-muted">è¾“å…¥ç³»åˆ—åç§°åæŒ‰å›è½¦é”®æ·»åŠ </small>
                            </div>

                            <!-- äº§å“å‹å· -->
                            <div class="mb-3">
                                <label class="form-label">äº§å“å‹å·</label>
                                <div class="tag-input-container" id="modelsContainer">
                                    <input type="text" class="tag-input" id="modelsInput" placeholder="è¾“å…¥å‹å·ï¼ŒæŒ‰å›è½¦æ·»åŠ " onkeypress="addModel(event)">
                                </div>
                                <small class="text-muted">è¾“å…¥äº§å“å‹å·åæŒ‰å›è½¦é”®æ·»åŠ </small>
                            </div>

                            <!-- è”ç³»ä¿¡æ¯ -->
                            <h6 class="text-muted mt-4 mb-3">è”ç³»ä¿¡æ¯</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">è”ç³»äºº</label>
                                        <input type="text" class="form-control" id="contactPerson" placeholder="è”ç³»äººå§“å">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">èŒä½</label>
                                        <input type="text" class="form-control" id="contactPosition" placeholder="è”ç³»äººèŒä½">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">è”ç³»ç”µè¯</label>
                                        <input type="tel" class="form-control" id="contactPhone" placeholder="è”ç³»ç”µè¯">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">é‚®ç®±</label>
                                        <input type="email" class="form-control" id="contactEmail" placeholder="è”ç³»é‚®ç®±">
                                    </div>
                                </div>
                            </div>

                            <!-- å…¬å¸å›¾åº“ -->
                            <div class="mb-3">
                                <label class="form-label">å…¬å¸å›¾åº“</label>
                                <div class="d-flex gap-2 mb-2">
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addGalleryImage()">
                                        <i class="fas fa-plus me-1"></i>æ·»åŠ å›¾ç‰‡
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearGallery()">
                                        <i class="fas fa-trash me-1"></i>æ¸…ç©ºå›¾åº“
                                    </button>
                                </div>
                                <div class="gallery-preview" id="galleryPreview">
                                    <!-- å›¾ç‰‡é¢„è§ˆå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                                </div>
                            </div>

                            <div class="d-flex gap-2">
                                <button class="btn btn-primary" onclick="saveSupplier()">
                                    <i class="fas fa-save me-1"></i>ä¿å­˜ä¾›åº”å•†
                                </button>
                                <button class="btn btn-secondary" onclick="clearForm()">
                                    <i class="fas fa-times me-1"></i>æ¸…ç©ºè¡¨å•
                                </button>
                                <button class="btn btn-info" onclick="previewSupplier()">
                                    <i class="fas fa-eye me-1"></i>é¢„è§ˆ
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ä¾›åº”å•†åˆ—è¡¨ -->
                    <div class="col-md-7">
                        <div class="form-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h3 class="section-title mb-0">ä¾›åº”å•†åˆ—è¡¨</h3>
                                <div class="d-flex gap-2">
                                    <input type="text" class="form-control form-control-sm" placeholder="æœç´¢ä¾›åº”å•†..." id="searchInput" onkeyup="searchSuppliers()">
                                    <select class="form-select form-select-sm" id="typeFilter" onchange="filterSuppliers()">
                                        <option value="">æ‰€æœ‰ç±»å‹</option>
                                        <option value="åˆ¶é€ å•†">åˆ¶é€ å•†</option>
                                        <option value="è´¸æ˜“å•†">è´¸æ˜“å•†</option>
                                        <option value="ä»£ç†å•†">ä»£ç†å•†</option>
                                        <option value="ç»é”€å•†">ç»é”€å•†</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div id="supplierList">
                                <!-- ä¾›åº”å•†å¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¢„è§ˆæ¨¡æ€æ¡† -->
    <div class="modal fade" id="previewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ä¾›åº”å•†é¢„è§ˆ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="previewContent">
                    <!-- é¢„è§ˆå†…å®¹ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                    <button type="button" class="btn btn-primary" onclick="generateMarkdown()">ç”ŸæˆMarkdown</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let suppliers = [];
        let currentEditingId = null;
        let seriesList = [];
        let modelsList = [];
        let galleryImages = [];

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeSupplierManager();
            loadSuppliers();
        });

        // åˆå§‹åŒ–ä¾›åº”å•†ç®¡ç†å™¨
        function initializeSupplierManager() {
            console.log('ğŸš€ ä¾›åº”å•†ç®¡ç†ç³»ç»Ÿåˆå§‹åŒ–');
            updateStats();
        }

        // åŠ è½½ä¾›åº”å•†æ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰
        function loadSuppliers() {
            // æ¨¡æ‹Ÿä¾›åº”å•†æ•°æ®
            suppliers = [
                {
                    id: 1,
                    name: 'æ·±åœ³å¸‚å¾®è§†å…‰ç”µç§‘æŠ€æœ‰é™å…¬å¸',
                    type: 'åˆ¶é€ å•†',
                    address: 'å¹¿ä¸œçœæ·±åœ³å¸‚å—å±±åŒºç§‘æŠ€å›­',
                    description: 'æ·±åœ³å¸‚å¾®è§†å…‰ç”µç§‘æŠ€æœ‰é™å…¬å¸ä½äºæ·±åœ³åªå±±é¦–åº§å¤§å¦ï¼Œæ˜¯ä¸€å®¶é›†ç ”å‘ã€ç”Ÿäº§ã€é”€å”®ã€é¡¹ç›®å’ŒæœåŠ¡äºä¸€ä½“çš„å›½å®¶é«˜æ–°æŠ€æœ¯ä¼ä¸šã€‚',
                    series: ['DZç³»åˆ—', 'Sç³»åˆ—', 'Fç³»åˆ—', 'Pç³»åˆ—', 'Kç³»åˆ—', 'LAç³»åˆ—'],
                    models: ['0.85mm', '0.95mm', '1mm', '1.2mm', '1.8mm', '2mm', '2.2mm', '2.4mm', '2.8mm', '3.9mm', '6mm'],
                    contactPerson: 'ç‹è½©',
                    contactPosition: 'åŒºåŸŸç»ç†',
                    contactPhone: '15222189183',
                    contactEmail: 'wangxuan@sz-wise.cn',
                    gallery: ['/images/supplier/vsndt-1.png', '/images/supplier/vsndt-2.png', '/images/supplier/vsndt-3.png'],
                    status: 'active',
                    productCount: 25
                },
                {
                    id: 2,
                    name: 'å¤©æ´¥ç»´æ£®ç§‘æŠ€æœ‰é™å…¬å¸',
                    type: 'è´¸æ˜“å•†',
                    address: 'å¤©æ´¥å¸‚æ²³è¥¿åŒº',
                    description: 'å¤©æ´¥ç»´æ£®ç§‘æŠ€æœ‰é™å…¬å¸æ˜¯ä¸€å®¶ä¸“æ³¨ä»ªå™¨ä»ªè¡¨ã€æ£€æµ‹é‡å…·ã€åˆ€å…·çš„æœºç”µè®¾å¤‡æœåŠ¡å•†ã€‚',
                    series: ['VIS-Pç³»åˆ—', 'VIS-Tç³»åˆ—'],
                    models: ['0.95mm', '1.8mm', '2.8mm', '3.9mm', '6mm'],
                    contactPerson: 'å¼ ç»ç†',
                    contactPosition: 'å¸‚åœºç»ç†',
                    contactPhone: '13000000000',
                    contactEmail: '738373748@qq.com',
                    gallery: ['https://picsum.photos/300/200', 'https://picsum.photos/300/200', 'https://picsum.photos/300/200'],
                    status: 'active',
                    productCount: 12
                }
            ];

            renderSupplierList();
            updateStats();
        }

        // æ¸²æŸ“ä¾›åº”å•†åˆ—è¡¨
        function renderSupplierList() {
            const listContainer = document.getElementById('supplierList');

            if (suppliers.length === 0) {
                listContainer.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-truck fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">æš‚æ— ä¾›åº”å•†</h5>
                        <p class="text-muted">ç‚¹å‡»"æ·»åŠ ä¾›åº”å•†"åˆ›å»ºç¬¬ä¸€ä¸ªä¾›åº”å•†</p>
                    </div>
                `;
                return;
            }

            listContainer.innerHTML = suppliers.map(supplier => `
                <div class="supplier-card" data-supplier-id="${supplier.id}">
                    <div class="supplier-header">
                        <div class="supplier-info">
                            <div class="d-flex align-items-center mb-2">
                                <h5 class="mb-0 me-2">${supplier.name}</h5>
                                <span class="badge bg-${getTypeColor(supplier.type)}">${supplier.type}</span>
                                <span class="badge bg-${supplier.status === 'active' ? 'success' : 'secondary'} ms-1">
                                    ${getStatusText(supplier.status)}
                                </span>
                            </div>
                            <div class="text-muted small mb-2">
                                <i class="fas fa-map-marker-alt me-1"></i>${supplier.address}
                            </div>
                            <div class="text-muted small">${supplier.description}</div>
                        </div>
                        <div class="supplier-actions">
                            <button class="btn btn-sm btn-outline-primary" onclick="editSupplier(${supplier.id})" title="ç¼–è¾‘">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-info" onclick="viewSupplierProducts(${supplier.id})" title="æŸ¥çœ‹äº§å“">
                                <i class="fas fa-box"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteSupplier(${supplier.id})" title="åˆ é™¤">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="contact-info">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <strong>è”ç³»äºº:</strong> ${supplier.contactPerson} (${supplier.contactPosition})
                                </div>
                                <div class="mb-2">
                                    <strong>ç”µè¯:</strong> ${supplier.contactPhone}
                                </div>
                                <div class="mb-2">
                                    <strong>é‚®ç®±:</strong> ${supplier.contactEmail}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <strong>äº§å“ç³»åˆ—:</strong><br>
                                    ${supplier.series.map(series => `<span class="series-tag">${series}</span>`).join('')}
                                </div>
                                <div class="mb-2">
                                    <strong>äº§å“å‹å·:</strong><br>
                                    ${supplier.models.slice(0, 8).map(model => `<span class="model-tag">${model}</span>`).join('')}
                                    ${supplier.models.length > 8 ? `<span class="model-tag">+${supplier.models.length - 8}æ›´å¤š</span>` : ''}
                                </div>
                                <div class="mb-2">
                                    <strong>å…³è”äº§å“:</strong> <span class="badge bg-primary">${supplier.productCount}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // è·å–ç±»å‹é¢œè‰²
        function getTypeColor(type) {
            const colors = {
                'åˆ¶é€ å•†': 'primary',
                'è´¸æ˜“å•†': 'info',
                'ä»£ç†å•†': 'warning',
                'ç»é”€å•†': 'secondary'
            };
            return colors[type] || 'secondary';
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            const texts = {
                'active': 'æ´»è·ƒ',
                'inactive': 'åœç”¨',
                'pending': 'å¾…å®¡æ ¸'
            };
            return texts[status] || status;
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const totalSuppliers = suppliers.length;
            const manufacturerCount = suppliers.filter(s => s.type === 'åˆ¶é€ å•†').length;
            const traderCount = suppliers.filter(s => s.type === 'è´¸æ˜“å•†').length;
            const totalProducts = suppliers.reduce((sum, s) => sum + (s.productCount || 0), 0);

            document.getElementById('totalSuppliers').textContent = totalSuppliers;
            document.getElementById('manufacturerCount').textContent = manufacturerCount;
            document.getElementById('traderCount').textContent = traderCount;
            document.getElementById('totalProducts').textContent = totalProducts;
        }

        // æ·»åŠ ç³»åˆ—
        function addSeries(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = event.target;
                const value = input.value.trim();

                if (value && !seriesList.includes(value)) {
                    seriesList.push(value);
                    renderSeriesTags();
                    input.value = '';
                }
            }
        }

        // æ¸²æŸ“ç³»åˆ—æ ‡ç­¾
        function renderSeriesTags() {
            const container = document.getElementById('seriesContainer');
            const input = container.querySelector('.tag-input');

            // æ¸…é™¤ç°æœ‰æ ‡ç­¾
            container.querySelectorAll('.tag-item').forEach(tag => tag.remove());

            // æ·»åŠ æ–°æ ‡ç­¾
            seriesList.forEach((series, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag-item';
                tagElement.innerHTML = `
                    ${series}
                    <span class="remove" onclick="removeSeries(${index})">&times;</span>
                `;
                container.insertBefore(tagElement, input);
            });
        }

        // åˆ é™¤ç³»åˆ—
        function removeSeries(index) {
            seriesList.splice(index, 1);
            renderSeriesTags();
        }

        // æ·»åŠ å‹å·
        function addModel(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = event.target;
                const value = input.value.trim();

                if (value && !modelsList.includes(value)) {
                    modelsList.push(value);
                    renderModelTags();
                    input.value = '';
                }
            }
        }

        // æ¸²æŸ“å‹å·æ ‡ç­¾
        function renderModelTags() {
            const container = document.getElementById('modelsContainer');
            const input = container.querySelector('.tag-input');

            // æ¸…é™¤ç°æœ‰æ ‡ç­¾
            container.querySelectorAll('.tag-item').forEach(tag => tag.remove());

            // æ·»åŠ æ–°æ ‡ç­¾
            modelsList.forEach((model, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag-item';
                tagElement.innerHTML = `
                    ${model}
                    <span class="remove" onclick="removeModel(${index})">&times;</span>
                `;
                container.insertBefore(tagElement, input);
            });
        }

        // åˆ é™¤å‹å·
        function removeModel(index) {
            modelsList.splice(index, 1);
            renderModelTags();
        }

        // æ·»åŠ å›¾åº“å›¾ç‰‡
        function addGalleryImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.multiple = true;
            input.onchange = function(e) {
                Array.from(e.target.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        galleryImages.push(e.target.result);
                        renderGallery();
                    };
                    reader.readAsDataURL(file);
                });
            };
            input.click();
        }

        // æ¸²æŸ“å›¾åº“
        function renderGallery() {
            const container = document.getElementById('galleryPreview');

            if (galleryImages.length === 0) {
                container.innerHTML = '<div class="text-muted text-center py-3">æš‚æ— å›¾ç‰‡</div>';
                return;
            }

            container.innerHTML = galleryImages.map((image, index) => `
                <div class="gallery-item">
                    <img src="${image}" alt="ä¾›åº”å•†å›¾ç‰‡ ${index + 1}">
                    <button class="remove-btn" onclick="removeGalleryImage(${index})" title="åˆ é™¤">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        // åˆ é™¤å›¾åº“å›¾ç‰‡
        function removeGalleryImage(index) {
            galleryImages.splice(index, 1);
            renderGallery();
        }

        // æ¸…ç©ºå›¾åº“
        function clearGallery() {
            galleryImages = [];
            renderGallery();
        }

        // æ˜¾ç¤ºæ·»åŠ ä¾›åº”å•†è¡¨å•
        function showAddSupplierForm() {
            clearForm();
            currentEditingId = null;
            document.querySelector('.section-title').textContent = 'æ·»åŠ ä¾›åº”å•†';
        }

        // ç¼–è¾‘ä¾›åº”å•†
        function editSupplier(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;

            currentEditingId = supplierId;

            // å¡«å……è¡¨å•
            document.getElementById('supplierName').value = supplier.name;
            document.getElementById('supplierType').value = supplier.type;
            document.getElementById('supplierAddress').value = supplier.address;
            document.getElementById('supplierDescription').value = supplier.description;
            document.getElementById('contactPerson').value = supplier.contactPerson;
            document.getElementById('contactPosition').value = supplier.contactPosition;
            document.getElementById('contactPhone').value = supplier.contactPhone;
            document.getElementById('contactEmail').value = supplier.contactEmail;
            document.getElementById('supplierStatus').value = supplier.status;

            // å¡«å……ç³»åˆ—å’Œå‹å·
            seriesList = [...supplier.series];
            modelsList = [...supplier.models];
            galleryImages = [...supplier.gallery];

            renderSeriesTags();
            renderModelTags();
            renderGallery();

            document.querySelector('.section-title').textContent = 'ç¼–è¾‘ä¾›åº”å•†';
        }

        // ä¿å­˜ä¾›åº”å•†
        function saveSupplier() {
            const supplierData = collectFormData();

            if (!validateSupplierData(supplierData)) {
                return;
            }

            if (currentEditingId) {
                // æ›´æ–°ç°æœ‰ä¾›åº”å•†
                const index = suppliers.findIndex(s => s.id === currentEditingId);
                if (index !== -1) {
                    suppliers[index] = { ...suppliers[index], ...supplierData, id: currentEditingId };
                }
            } else {
                // æ·»åŠ æ–°ä¾›åº”å•†
                const newId = Math.max(...suppliers.map(s => s.id), 0) + 1;
                suppliers.push({ ...supplierData, id: newId, productCount: 0 });
            }

            renderSupplierList();
            updateStats();
            clearForm();

            showNotification(currentEditingId ? 'ä¾›åº”å•†æ›´æ–°æˆåŠŸï¼' : 'ä¾›åº”å•†æ·»åŠ æˆåŠŸï¼', 'success');
            currentEditingId = null;
        }

        // æ”¶é›†è¡¨å•æ•°æ®
        function collectFormData() {
            return {
                name: document.getElementById('supplierName').value,
                type: document.getElementById('supplierType').value,
                address: document.getElementById('supplierAddress').value,
                description: document.getElementById('supplierDescription').value,
                contactPerson: document.getElementById('contactPerson').value,
                contactPosition: document.getElementById('contactPosition').value,
                contactPhone: document.getElementById('contactPhone').value,
                contactEmail: document.getElementById('contactEmail').value,
                status: document.getElementById('supplierStatus').value,
                series: [...seriesList],
                models: [...modelsList],
                gallery: [...galleryImages]
            };
        }

        // éªŒè¯ä¾›åº”å•†æ•°æ®
        function validateSupplierData(data) {
            const errors = [];

            if (!data.name.trim()) {
                errors.push('ä¾›åº”å•†åç§°ä¸èƒ½ä¸ºç©º');
            }

            if (!data.contactPerson.trim()) {
                errors.push('è”ç³»äººä¸èƒ½ä¸ºç©º');
            }

            if (data.contactPhone && !/^1[3-9]\d{9}$/.test(data.contactPhone)) {
                errors.push('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ');
            }

            if (data.contactEmail && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.contactEmail)) {
                errors.push('è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€');
            }

            // æ£€æŸ¥åç§°é‡å¤
            const existingSupplier = suppliers.find(s =>
                s.name === data.name && s.id !== currentEditingId
            );
            if (existingSupplier) {
                errors.push('ä¾›åº”å•†åç§°å·²å­˜åœ¨');
            }

            if (errors.length > 0) {
                alert('è¯·ä¿®æ­£ä»¥ä¸‹é”™è¯¯ï¼š\n\n' + errors.join('\n'));
                return false;
            }

            return true;
        }

        // åˆ é™¤ä¾›åº”å•†
        function deleteSupplier(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;

            // æ£€æŸ¥æ˜¯å¦æœ‰å…³è”äº§å“
            if (supplier.productCount > 0) {
                if (!confirm(`è¯¥ä¾›åº”å•†ä¸‹æœ‰ ${supplier.productCount} ä¸ªäº§å“ï¼Œåˆ é™¤åè¿™äº›äº§å“å°†å¤±å»ä¾›åº”å•†å…³è”ã€‚ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ`)) {
                    return;
                }
            }

            if (confirm(`ç¡®å®šè¦åˆ é™¤ä¾›åº”å•†"${supplier.name}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                suppliers = suppliers.filter(s => s.id !== supplierId);
                renderSupplierList();
                updateStats();
                showNotification('ä¾›åº”å•†åˆ é™¤æˆåŠŸï¼', 'success');
            }
        }

        // æŸ¥çœ‹ä¾›åº”å•†äº§å“
        function viewSupplierProducts(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;

            showNotification(`æŸ¥çœ‹ä¾›åº”å•†"${supplier.name}"çš„äº§å“åŠŸèƒ½å¼€å‘ä¸­...`, 'info');
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('supplierName').value = '';
            document.getElementById('supplierType').value = 'åˆ¶é€ å•†';
            document.getElementById('supplierAddress').value = '';
            document.getElementById('supplierDescription').value = '';
            document.getElementById('contactPerson').value = '';
            document.getElementById('contactPosition').value = '';
            document.getElementById('contactPhone').value = '';
            document.getElementById('contactEmail').value = '';
            document.getElementById('supplierStatus').value = 'active';

            seriesList = [];
            modelsList = [];
            galleryImages = [];

            renderSeriesTags();
            renderModelTags();
            renderGallery();

            currentEditingId = null;
        }

        // æœç´¢ä¾›åº”å•†
        function searchSuppliers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;

            const supplierCards = document.querySelectorAll('.supplier-card');

            supplierCards.forEach(card => {
                const supplierId = parseInt(card.getAttribute('data-supplier-id'));
                const supplier = suppliers.find(s => s.id === supplierId);

                if (!supplier) {
                    card.style.display = 'none';
                    return;
                }

                let visible = true;

                // æ–‡æœ¬æœç´¢
                if (searchTerm) {
                    const searchText = `${supplier.name} ${supplier.address} ${supplier.description} ${supplier.contactPerson}`.toLowerCase();
                    if (!searchText.includes(searchTerm)) {
                        visible = false;
                    }
                }

                // ç±»å‹è¿‡æ»¤
                if (typeFilter && supplier.type !== typeFilter) {
                    visible = false;
                }

                card.style.display = visible ? 'block' : 'none';
            });
        }

        // è¿‡æ»¤ä¾›åº”å•†
        function filterSuppliers() {
            searchSuppliers(); // å¤ç”¨æœç´¢é€»è¾‘
        }

        // é¢„è§ˆä¾›åº”å•†
        function previewSupplier() {
            const data = collectFormData();

            if (!data.name.trim()) {
                alert('è¯·å…ˆè¾“å…¥ä¾›åº”å•†åç§°');
                return;
            }

            const modal = new bootstrap.Modal(document.getElementById('previewModal'));
            const content = document.getElementById('previewContent');

            let previewHTML = `
                <div class="row">
                    <div class="col-md-8">
                        <h4>${data.name}</h4>
                        <div class="mb-3">
                            <span class="badge bg-${getTypeColor(data.type)} me-2">${data.type}</span>
                            <span class="badge bg-${data.status === 'active' ? 'success' : 'secondary'}">${getStatusText(data.status)}</span>
                        </div>

                        <div class="mb-3">
                            <strong>åœ°å€:</strong> ${data.address}
                        </div>

                        <div class="mb-3">
                            <strong>æè¿°:</strong><br>
                            ${data.description}
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <h6>è”ç³»ä¿¡æ¯</h6>
                                <ul class="list-unstyled">
                                    <li><strong>è”ç³»äºº:</strong> ${data.contactPerson}</li>
                                    <li><strong>èŒä½:</strong> ${data.contactPosition}</li>
                                    <li><strong>ç”µè¯:</strong> ${data.contactPhone}</li>
                                    <li><strong>é‚®ç®±:</strong> ${data.contactEmail}</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>äº§å“ä¿¡æ¯</h6>
                                <div class="mb-2">
                                    <strong>äº§å“ç³»åˆ—:</strong><br>
                                    ${data.series.map(series => `<span class="series-tag">${series}</span>`).join('')}
                                </div>
                                <div class="mb-2">
                                    <strong>äº§å“å‹å·:</strong><br>
                                    ${data.models.map(model => `<span class="model-tag">${model}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h6>å…¬å¸å›¾åº“</h6>
                        <div class="gallery-preview">
                            ${data.gallery.map(image => `
                                <div class="gallery-item">
                                    <img src="${image}" alt="å…¬å¸å›¾ç‰‡" style="width: 100%; height: 100%; object-fit: cover;">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            content.innerHTML = previewHTML;
            modal.show();
        }

        // ç”ŸæˆMarkdown
        function generateMarkdown() {
            const data = collectFormData();

            const markdown = `---
title: "${data.name}"
address: "${data.address}"
type: "${data.type}"
series:
${data.series.map(series => `  - "${series}"`).join('\n')}
models:
${data.models.map(model => `  - "${model}"`).join('\n')}
gallery:
${data.gallery.map(image => `  - "${image}"`).join('\n')}
contact_person: "${data.contactPerson}"
position: "${data.contactPosition}"
phone: "${data.contactPhone}"
email: "${data.contactEmail}"
description: "${data.description}"
---

${data.description}
`;

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${data.name.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '-')}.md`;
            a.click();
            URL.revokeObjectURL(url);

            showNotification('Markdownæ–‡ä»¶ç”ŸæˆæˆåŠŸï¼', 'success');
        }

        // åŒæ­¥ä¾›åº”å•†æ•°æ®
        function syncSuppliers() {
            if (suppliers.length === 0) {
                alert('æ²¡æœ‰ä¾›åº”å•†æ•°æ®å¯åŒæ­¥');
                return;
            }

            showNotification('æ­£åœ¨åŒæ­¥ä¾›åº”å•†æ•°æ®...', 'info');

            // æ¨¡æ‹ŸåŒæ­¥è¿‡ç¨‹
            setTimeout(() => {
                showNotification('ä¾›åº”å•†æ•°æ®åŒæ­¥æˆåŠŸï¼', 'success');
            }, 2000);
        }

        // å¯¼å‡ºä¾›åº”å•†æ•°æ®
        function exportSuppliers() {
            if (suppliers.length === 0) {
                alert('æ²¡æœ‰ä¾›åº”å•†æ•°æ®å¯å¯¼å‡º');
                return;
            }

            const exportData = {
                suppliers: suppliers,
                exportTime: new Date().toISOString(),
                totalCount: suppliers.length
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `suppliers-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showNotification('ä¾›åº”å•†æ•°æ®å¯¼å‡ºæˆåŠŸï¼', 'success');
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 1060; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(alertDiv);

            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>
