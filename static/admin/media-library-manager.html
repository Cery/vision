<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åª’ä½“åº“ç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .media-sidebar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .media-sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 12px 20px;
            margin: 2px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .media-sidebar .nav-link:hover, .media-sidebar .nav-link.active {
            color: white;
            background: rgba(255,255,255,0.1);
        }
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }
        .media-item {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .media-item.selected {
            border: 3px solid #007bff;
            transform: scale(1.02);
        }
        .media-preview {
            width: 100%;
            height: 150px;
            object-fit: cover;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .media-info {
            padding: 15px;
        }
        .media-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
            color: #2c3e50;
        }
        .media-meta {
            font-size: 12px;
            color: #6c757d;
        }
        .media-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .media-item:hover .media-actions {
            opacity: 1;
        }
        .upload-zone {
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .upload-zone:hover, .upload-zone.dragover {
            border-color: #007bff;
            background: #e3f2fd;
        }
        .folder-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .folder-item:hover {
            background: #fff8e1;
            transform: translateX(5px);
        }
        .breadcrumb-custom {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .media-toolbar {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .media-stats {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .file-type-icon {
            font-size: 48px;
            color: #6c757d;
        }
        .file-type-image { color: #28a745; }
        .file-type-video { color: #dc3545; }
        .file-type-document { color: #007bff; }
        .file-type-audio { color: #ffc107; }
        .progress-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            z-index: 1050;
        }
        .upload-progress {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- ä¾§è¾¹æ  -->
            <div class="col-md-3 col-lg-2 media-sidebar p-0">
                <div class="p-4">
                    <h4 class="text-white mb-4">
                        <i class="fas fa-images me-2"></i>
                        åª’ä½“åº“
                    </h4>
                    
                    <!-- æ–‡ä»¶å¤¹å¯¼èˆª -->
                    <nav class="nav flex-column mb-4">
                        <div class="text-white-50 small mb-2">æ–‡ä»¶å¤¹</div>
                        <a class="nav-link active" href="#" onclick="navigateToFolder('all')">
                            <i class="fas fa-folder-open me-2"></i>æ‰€æœ‰æ–‡ä»¶
                        </a>
                        <a class="nav-link" href="#" onclick="navigateToFolder('products')">
                            <i class="fas fa-folder me-2"></i>äº§å“å›¾ç‰‡
                        </a>
                        <a class="nav-link" href="#" onclick="navigateToFolder('news')">
                            <i class="fas fa-folder me-2"></i>èµ„è®¯å›¾ç‰‡
                        </a>
                        <a class="nav-link" href="#" onclick="navigateToFolder('cases')">
                            <i class="fas fa-folder me-2"></i>æ¡ˆä¾‹å›¾ç‰‡
                        </a>
                        <a class="nav-link" href="#" onclick="navigateToFolder('documents')">
                            <i class="fas fa-folder me-2"></i>æ–‡æ¡£èµ„æ–™
                        </a>
                        <a class="nav-link" href="#" onclick="navigateToFolder('videos')">
                            <i class="fas fa-folder me-2"></i>è§†é¢‘æ–‡ä»¶
                        </a>
                    </nav>

                    <!-- æ–‡ä»¶ç±»å‹è¿‡æ»¤ -->
                    <nav class="nav flex-column mb-4">
                        <div class="text-white-50 small mb-2">æ–‡ä»¶ç±»å‹</div>
                        <a class="nav-link" href="#" onclick="filterByType('all')">
                            <i class="fas fa-file me-2"></i>æ‰€æœ‰ç±»å‹
                        </a>
                        <a class="nav-link" href="#" onclick="filterByType('image')">
                            <i class="fas fa-image me-2"></i>å›¾ç‰‡
                        </a>
                        <a class="nav-link" href="#" onclick="filterByType('video')">
                            <i class="fas fa-video me-2"></i>è§†é¢‘
                        </a>
                        <a class="nav-link" href="#" onclick="filterByType('document')">
                            <i class="fas fa-file-alt me-2"></i>æ–‡æ¡£
                        </a>
                        <a class="nav-link" href="#" onclick="filterByType('audio')">
                            <i class="fas fa-music me-2"></i>éŸ³é¢‘
                        </a>
                    </nav>

                    <!-- å¿«é€Ÿæ“ä½œ -->
                    <div class="mt-auto">
                        <button class="btn btn-light btn-sm w-100 mb-2" onclick="createFolder()">
                            <i class="fas fa-folder-plus me-1"></i>æ–°å»ºæ–‡ä»¶å¤¹
                        </button>
                        <button class="btn btn-primary btn-sm w-100" onclick="uploadFiles()">
                            <i class="fas fa-upload me-1"></i>ä¸Šä¼ æ–‡ä»¶
                        </button>
                    </div>
                </div>
            </div>

            <!-- ä¸»å†…å®¹åŒº -->
            <div class="col-md-9 col-lg-10 p-4">
                <!-- é¢åŒ…å±‘å¯¼èˆª -->
                <div class="breadcrumb-custom">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-0" id="breadcrumbNav">
                            <li class="breadcrumb-item"><a href="#" onclick="navigateToFolder('all')">åª’ä½“åº“</a></li>
                            <li class="breadcrumb-item active" aria-current="page">æ‰€æœ‰æ–‡ä»¶</li>
                        </ol>
                    </nav>
                </div>

                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="media-stats">
                    <div class="row text-center">
                        <div class="col-3">
                            <div class="h4 mb-1" id="totalFiles">0</div>
                            <div class="small">æ€»æ–‡ä»¶æ•°</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="totalSize">0 MB</div>
                            <div class="small">æ€»å¤§å°</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="selectedCount">0</div>
                            <div class="small">å·²é€‰æ‹©</div>
                        </div>
                        <div class="col-3">
                            <div class="h4 mb-1" id="folderCount">6</div>
                            <div class="small">æ–‡ä»¶å¤¹æ•°</div>
                        </div>
                    </div>
                </div>

                <!-- å·¥å…·æ  -->
                <div class="media-toolbar">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" class="form-control" id="searchInput" placeholder="æœç´¢æ–‡ä»¶å..." onkeyup="searchFiles()">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex justify-content-end gap-2">
                                <div class="btn-group">
                                    <button class="btn btn-outline-secondary btn-sm active" onclick="setViewMode('grid')" title="ç½‘æ ¼è§†å›¾">
                                        <i class="fas fa-th"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="setViewMode('list')" title="åˆ—è¡¨è§†å›¾">
                                        <i class="fas fa-list"></i>
                                    </button>
                                </div>
                                <select class="form-select form-select-sm" style="width: auto;" onchange="sortFiles(this.value)">
                                    <option value="name">æŒ‰åç§°æ’åº</option>
                                    <option value="date">æŒ‰æ—¥æœŸæ’åº</option>
                                    <option value="size">æŒ‰å¤§å°æ’åº</option>
                                    <option value="type">æŒ‰ç±»å‹æ’åº</option>
                                </select>
                                <button class="btn btn-danger btn-sm" onclick="deleteSelected()" id="deleteBtn" disabled>
                                    <i class="fas fa-trash me-1"></i>åˆ é™¤é€‰ä¸­
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¸Šä¼ åŒºåŸŸ -->
                <div class="upload-zone mb-4" id="uploadZone" onclick="uploadFiles()">
                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </h5>
                    <p class="text-muted mb-0">æ”¯æŒå›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡£ç­‰å¤šç§æ ¼å¼</p>
                </div>

                <!-- åª’ä½“ç½‘æ ¼ -->
                <div class="media-grid" id="mediaGrid">
                    <!-- åª’ä½“é¡¹ç›®å°†åŠ¨æ€åŠ è½½ -->
                </div>

                <!-- åˆ—è¡¨è§†å›¾ -->
                <div class="table-responsive" id="mediaList" style="display: none;">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th width="40">
                                    <input type="checkbox" class="form-check-input" onchange="selectAll(this.checked)">
                                </th>
                                <th>æ–‡ä»¶å</th>
                                <th>ç±»å‹</th>
                                <th>å¤§å°</th>
                                <th>ä¿®æ”¹æ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="mediaListBody">
                            <!-- åˆ—è¡¨é¡¹ç›®å°†åŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸Šä¼ è¿›åº¦ -->
    <div class="progress-container" id="progressContainer">
        <!-- ä¸Šä¼ è¿›åº¦é¡¹ç›®å°†åŠ¨æ€æ·»åŠ  -->
    </div>

    <!-- æ–‡ä»¶è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal fade" id="fileDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">æ–‡ä»¶è¯¦æƒ…</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="fileDetailContent">
                    <!-- æ–‡ä»¶è¯¦æƒ…å†…å®¹ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                    <button type="button" class="btn btn-primary" onclick="copyFileUrl()">å¤åˆ¶é“¾æ¥</button>
                    <button type="button" class="btn btn-danger" onclick="deleteFile()">åˆ é™¤æ–‡ä»¶</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let currentFolder = 'all';
        let currentFilter = 'all';
        let viewMode = 'grid';
        let selectedFiles = new Set();
        let mediaFiles = [];
        let filteredFiles = [];

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeMediaLibrary();
            setupDragAndDrop();
            loadMediaFiles();
        });

        // åˆå§‹åŒ–åª’ä½“åº“
        function initializeMediaLibrary() {
            console.log('ğŸš€ åª’ä½“åº“ç®¡ç†ç³»ç»Ÿåˆå§‹åŒ–');
            updateStats();
        }

        // è®¾ç½®æ‹–æ‹½ä¸Šä¼ 
        function setupDragAndDrop() {
            const uploadZone = document.getElementById('uploadZone');

            uploadZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadZone.classList.remove('dragover');

                const files = Array.from(e.dataTransfer.files);
                handleFileUpload(files);
            });
        }

        // åŠ è½½åª’ä½“æ–‡ä»¶ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰
        function loadMediaFiles() {
            // æ¨¡æ‹Ÿåª’ä½“æ–‡ä»¶æ•°æ®
            mediaFiles = [
                {
                    id: 1,
                    name: 'product-main.jpg',
                    type: 'image',
                    size: 1024000,
                    folder: 'products',
                    url: '/images/products/K-series/K-main.jpg',
                    uploadDate: '2024-01-15',
                    dimensions: '800x600'
                },
                {
                    id: 2,
                    name: 'case-study-1.jpg',
                    type: 'image',
                    size: 2048000,
                    folder: 'cases',
                    url: '/images/cases/case-1.jpg',
                    uploadDate: '2024-01-14',
                    dimensions: '1200x800'
                },
                {
                    id: 3,
                    name: 'product-manual.pdf',
                    type: 'document',
                    size: 5120000,
                    folder: 'documents',
                    url: '/documents/manual.pdf',
                    uploadDate: '2024-01-13',
                    pages: 24
                },
                {
                    id: 4,
                    name: 'demo-video.mp4',
                    type: 'video',
                    size: 15360000,
                    folder: 'videos',
                    url: '/videos/demo.mp4',
                    uploadDate: '2024-01-12',
                    duration: '2:30'
                },
                {
                    id: 5,
                    name: 'news-banner.jpg',
                    type: 'image',
                    size: 1536000,
                    folder: 'news',
                    url: '/images/news/banner.jpg',
                    uploadDate: '2024-01-11',
                    dimensions: '1920x1080'
                }
            ];

            applyFilters();
        }

        // åº”ç”¨è¿‡æ»¤å™¨
        function applyFilters() {
            filteredFiles = mediaFiles.filter(file => {
                let folderMatch = currentFolder === 'all' || file.folder === currentFolder;
                let typeMatch = currentFilter === 'all' || file.type === currentFilter;
                return folderMatch && typeMatch;
            });

            renderMediaFiles();
            updateStats();
        }

        // æ¸²æŸ“åª’ä½“æ–‡ä»¶
        function renderMediaFiles() {
            if (viewMode === 'grid') {
                renderGridView();
            } else {
                renderListView();
            }
        }

        // æ¸²æŸ“ç½‘æ ¼è§†å›¾
        function renderGridView() {
            const mediaGrid = document.getElementById('mediaGrid');
            const mediaList = document.getElementById('mediaList');

            mediaGrid.style.display = 'grid';
            mediaList.style.display = 'none';

            if (filteredFiles.length === 0) {
                mediaGrid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">æš‚æ— æ–‡ä»¶</h5>
                        <p class="text-muted">ç‚¹å‡»ä¸Šä¼ æŒ‰é’®æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°ä¸Šä¼ åŒºåŸŸ</p>
                    </div>
                `;
                return;
            }

            mediaGrid.innerHTML = filteredFiles.map(file => `
                <div class="media-item ${selectedFiles.has(file.id) ? 'selected' : ''}"
                     onclick="selectFile(${file.id})"
                     ondblclick="showFileDetail(${file.id})">
                    <div class="media-actions">
                        <button class="btn btn-sm btn-light" onclick="event.stopPropagation(); showFileDetail(${file.id})" title="æŸ¥çœ‹è¯¦æƒ…">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteFile(${file.id})" title="åˆ é™¤">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="media-preview">
                        ${getFilePreview(file)}
                    </div>
                    <div class="media-info">
                        <div class="media-title" title="${file.name}">${truncateFileName(file.name, 20)}</div>
                        <div class="media-meta">
                            ${formatFileSize(file.size)} â€¢ ${file.uploadDate}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“åˆ—è¡¨è§†å›¾
        function renderListView() {
            const mediaGrid = document.getElementById('mediaGrid');
            const mediaList = document.getElementById('mediaList');
            const mediaListBody = document.getElementById('mediaListBody');

            mediaGrid.style.display = 'none';
            mediaList.style.display = 'block';

            if (filteredFiles.length === 0) {
                mediaListBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-4">
                            <i class="fas fa-folder-open fa-2x text-muted mb-2"></i>
                            <div class="text-muted">æš‚æ— æ–‡ä»¶</div>
                        </td>
                    </tr>
                `;
                return;
            }

            mediaListBody.innerHTML = filteredFiles.map(file => `
                <tr class="${selectedFiles.has(file.id) ? 'table-primary' : ''}">
                    <td>
                        <input type="checkbox" class="form-check-input"
                               ${selectedFiles.has(file.id) ? 'checked' : ''}
                               onchange="toggleFileSelection(${file.id}, this.checked)">
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-${getFileIcon(file.type)} me-2 file-type-${file.type}"></i>
                            <span onclick="showFileDetail(${file.id})" style="cursor: pointer;">${file.name}</span>
                        </div>
                    </td>
                    <td><span class="badge bg-secondary">${file.type}</span></td>
                    <td>${formatFileSize(file.size)}</td>
                    <td>${file.uploadDate}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="showFileDetail(${file.id})" title="æŸ¥çœ‹è¯¦æƒ…">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteFile(${file.id})" title="åˆ é™¤">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // è·å–æ–‡ä»¶é¢„è§ˆ
        function getFilePreview(file) {
            switch (file.type) {
                case 'image':
                    return `<img src="${file.url}" alt="${file.name}" class="media-preview" style="width: 100%; height: 100%; object-fit: cover;">`;
                case 'video':
                    return `<i class="fas fa-video file-type-icon file-type-video"></i>`;
                case 'document':
                    return `<i class="fas fa-file-pdf file-type-icon file-type-document"></i>`;
                case 'audio':
                    return `<i class="fas fa-music file-type-icon file-type-audio"></i>`;
                default:
                    return `<i class="fas fa-file file-type-icon"></i>`;
            }
        }

        // è·å–æ–‡ä»¶å›¾æ ‡
        function getFileIcon(type) {
            const icons = {
                'image': 'image',
                'video': 'video',
                'document': 'file-pdf',
                'audio': 'music'
            };
            return icons[type] || 'file';
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // æˆªæ–­æ–‡ä»¶å
        function truncateFileName(name, maxLength) {
            if (name.length <= maxLength) return name;
            const ext = name.split('.').pop();
            const nameWithoutExt = name.substring(0, name.lastIndexOf('.'));
            const truncated = nameWithoutExt.substring(0, maxLength - ext.length - 4) + '...';
            return truncated + '.' + ext;
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const totalFiles = mediaFiles.length;
            const totalSize = mediaFiles.reduce((sum, file) => sum + file.size, 0);
            const selectedCount = selectedFiles.size;

            document.getElementById('totalFiles').textContent = totalFiles;
            document.getElementById('totalSize').textContent = formatFileSize(totalSize);
            document.getElementById('selectedCount').textContent = selectedCount;

            // æ›´æ–°åˆ é™¤æŒ‰é’®çŠ¶æ€
            const deleteBtn = document.getElementById('deleteBtn');
            deleteBtn.disabled = selectedCount === 0;
        }

        // å¯¼èˆªåˆ°æ–‡ä»¶å¤¹
        function navigateToFolder(folder) {
            currentFolder = folder;

            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.media-sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');

            // æ›´æ–°é¢åŒ…å±‘
            updateBreadcrumb(folder);

            // åº”ç”¨è¿‡æ»¤å™¨
            applyFilters();
        }

        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        function updateBreadcrumb(folder) {
            const breadcrumb = document.getElementById('breadcrumbNav');
            const folderNames = {
                'all': 'æ‰€æœ‰æ–‡ä»¶',
                'products': 'äº§å“å›¾ç‰‡',
                'news': 'èµ„è®¯å›¾ç‰‡',
                'cases': 'æ¡ˆä¾‹å›¾ç‰‡',
                'documents': 'æ–‡æ¡£èµ„æ–™',
                'videos': 'è§†é¢‘æ–‡ä»¶'
            };

            breadcrumb.innerHTML = `
                <li class="breadcrumb-item"><a href="#" onclick="navigateToFolder('all')">åª’ä½“åº“</a></li>
                <li class="breadcrumb-item active" aria-current="page">${folderNames[folder]}</li>
            `;
        }

        // æŒ‰ç±»å‹è¿‡æ»¤
        function filterByType(type) {
            currentFilter = type;
            applyFilters();
        }

        // è®¾ç½®è§†å›¾æ¨¡å¼
        function setViewMode(mode) {
            viewMode = mode;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.btn-group button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            renderMediaFiles();
        }

        // æœç´¢æ–‡ä»¶
        function searchFiles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            if (searchTerm === '') {
                applyFilters();
                return;
            }

            filteredFiles = mediaFiles.filter(file => {
                let folderMatch = currentFolder === 'all' || file.folder === currentFolder;
                let typeMatch = currentFilter === 'all' || file.type === currentFilter;
                let nameMatch = file.name.toLowerCase().includes(searchTerm);
                return folderMatch && typeMatch && nameMatch;
            });

            renderMediaFiles();
        }

        // æ’åºæ–‡ä»¶
        function sortFiles(sortBy) {
            filteredFiles.sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'date':
                        return new Date(b.uploadDate) - new Date(a.uploadDate);
                    case 'size':
                        return b.size - a.size;
                    case 'type':
                        return a.type.localeCompare(b.type);
                    default:
                        return 0;
                }
            });

            renderMediaFiles();
        }

        // é€‰æ‹©æ–‡ä»¶
        function selectFile(fileId) {
            if (selectedFiles.has(fileId)) {
                selectedFiles.delete(fileId);
            } else {
                selectedFiles.add(fileId);
            }

            renderMediaFiles();
            updateStats();
        }

        // åˆ‡æ¢æ–‡ä»¶é€‰æ‹©çŠ¶æ€
        function toggleFileSelection(fileId, checked) {
            if (checked) {
                selectedFiles.add(fileId);
            } else {
                selectedFiles.delete(fileId);
            }

            renderMediaFiles();
            updateStats();
        }

        // å…¨é€‰/å–æ¶ˆå…¨é€‰
        function selectAll(checked) {
            if (checked) {
                filteredFiles.forEach(file => selectedFiles.add(file.id));
            } else {
                selectedFiles.clear();
            }

            renderMediaFiles();
            updateStats();
        }

        // ä¸Šä¼ æ–‡ä»¶
        function uploadFiles() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = 'image/*,video/*,.pdf,.doc,.docx,.txt';
            input.onchange = function(e) {
                const files = Array.from(e.target.files);
                handleFileUpload(files);
            };
            input.click();
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(files) {
            files.forEach(file => {
                const fileId = Date.now() + Math.random();

                // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
                showUploadProgress(fileId, file.name);

                // æ¨¡æ‹Ÿä¸Šä¼ è¿‡ç¨‹
                simulateUpload(fileId, file);
            });
        }

        // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
        function showUploadProgress(fileId, fileName) {
            const progressContainer = document.getElementById('progressContainer');
            const progressDiv = document.createElement('div');
            progressDiv.className = 'upload-progress';
            progressDiv.id = `progress-${fileId}`;

            progressDiv.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="small">${fileName}</span>
                    <button class="btn btn-sm btn-outline-secondary" onclick="cancelUpload(${fileId})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <div class="small text-muted mt-1">å‡†å¤‡ä¸Šä¼ ...</div>
            `;

            progressContainer.appendChild(progressDiv);
        }

        // æ¨¡æ‹Ÿä¸Šä¼ è¿‡ç¨‹
        function simulateUpload(fileId, file) {
            const progressDiv = document.getElementById(`progress-${fileId}`);
            const progressBar = progressDiv.querySelector('.progress-bar');
            const statusText = progressDiv.querySelector('.text-muted');

            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);

                    // ä¸Šä¼ å®Œæˆ
                    progressBar.style.width = '100%';
                    progressBar.classList.add('bg-success');
                    statusText.textContent = 'ä¸Šä¼ å®Œæˆ';

                    // æ·»åŠ åˆ°åª’ä½“æ–‡ä»¶åˆ—è¡¨
                    addUploadedFile(file);

                    // 3ç§’åç§»é™¤è¿›åº¦æ¡
                    setTimeout(() => {
                        progressDiv.remove();
                    }, 3000);
                } else {
                    progressBar.style.width = progress + '%';
                    statusText.textContent = `ä¸Šä¼ ä¸­... ${Math.round(progress)}%`;
                }
            }, 200);
        }

        // æ·»åŠ ä¸Šä¼ çš„æ–‡ä»¶åˆ°åˆ—è¡¨
        function addUploadedFile(file) {
            const newFile = {
                id: Date.now() + Math.random(),
                name: file.name,
                type: getFileType(file.type),
                size: file.size,
                folder: currentFolder === 'all' ? 'products' : currentFolder,
                url: URL.createObjectURL(file), // å®é™…åº”ç”¨ä¸­åº”è¯¥æ˜¯æœåŠ¡å™¨è¿”å›çš„URL
                uploadDate: new Date().toISOString().split('T')[0],
                dimensions: file.type.startsWith('image/') ? 'æœªçŸ¥' : null
            };

            mediaFiles.push(newFile);
            applyFilters();

            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showNotification('æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼', 'success');
        }

        // è·å–æ–‡ä»¶ç±»å‹
        function getFileType(mimeType) {
            if (mimeType.startsWith('image/')) return 'image';
            if (mimeType.startsWith('video/')) return 'video';
            if (mimeType.startsWith('audio/')) return 'audio';
            if (mimeType.includes('pdf') || mimeType.includes('document') || mimeType.includes('text')) return 'document';
            return 'other';
        }

        // å–æ¶ˆä¸Šä¼ 
        function cancelUpload(fileId) {
            const progressDiv = document.getElementById(`progress-${fileId}`);
            if (progressDiv) {
                progressDiv.remove();
            }
        }

        // åˆ›å»ºæ–‡ä»¶å¤¹
        function createFolder() {
            const folderName = prompt('è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°:');
            if (folderName && folderName.trim()) {
                showNotification(`æ–‡ä»¶å¤¹ "${folderName}" åˆ›å»ºæˆåŠŸï¼`, 'success');
                // å®é™…åº”ç”¨ä¸­åº”è¯¥è°ƒç”¨APIåˆ›å»ºæ–‡ä»¶å¤¹
            }
        }

        // æ˜¾ç¤ºæ–‡ä»¶è¯¦æƒ…
        function showFileDetail(fileId) {
            const file = mediaFiles.find(f => f.id === fileId);
            if (!file) return;

            const modal = new bootstrap.Modal(document.getElementById('fileDetailModal'));
            const content = document.getElementById('fileDetailContent');

            let detailHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="text-center mb-3">
                            ${file.type === 'image' ?
                                `<img src="${file.url}" class="img-fluid rounded" alt="${file.name}" style="max-height: 300px;">` :
                                `<i class="fas fa-${getFileIcon(file.type)} fa-5x file-type-${file.type}"></i>`
                            }
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>æ–‡ä»¶ä¿¡æ¯</h6>
                        <table class="table table-sm">
                            <tr><td><strong>æ–‡ä»¶å:</strong></td><td>${file.name}</td></tr>
                            <tr><td><strong>ç±»å‹:</strong></td><td>${file.type}</td></tr>
                            <tr><td><strong>å¤§å°:</strong></td><td>${formatFileSize(file.size)}</td></tr>
                            <tr><td><strong>æ–‡ä»¶å¤¹:</strong></td><td>${file.folder}</td></tr>
                            <tr><td><strong>ä¸Šä¼ æ—¥æœŸ:</strong></td><td>${file.uploadDate}</td></tr>
                            ${file.dimensions ? `<tr><td><strong>å°ºå¯¸:</strong></td><td>${file.dimensions}</td></tr>` : ''}
                            ${file.duration ? `<tr><td><strong>æ—¶é•¿:</strong></td><td>${file.duration}</td></tr>` : ''}
                            ${file.pages ? `<tr><td><strong>é¡µæ•°:</strong></td><td>${file.pages}</td></tr>` : ''}
                        </table>

                        <h6 class="mt-3">æ–‡ä»¶é“¾æ¥</h6>
                        <div class="input-group">
                            <input type="text" class="form-control" value="${window.location.origin}${file.url}" readonly id="fileUrl">
                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('fileUrl')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            content.innerHTML = detailHTML;
            modal.show();

            // è®¾ç½®å½“å‰æ–‡ä»¶IDç”¨äºåˆ é™¤æ“ä½œ
            window.currentFileId = fileId;
        }

        // åˆ é™¤æ–‡ä»¶
        function deleteFile(fileId = null) {
            const targetId = fileId || window.currentFileId;
            if (!targetId) return;

            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                mediaFiles = mediaFiles.filter(f => f.id !== targetId);
                selectedFiles.delete(targetId);
                applyFilters();
                showNotification('æ–‡ä»¶åˆ é™¤æˆåŠŸï¼', 'success');

                // å¦‚æœæ˜¯åœ¨æ¨¡æ€æ¡†ä¸­åˆ é™¤ï¼Œå…³é—­æ¨¡æ€æ¡†
                const modal = bootstrap.Modal.getInstance(document.getElementById('fileDetailModal'));
                if (modal) {
                    modal.hide();
                }
            }
        }

        // åˆ é™¤é€‰ä¸­çš„æ–‡ä»¶
        function deleteSelected() {
            if (selectedFiles.size === 0) return;

            if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedFiles.size} ä¸ªæ–‡ä»¶å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                mediaFiles = mediaFiles.filter(f => !selectedFiles.has(f.id));
                selectedFiles.clear();
                applyFilters();
                showNotification(`æˆåŠŸåˆ é™¤ ${selectedFiles.size} ä¸ªæ–‡ä»¶ï¼`, 'success');
            }
        }

        // å¤åˆ¶æ–‡ä»¶é“¾æ¥
        function copyFileUrl() {
            copyToClipboard('fileUrl');
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            document.execCommand('copy');
            showNotification('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'info');
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; left: 50%; transform: translateX(-50%); z-index: 1060; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(alertDiv);

            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>
