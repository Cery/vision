<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>修复验证测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 20px 0; }
        .success { border-left: 4px solid #28a745; background: #f8fff9; }
        .error { border-left: 4px solid #dc3545; background: #fff8f8; }
        .warning { border-left: 4px solid #ffc107; background: #fffbf0; }
        .info { border-left: 4px solid #17a2b8; background: #f0f9ff; }
        button { padding: 12px 24px; margin: 10px 5px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .test-item { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; }
        .test-title { font-weight: bold; color: #495057; margin-bottom: 10px; }
        .test-status { font-size: 1.2em; margin-top: 10px; }
        .test-details { font-size: 0.9em; color: #6c757d; margin-top: 5px; }
        .iframe-container { border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden; margin: 10px 0; }
        iframe { width: 100%; height: 400px; border: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 修复验证测试</h1>
        
        <div class="card">
            <h3>修复项目清单</h3>
            <div class="test-grid">
                <div class="test-item">
                    <div class="test-title">1. 快速统计数据显示</div>
                    <div class="test-details">修复管理页面首页统计数字显示为0的问题</div>
                    <div class="test-status" id="stats-status">⏳ 等待测试</div>
                </div>
                
                <div class="test-item">
                    <div class="test-title">2. 产品分类标签深色</div>
                    <div class="test-details">产品卡片和详情页分类标签背景改为深色</div>
                    <div class="test-status" id="tags-status">⏳ 等待测试</div>
                </div>
                
                <div class="test-item">
                    <div class="test-title">3. Logo深色元素</div>
                    <div class="test-details">确保所有logo元素使用深色版本</div>
                    <div class="test-status" id="logo-status">⏳ 等待测试</div>
                </div>
                
                <div class="test-item">
                    <div class="test-title">4. 数据加载完整性</div>
                    <div class="test-details">验证所有数据模块正确加载</div>
                    <div class="test-status" id="data-status">⏳ 等待测试</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>测试操作</h3>
            <button class="btn-primary" onclick="runAllTests()">运行所有测试</button>
            <button class="btn-success" onclick="openContentManager()">打开内容管理器</button>
            <button class="btn-warning" onclick="openProductsPage()">查看产品页面</button>
        </div>

        <div class="card">
            <h3>测试结果</h3>
            <div id="testResults">
                <p>点击"运行所有测试"开始验证修复效果...</p>
            </div>
        </div>

        <div class="card">
            <h3>内容管理器预览</h3>
            <div class="iframe-container">
                <iframe src="/admin/content-manager.html" title="内容管理器"></iframe>
            </div>
        </div>

        <div class="card">
            <h3>产品页面预览</h3>
            <div class="iframe-container">
                <iframe src="/products/" title="产品页面"></iframe>
            </div>
        </div>
    </div>

    <script>
        async function runAllTests() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>🔄 正在运行测试...</p>';

            const tests = [
                { name: '快速统计数据', id: 'stats-status', test: testStatistics },
                { name: '产品分类标签', id: 'tags-status', test: testProductTags },
                { name: 'Logo深色元素', id: 'logo-status', test: testLogoDark },
                { name: '数据加载完整性', id: 'data-status', test: testDataLoading }
            ];

            const results = [];
            
            for (const test of tests) {
                try {
                    const result = await test.test();
                    const statusEl = document.getElementById(test.id);
                    
                    if (result.success) {
                        statusEl.innerHTML = '✅ 通过';
                        statusEl.className = 'test-status success';
                    } else {
                        statusEl.innerHTML = '❌ 失败';
                        statusEl.className = 'test-status error';
                    }
                    
                    results.push({
                        name: test.name,
                        success: result.success,
                        message: result.message
                    });
                } catch (error) {
                    const statusEl = document.getElementById(test.id);
                    statusEl.innerHTML = '⚠️ 错误';
                    statusEl.className = 'test-status warning';
                    
                    results.push({
                        name: test.name,
                        success: false,
                        message: `测试出错: ${error.message}`
                    });
                }
            }

            displayResults(results);
        }

        async function testStatistics() {
            try {
                // 尝试访问内容管理器的统计数据
                const response = await fetch('/admin/content-manager.html');
                const html = await response.text();
                
                // 检查是否包含统计更新函数
                const hasUpdateStats = html.includes('updateStatistics()');
                const hasStatsElements = html.includes('newsCount') && html.includes('productsCount');
                
                if (hasUpdateStats && hasStatsElements) {
                    return { success: true, message: '统计数据更新函数已正确配置' };
                } else {
                    return { success: false, message: '统计数据更新函数配置不完整' };
                }
            } catch (error) {
                return { success: false, message: `无法验证统计数据: ${error.message}` };
            }
        }

        async function testProductTags() {
            try {
                // 检查产品页面模板
                const listResponse = await fetch('/products/');
                const listHtml = await listResponse.text();
                
                // 检查是否使用了深色标签
                const hasDarkTags = listHtml.includes('badge bg-dark') || listHtml.includes('bg-dark');
                
                if (hasDarkTags) {
                    return { success: true, message: '产品分类标签已更新为深色' };
                } else {
                    return { success: false, message: '产品分类标签仍使用浅色' };
                }
            } catch (error) {
                return { success: false, message: `无法验证产品标签: ${error.message}` };
            }
        }

        async function testLogoDark() {
            try {
                // 检查首页logo
                const response = await fetch('/');
                const html = await response.text();
                
                // 检查是否使用了深色logo
                const hasLogoDark = html.includes('logo-dark.svg');
                
                if (hasLogoDark) {
                    return { success: true, message: 'Logo已使用深色版本' };
                } else {
                    return { success: false, message: 'Logo仍使用浅色版本' };
                }
            } catch (error) {
                return { success: false, message: `无法验证Logo: ${error.message}` };
            }
        }

        async function testDataLoading() {
            try {
                // 检查数据匹配测试页面
                const response = await fetch('/admin/test-data-matching.html');
                const html = await response.text();
                
                // 检查是否包含完整的数据类型
                const hasAllDataTypes = html.includes('products') && 
                                       html.includes('news') && 
                                       html.includes('cases') && 
                                       html.includes('applications');
                
                if (hasAllDataTypes) {
                    return { success: true, message: '数据加载测试页面配置完整' };
                } else {
                    return { success: false, message: '数据加载测试页面配置不完整' };
                }
            } catch (error) {
                return { success: false, message: `无法验证数据加载: ${error.message}` };
            }
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('testResults');
            
            const successCount = results.filter(r => r.success).length;
            const totalCount = results.length;
            
            const overallSuccess = successCount === totalCount;
            const resultClass = overallSuccess ? 'success' : 'warning';
            const resultIcon = overallSuccess ? '✅' : '⚠️';
            
            const resultHtml = `
                <div class="${resultClass}">
                    <h4>${resultIcon} 测试完成</h4>
                    <p><strong>通过率:</strong> ${successCount}/${totalCount} (${Math.round(successCount/totalCount*100)}%)</p>
                    <ul>
                        ${results.map(r => `
                            <li>
                                <strong>${r.name}:</strong> 
                                ${r.success ? '✅' : '❌'} ${r.message}
                            </li>
                        `).join('')}
                    </ul>
                    ${overallSuccess ? 
                        '<p>🎉 所有修复项目都已成功完成！</p>' : 
                        '<p>⚠️ 部分修复项目需要进一步检查。</p>'
                    }
                </div>
            `;
            
            resultsDiv.innerHTML = resultHtml;
        }

        function openContentManager() {
            window.open('/admin/content-manager.html', '_blank');
        }

        function openProductsPage() {
            window.open('/products/', '_blank');
        }

        // 页面加载时自动运行测试
        document.addEventListener('DOMContentLoaded', function() {
            console.log('修复验证测试页面加载完成');
            
            // 延迟2秒后自动运行测试
            setTimeout(() => {
                runAllTests();
            }, 2000);
        });
    </script>
</body>
</html>
