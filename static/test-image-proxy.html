<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡ä»£ç†æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-image {
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border: 1px solid #ccc;
            margin: 10px;
        }
        .error-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸ–¼ï¸ å›¾ç‰‡ä»£ç†åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
    
    <div class="status info">
        <strong>è¯´æ˜ï¼š</strong>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•å›¾ç‰‡ä»£ç†åŠŸèƒ½ã€‚å½“å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ï¼Œä¼šå°è¯•é€šè¿‡ä»£ç†ä»åå°ç®¡ç†ç³»ç»Ÿè·å–å›¾ç‰‡æ•°æ®ã€‚
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•1ï¼šäº§å“å›¾ç‰‡</h2>
        <p>è¿™äº›å›¾ç‰‡è·¯å¾„æŒ‡å‘å¯èƒ½ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œåº”è¯¥è§¦å‘ä»£ç†åŠ è½½ï¼š</p>
        <img src="/images/products/test-product-1.jpg" alt="æµ‹è¯•äº§å“1" class="test-image">
        <img src="/images/products/test-product-2.png" alt="æµ‹è¯•äº§å“2" class="test-image">
        <img src="/images/products/ws-k1010-main.jpg" alt="WS-K1010ä¸»å›¾" class="test-image">
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•2ï¼šå†…å®¹å›¾ç‰‡</h2>
        <p>è¿™äº›å›¾ç‰‡æ¥è‡ªå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼š</p>
        <img src="/images/content/products/application-1.jpg" alt="åº”ç”¨åœºæ™¯1" class="test-image">
        <img src="/images/content/products/description-1.png" alt="äº§å“æè¿°1" class="test-image">
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•3ï¼šç°æœ‰å›¾ç‰‡</h2>
        <p>è¿™äº›å›¾ç‰‡åº”è¯¥æ­£å¸¸åŠ è½½ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼š</p>
        <img src="/images/products/K-series/K-main.jpg" alt="Kç³»åˆ—ä¸»å›¾" class="test-image">
        <img src="/images/products/P60/P-MAIN.jpg" alt="P60ä¸»å›¾" class="test-image">
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•çŠ¶æ€</h2>
        <div id="testStatus"></div>
        <button onclick="runImageTest()">è¿è¡Œå›¾ç‰‡æµ‹è¯•</button>
        <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“ é”™è¯¯æ—¥å¿—</h2>
        <div id="errorLog" class="error-log"></div>
    </div>

    <script>
        // æ—¥å¿—è®°å½•
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const logElement = document.getElementById('errorLog');
        
        function addToLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> <span style="color: ${type === 'error' ? 'red' : type === 'success' ? 'green' : 'blue'};">${message}</span>`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addToLog(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };
        
        // æµ‹è¯•å‡½æ•°
        function runImageTest() {
            const statusElement = document.getElementById('testStatus');
            statusElement.innerHTML = '<div class="status info">æ­£åœ¨è¿è¡Œå›¾ç‰‡æµ‹è¯•...</div>';
            
            const images = document.querySelectorAll('.test-image');
            let loadedCount = 0;
            let errorCount = 0;
            let totalCount = images.length;
            
            images.forEach((img, index) => {
                const originalSrc = img.src;
                
                // é‡ç½®å›¾ç‰‡
                img.src = '';
                
                setTimeout(() => {
                    img.onload = function() {
                        loadedCount++;
                        console.log(`âœ… å›¾ç‰‡ ${index + 1} åŠ è½½æˆåŠŸ: ${originalSrc}`);
                        updateTestStatus();
                    };
                    
                    img.onerror = function() {
                        errorCount++;
                        console.error(`âŒ å›¾ç‰‡ ${index + 1} åŠ è½½å¤±è´¥: ${originalSrc}`);
                        updateTestStatus();
                    };
                    
                    // é‡æ–°è®¾ç½®srcè§¦å‘åŠ è½½
                    img.src = originalSrc;
                }, index * 100);
            });
            
            function updateTestStatus() {
                if (loadedCount + errorCount === totalCount) {
                    const successRate = ((loadedCount / totalCount) * 100).toFixed(1);
                    statusElement.innerHTML = `
                        <div class="status ${loadedCount === totalCount ? 'success' : 'error'}">
                            æµ‹è¯•å®Œæˆï¼æˆåŠŸåŠ è½½: ${loadedCount}/${totalCount} (${successRate}%)
                        </div>
                    `;
                }
            }
        }
        
        function clearLog() {
            document.getElementById('errorLog').innerHTML = '';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ–¼ï¸ å›¾ç‰‡ä»£ç†æµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // ç›‘å¬å›¾ç‰‡åŠ è½½äº‹ä»¶
            document.querySelectorAll('.test-image').forEach((img, index) => {
                img.addEventListener('load', function() {
                    console.log(`å›¾ç‰‡ ${index + 1} åŠ è½½æˆåŠŸ: ${this.src}`);
                });
                
                img.addEventListener('error', function() {
                    console.error(`å›¾ç‰‡ ${index + 1} åŠ è½½å¤±è´¥: ${this.src}`);
                });
            });
            
            // è‡ªåŠ¨è¿è¡Œä¸€æ¬¡æµ‹è¯•
            setTimeout(runImageTest, 1000);
        });
        
        // ç›‘å¬æ¥è‡ªå›¾ç‰‡ä»£ç†çš„æ¶ˆæ¯
        window.addEventListener('message', function(event) {
            if (event.data.type === 'IMAGE_RESPONSE') {
                console.log(`ğŸ“¡ æ”¶åˆ°å›¾ç‰‡ä»£ç†å“åº”: ${event.data.fileName}`);
            }
        });
    </script>
    
    <!-- å¼•å…¥å›¾ç‰‡ä»£ç†è„šæœ¬ -->
    <script src="/js/image-proxy.js"></script>
</body>
</html>
